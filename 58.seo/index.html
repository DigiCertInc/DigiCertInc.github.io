<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Linux运维的一些常见问题及解决方法 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2011-08-03T22:03:26.000Z" itemprop="datePublished">
          2011-08-04
      </time>
    
    
    | 
    <a href='/tag/Linux/'>Linux</a>,
    
    <a href='/tag/运维/'>运维</a>
    
    
</span>
    <h1 class="post-title">Linux运维的一些常见问题及解决方法</h1>
    <section class="post-content">
      <p>今晚有空把最近运维中遇到的一些问题及解决方法总结下，写的比较匆忙，可能有些问题和错误，请各位看官指正。<br>——————————————————————————————————————————<br>1.shell脚本死活不执行<br>问题：某天研发某同事找我说帮他看看他写的shell脚本，死活不执行，报错。我看了下，脚本很简单，也没有常规性的错误，报“: bad interpreter: No such file or&nbsp; directory”错。一<br>看这错，我就问他是不是在windows下编写的脚本，然后在上传到linux服务器的……果然。<br>原因：在DOS/Windows里，文本文件的换行符为rn，而在<em>nix系统里则为n，所以DOS/Windows里编辑过的文本文件到了</em>nix里，每一行都多了个^M。<br>解决：1）重新在linux下编写脚本；2）vi :% s/r//g&nbsp; :%&nbsp; s/^M//g （^M输入用Ctrl+v, Ctrl+m）<br>——————————————————————————————————————————<br>2.crontab输出<br>问题：/var/spool/clientmqueue目录占用空间超过100G<br>原因：cron中执行的程序有输出内容，输出内容会以邮件形式发给cron的用户，而sendmail没有启动所以就产生了/var/spool/clientmqueue目录下的那些文件，日积月累可能撑破磁盘。<br>解决：1）直接手动删除：ls |xargs rm -f&nbsp; ；&nbsp; 2）彻底解决：在cron的自动执行语句后加上 &gt;/dev/null 2&gt;&amp;1<br>——————————————————————————————————————————  </p><p>3.telnet很慢<br>问题：某天研发某同事说10.50访问10.52memcached服务异常，让我们检查下看网络/服务/系统是否有异常。检查发现系统正常，服务正常，10.50ping10.52也正常，但10.50telnet10.52很慢。同时发现该机器的namesever是不起作用的。<br>原因：because your PC doesn’t do a reverse DNS&nbsp; lookup on your IP then… when you telnet/ftp into your linux box, it’ll do a dns&nbsp; lookup on you。<br>解决：1)修改/etc/hosts使hostname和ip对应；&nbsp; 2）在/etc/resolv.conf注释掉nameserver或者找一个“活的”nameserver。<br>——————————————————————————————————————————<br>4.Read-only file system<br>问题：同事在mysql里建表建不成功，提示如下：<br>mysql&gt;create table wosontest (colddname1 char(1));<br>ERROR 1005 (HY000): Can’t create table ‘wosontest’ (errno:&nbsp; 30）<br>经检查mysql用户权限以及相关目录权限没问题；用perror 30提示信息为：OS error code&nbsp; 30:&nbsp;&nbsp; Read-only file system<br>可能原因：1）文件系统损坏；2）磁盘又坏道；3）fstab文件配置错误，如分区格式错误错误(将ntfs写成了fat)、配置指令拼写错误等。<br>解决：1）由于是测试机，重启机器后恢复；2）网上说用mount可解决。<br>——————————————————————————————————————————<br>5.文件删了磁盘空间没释放<br>问题：某天发现某台机器df -h已用磁盘空间为90G，而du -sh&nbsp; /<em>显示所有使用空间加起来才30G，囧。<br>原因：可能某人直接用rm删除某个正在写的文件，导致文件删了但磁盘空间没释放的问题<br>解决：<br>1）最简单重启系统或者重启相关服务。<br>2）干掉进程<br>/usr/sbin/lsof|grep deleted<br>ora&nbsp;&nbsp;&nbsp; 25575 data&nbsp;&nbsp; 33u&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REG&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65,65&nbsp;&nbsp; 4294983680&nbsp; /oradata/DATAPRE/UNDOTBS009.dbf (deleted)<br>从lsof的输出中，我们可以发现pid为25575的进程持有着以文件描述号（fd）为&nbsp; 33打开的文件/oradata/DATAPRE/UNDOTBS009.dbf。在我们找到了这个文件之后可以通过结束进程的方式来释放被占用的空间：echo&nbsp; &gt; /proc/25575/fd/33<br>3）删除正在写的文件一般用 cat /dev/null &gt; file<br>——————————————————————————————————————————<br>6.find文件<br>问题：在tmp目录下有大量包含picture_</em>的临时文件，每天晚上2:30对一天前的文件进行清理。之前在crontab下跑如下脚本，但是发现脚本效率很低，每次执行时负载猛涨，影响到其他服务。<br>#!/bin/sh<br>find /tmp -name “picture_<em>” -mtime +1 -exec rm -f {} ;<br>原因：目录下有大量文件，用find很耗资源。<br>解决：<br>#!/bin/sh<br>cd /tmp<br>time=<code>date -d “2 day ago” “+%b %d”</code><br>ls -l|grep “picture” |grep “$time”|awk ‘{print $NF}’|xargs rm -rf<br>——————————————————————————————————————————  <p>7.获取不了网关mac地址<br>问题：从2.14到3.65（映射地址2.141）网络不通，但是从3端的其他机器到3.65网络OK。<br>原因：<br># arp<br>Address&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; HWtype&nbsp; HWaddress&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Flags&nbsp; Mask&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Iface<br>192.168.3.254&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ether&nbsp;&nbsp; incomplet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; bond0<br>表面现象是机器自动获取不了网关MAC地址，网络工程师说是网络设备的问题，具体不清。<br>解决：arp绑定，arp -i bond0 -s 192.168.3.254&nbsp; 00:00:5e:00:01:64<br>——————————————————————————————————————————<br>8.问题：某天研发某同事说网站前端+1环境http无法启动，我上去看了下。报如下错：<br>/etc/init.d/httpd start<br>Starting httpd: [Sat Jan 29 17:49:00 2011] [warn] module&nbsp; antibot_module is already loaded, skipping<br>Use proxy forward as remote ip : true.<br>Antibot exclude pattern : .</p></em>.[(js|css|jpg|gif|png)]<br>Antibot seed check pattern : login<br>(98)Address already in use: make_sock: could not bind to&nbsp; address [::]:7080<br>(98)Address already in use: make_sock: could not bind to&nbsp; address 0.0.0.0:7080<br>no listening sockets available, shutting down<br>Unable to open log&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [FAILED]<br>原因：<br>1）端口被占用：表面看是7080端口被占用，于是netstat -npl|grep&nbsp; 7080看了下发现7080没有占用；<br>2）在配置文件中重复写了端口，如果在以下两个文件同时写了Listen 7080<br>/etc/httpd/conf/http.conf<br>/etc/httpd/conf.d/t.10086.cn.conf<br>解决：注释掉/etc/httpd/conf.d/t.10086.cn.conf的Listen&nbsp; 7080，重启，OK。<br>——————————————————————————————————————————<br>9.too many open file终极解决方案<br>echo “” &gt;&gt; /etc/security/limits.conf<br>echo “<em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; soft&nbsp;&nbsp; nproc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65535″ &gt;&gt;&nbsp; /etc/security/limits.conf<br>echo “</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hard&nbsp;&nbsp; nproc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65535″ &gt;&gt;&nbsp; /etc/security/limits.conf<br>echo “<em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; soft&nbsp;&nbsp; nofile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65535″ &gt;&gt;&nbsp; /etc/security/limits.conf<br>echo “</em>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; hard&nbsp;&nbsp; nofile&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 65535″ &gt;&gt;&nbsp; /etc/security/limits.conf<br>echo “” &gt;&gt; /root/.bash_profile<br>echo “ulimit-n&nbsp;&nbsp; 65535″ &gt;&gt; /root/.bash_profile<br>echo “ulimit&nbsp; -u&nbsp;&nbsp; 65535″ &gt;&gt; /root/.bash_profile  </p><p>最后重启机器 或者执行 ulimit -u 655345 &amp;&amp; ulimit -n 65535<br>——————————————————————————————————————————<br>10.ibdata1和mysql-bin<br>问题：2.51磁盘空间报警，经查发现ibdata1和mysql-bin日志占用空间太多（其中ibdata1超过120G，mysql-bin超过80G）<br>原因：ibdata1是存储格式，在INNODB类型数据状态下，ibdata1用来存储文件的数据和索引，而库名的文件夹里的那些表文件只是结构而已。<br>innodb存储引擎有两种表空间的管理方式，分别是：<br>1）共享表空间（可拆分为多个小的表空间文件），这个是我们目前多数数据库使用的方法；<br>2）独立表空间，每一个表有一个独立的表空间（磁盘文件）<br>对于两种管理方式，各有优劣，具体如下：<br>①共享表空间：<br>优点：可以将表空间分成多个文件存放到不同的磁盘上（表空间文件大小不受表大小的限制，一个表可以分布在不同步的文件上）。<br>缺点：所有数据和索引存放在一个文件中，则随着数据的增加，将会有一个很大的文件，虽然可以把一个大文件分成多个小文件，但是多个表及索引在表空间中混合存储，这样如果对于一个表做了大量删除操作后表空间中将有大量空隙。对于共享表空间管理的方式下，一旦表空间被分配，就不能再回缩了。当出现临时建索引或是创建一个临时表的操作表空间扩大后，就是删除相关的表也没办法回缩那部分空间了。<br>②独立表空间：在配置文件（my.cnf）中设置： innodb_file_per_table<br>特点：每个表都有自已独立的表空间；每个表的数据和索引都会存在自已的表空间中。<br>优点：表空间对应的磁盘空间可以被收回（Drop table操作自动回收表空间，如果对于删除大量数据后的表可以通过:alter&nbsp; table tbl_name engine=innodb;回缩不用的空间。<br>缺点：如果单表增加过大，如超过100G，性能也会受到影响。在这种情况下，如果使用共享表空间可以把文件分开，但有同样有一个问题，如果访问的范围过大同样会访问多个文件，一样会比较慢。如果使用独立表空间，可以考虑使用分区表的方法，在一定程度上缓解问题。此外，当启用独立表空间模式时，需要合理调整innodb_open_files参数的设置。<br>解决:<br>1）ibdata1数据太大：只能通过dump，导出建库的sql语句，再重建的方法。<br>2）mysql-bin Log太大：<br>①手动删除：<br>删除某个日志：mysql&gt;PURGE MASTER LOGS TO ‘mysql-bin.010′;<br>删除某天前的日志：mysql&gt;PURGE MASTER LOGS BEFORE ’2010-12-22&nbsp; 13:00:00′;<br>②在/etc/my.cnf里设置只保存N天的bin-log日志<br>expire_logs_days = 30&nbsp; //Binary Log自动删除的天数</p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://www.cker.in/58.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://www.cker.in/58.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.cker.in/58.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.cker.in/58.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/59.seo/">
        ← 一个暴力破解MSSQL用户密码的asp程序
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/57.seo/">
        2011最新 杰森&middot;斯坦森《闪电 私法制裁》DVD中英双字 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archive"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/2014-10-28-wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/2014-09-11-mabao/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
