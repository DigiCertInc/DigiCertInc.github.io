<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>编写自己的Acunetix WVS漏洞脚本详细教程 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2014-07-02T12:34:32.000Z" itemprop="datePublished">
          2014-07-02
      </time>
    
    
    | 
    <a href='/tag/SQL注入/'>SQL注入</a>,
    
    <a href='/tag/Discuz/'>Discuz</a>,
    
    <a href='/tag/Acunetix-Web-Vulnerability-Scanner/'>Acunetix Web Vulnerability Scanner</a>
    
    
</span>
    <h1 class="post-title">编写自己的Acunetix WVS漏洞脚本详细教程</h1>
    <section class="post-content">
      <p>AWVS提供了自定义的脚本编程接口，可是网上的资料很少，只有官方的几篇介绍和参考手册，最近研究了一下怎么编写AWVS的漏洞脚本来写一篇简单性的文章，大家有兴趣的可以交流 <a href="http://shang.qq.com/wpa/qunwpa?idkey=4bcfd030ee01d86b163a1446997795e3dd9ea7e0419d350fedd7580f5bfbc343" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="加入 Ha.Cker.In QQ群讨论" border="0" alt="加入 Ha.Cker.In QQ群讨论" src="http://img.cker.in/AcunetixWVS_3815/clip_image001.png" width="94" height="26"></a>。</p>  <p>本文以8.0为例，首先呢安装好<a href="http://ha.cker.in/tag/Acunetix Web Vulnerability Scanner" target="_blank">Acunetix Web Vulnerability Scanner</a> 8（该破解的破解，该付费的付费），然后我们需要WVS公开的小小的SDK，下载地址：<a href="http://www.acunetix.com/download/tools/WVSSDK.zip" target="_blank" rel="external">http://www.acunetix.com/download/tools/WVSSDK.zip</a> ，下载好了后解压bin目录下的WVSS.exe到WVS安装目录下面，此即为WVS脚本编写工具。另外sdk里还有3个简单的脚本小例子和WVS_SDK_Quick_Introduction.pdf，耐心的可以看看。</p>  <p>下面的截图就是WVS码脚本工具了</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image003.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image003_thumb.jpg" width="580" height="407"></a></p>  <p>打开WVS数据目录，通常是在<b>C:\Documents and Settings\All Users\Application Data\Acunetix WVS 8\Data\Scripts</b>下，可以看到有10个文件夹，Network、PerFile、PerScheme、PostScan、PerFolder、PerServer、PostCrawl、WebApps、XML。我们先来认识一下：</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image005.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image005_thumb.jpg" width="580" height="227"></a></p>  <p>Network：此目录下的脚本文件是当扫描器完成了端口扫描模块后执行，这些脚本可以检测TCP端口的开放情况，比如检测FTP的21端口是否开放、是否允许匿名登录；</p>  <p>PerFile：此目录下的脚本是当扫描器爬虫爬到文件后执行，比如你可以检查当前测试文件是否存在备份文件，当前测试文件的内容等；</p>  <p>PerFolder：此目录下的脚本是当扫描器爬虫爬行到目录后执行，比如你可以检测当前测试目录是否存在列目录漏洞等；</p>  <p>PerScheme：此目录下的脚本会对每个URL的 GET、POST结构的参数进行检测，AWVS定义了的参数包括HTTP头、Cookies、GET/POST参数、文件上传(multipart/form-data)……比如你可以检测XSS、SQL注入和其他的应用程序测试；</p>  <p>PerServer：此目录下的脚本只在扫描开始是执行一次，比如你可以检测Web服务器中间件类型；</p>  <p>PostScan：此目录下的脚本只在扫描结束后执行一次，比如你可以检测存储型XSS、存储型SQL注入、存储型文件包含、存储型目录遍历、存储型代码执行、存储型文件篡改、存储型php代码执行等；</p>  <p>XML：漏洞的详细描述文档都在这里。</p>  <p>今天演示的漏洞是 <a href="http://ha.cker.in/tag/discuz" target="_blank">Discuz</a> 7.2的faq.php <a href="http://ha.cker.in/tag/SQL注入" target="_blank">SQL注入</a>，关于漏洞：<a href="http://ha.cker.in/1087.seo" target="_blank" rel="external">http://ha.cker.in/1087.seo</a></p>  <p>我们就用POC来写漏洞的脚本吧！</p>  <p>检测原理：</p>  <p>根据公开的POC构造出特殊请求，若存在 <a href="http://ha.cker.in/tag/SQL注入" target="_blank">SQL注入</a> 则构造的SQL语句将会执行成功并在返回到响应内容，构造POC如下：</p>  <p>faq.php?action=grouppermission&amp;gids[99]=’&amp;gids[100][0]=)%20and%20(select%201%20from%20(select%20count(<em>),concat((select%200x4861636B656442795365636572),floor(rand(0)</em>2))x%20from%20information_schema%20.tables%20group%20by%20x)a)%23</p>  <p>利用截图，存在漏洞会返回“HackedBySecer”字样：</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image007.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image007_thumb.jpg" width="749" height="127"></a></p>  <p>&#160;</p>  <p>我们需要用WVS的脚本请求此URL并处理返回的内容，以此判断是否存在漏洞。</p>  <p>打开AWVS，Tools -&gt; Vulnerability Editor，右键VulnXMLs节点，选择‘Add Vulnerability’</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image009.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image009_thumb.jpg" width="253" height="205"></a></p>  <p>新建一个漏洞，VulnXML FILENAME为<b>Discuz7.2FaqSqlinjection</b>，点Add按钮（新建的VulnXML会被保存到XML文件夹下哦）</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image011.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image011_thumb.jpg" width="580" height="395"></a></p>  <p>接下来登记下该漏洞的相关信息</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image013.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image013_thumb.jpg" width="580" height="168"></a></p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image014.png" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image014_thumb.png" width="480" height="603"></a></p>  <p>然后进入wvss写脚本，保存为Discuz7.2FaqSqlinjection.script放入PerServer文件夹吧。</p>  <p>测试脚本：</p>  <p>使用AWVS的网站爬虫爬行网站并保存结果，</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image016.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image016_thumb.jpg" width="580" height="410"></a></p>  <p>这里选择根目录</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image018.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image018_thumb.jpg" width="580" height="499"></a></p>  <p>点击小三角按钮测试</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image020.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image020_thumb.jpg" width="199" height="141"></a></p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image022.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image022_thumb.jpg" width="580" height="339"></a></p>  <p>完整的代码如下</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image024.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image024_thumb.jpg" width="580" height="331"></a></p>  <p>测试成功了，我到WVS里扫描去测试扫描看看~</p>  <p>我们新建的漏洞脚本在这里，Scanning Profiles –》 PerFolder目录下，新建一个扫描模板勾选要测试的脚本并保存，这里保存为“test_HA.CKER.IN”，然后用这个模板扫描目标站测试吧</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image026.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image026_thumb.jpg" width="580" height="448"></a></p>  <p>选择模板并开始扫描</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image028.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image028_thumb.jpg" width="580" height="109"></a></p>  <p>扫描完成后，结果如图</p>  <p><a href="http://img.cker.in/AcunetixWVS_3815/clip_image030.jpg" rel="external" target="_blank"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="编写自己的Acunetix WVS漏洞脚本详细教程" border="0" alt="编写自己的Acunetix WVS漏洞脚本详细教程" src="http://img.cker.in/AcunetixWVS_3815/clip_image030_thumb.jpg" width="580" height="354"></a></p>  <p>漏洞脚本重复检测了很多次，下次更新修复下这个问题。</p>  <p>本人不才，这次对AWVS自定义脚本编写简单的介绍就到这了，只是做个示例展示给大家，这些API不是很详细我也不是很会写，更多的API等你去挖掘吧！</p>  <p>参考：</p>  <p><a href="http://www.acunetix.com/vulnerability-scanner/scriptingreference/index.html" target="_blank" rel="external">http://www.acunetix.com/vulnerability-scanner/scriptingreference/index.html</a></p>  <p><a href="http://www.acunetix.com/blog/docs/creating-custom-checks-acunetix-web-vulnerability-scanner/" target="_blank" rel="external">http://www.acunetix.com/blog/docs/creating-custom-checks-acunetix-web-vulnerability-scanner/</a></p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://id.cker.in/1088.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://id.cker.in/1088.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://id.cker.in/1088.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://id.cker.in/1088.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/1089.seo/">
        ← 全方位绕过安全狗
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/1087.seo/">
        discuz7.2 faq.php 最新注入漏洞分析 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archive"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/2014-10-28-wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/2014-09-11-mabao/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
