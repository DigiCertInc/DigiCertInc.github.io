<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>打造安全的Tomcat服务器 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2012-09-13T06:16:40.000Z" itemprop="datePublished">
          2012-09-13
      </time>
    
    
    | 
    <a href='/tag/Tomcat/'>Tomcat</a>
    
    
</span>
    <h1 class="post-title">打造安全的Tomcat服务器</h1>
    <section class="post-content">
      <p>作者China-Linux</p>  <p>Tomcat是一个开源的Web服务器,基于tomcat的web运行效率高,因为,颇受web站长的青睐,</p>  <p>不过,在默认的配置下,其存在一定的安全隐患,.可被恶意攻击,.另外,其功能比较单纯,需要我们进一步的进行配置,本次将从安全和功能两方面谈谈基于Tomcat的Web服务器的部署.,</p>  <p>希望对大家有帮助.</p>  <p>OS: Windows Server 2003</p>  <p>IP : 125.42.207.94</p>  <p>Tomcat :apache-tomcat-6.0.18</p>  <p>1.安全测试</p>  <p>（1）登陆后台</p>  <p>（2）在Windows Server 2003 上部署Tomcat，一切保持默认。部署Tomcat的时候要记得安装JDK以及配置JDK环境。JDK的安装配置不在本节赘述。然后登陆Tomcat后台。其缺省的后台是：</p>  <p><a href="http://125.42.207.94:8080/manager/html" target="_blank" rel="external">http://125.42.207.94:8080/manager/html</a></p>  <p>在浏览器输入该地址，回车后弹出登录框，输入缺省的用户名admin 缺省密码为空，成功登陆后台 如图（1）</p>  <p><a href="http://www.iitlab.com/attachment.php?id=1" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image001" border="0" alt="clip_image001" src="http://img.cker.in/Tomcat_1363A/clip_image001.png" width="520" height="421"></a></p>  <p>（2）.获得Webshell</p>  <p>（3）在Tomcat的后台有个<b>WAR file to deploy</b><b>模块</b><b>,</b></p>  <p>通过此模块我们可以上传war文件(不是rar),Tomcat可以解析WAR文件,能够将其解压成</p>  <p>Web文件,我们将一个jsp的shell用rar打包,该后缀为(本例为shell.war),将其上传到服务器,可以看到在Tomcat后台多了个shell的目录. 如图2</p>  <p><a href="http://www.iitlab.com/attachment.php?id=2" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://img.cker.in/Tomcat_1363A/clip_image002.png" width="129" height="400"></a></p>  <p>这样一个shell就成功获取了. 如图</p><a id="more"></a><p><a href="http://www.iitlab.com/attachment.php?id=3" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image003" border="0" alt="clip_image003" src="http://img.cker.in/Tomcat_1363A/clip_image003.png" width="361" height="472"></a></p>  <p>(3).测试操作</p>  <p>(4)创建管理员</p>  <p>(5)Tomcat服务缺省是以System权限运行的，因为改jsp木马就继承了</p>  <p>该权限，几乎可以对Web服务器进行所有的操作。比如启动服务、删除/创建 /修改文件、创建用户。我们以创建管理员用户为例进行演示。运行jsp木马的“命令行”模块，</p>  <p>分别输入net user xiaomei 12345 /add&#160;&#160; net localgroup administrators xiaomei /add</p>  <p>这样就创建一个管理员权限的xiaomei用户,如图 4 如图5</p>  <p><a href="http://www.iitlab.com/attachment.php?id=4" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image004" border="0" alt="clip_image004" src="http://img.cker.in/Tomcat_1363A/clip_image004.png" width="520" height="258"></a></p>  <p><a href="http://www.iitlab.com/attachment.php?id=5" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image005" border="0" alt="clip_image005" src="http://img.cker.in/Tomcat_1363A/clip_image005.png" width="518" height="411"></a></p>  <p>远程登陆</p>  <p>我们还可以进一步的<a href="http://www.hackline.net/a/special/wlgf/jbst/" target="_blank" rel="external">渗透</a>,比如通过3389.</p>  <p>我们可以上传一个vbs的脚本,运行.然后帮对方打开3389.其霸占服务器.</p>  <p>如图 6</p>  <p><a href="http://www.iitlab.com/attachment.php?id=6" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image006" border="0" alt="clip_image006" src="http://img.cker.in/Tomcat_1363A/clip_image006.png" width="520" height="511"></a></p>  <p>2.</p>  <p><strong>安全防范</strong></p>  <p>通过上面的测试我们可以看到,缺省情况下的<a href="http://ha.cker.in/tag/Tomcat" target="_blank">Tomcat</a>服务器安全性是非常差的.</p>  <p>如何来加固Tomcat服务器的安全性呢?我们从一下几个方面来加强.</p>  <p>(1)服务降权</p>  <p>缺省安装时Tomcat是以系统服务权限运行的,因此缺省情况下几乎所有的Web服务器的管理员都具有administrator权限.这和iis不同. 存在极大的安全隐患,所以我们的安全设置首先要从Tomcat服务降权开始.</p>  <p>首先创建一个普通用户,为其设置密码.将密码策略设置为&quot;密码永不过期&quot;,比如我创建的是</p>  <p>Tomcat_xm. Ranhou xiugai Tomcat安装文件夹的访问权限，为Tomcat_xm赋予Tomcat文件夹的读。写。执行的访问权限，赋予Tomcat_xm对webapps文件夹的只读访问权限，如果某些web应用程序需要写访问权限，单独为其授予那个文件夹的写访问权限。</p>  <p>如图7</p>  <p><a href="http://www.iitlab.com/attachment.php?id=7" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image007" border="0" alt="clip_image007" src="http://img.cker.in/Tomcat_1363A/clip_image007.png" width="373" height="443"></a></p>  <p>开始—-运行，输入services.msc打开服务管理器,找到apache tomcat服务,</p>  <p>在其属性窗口点击“登陆”选项卡，在登陆身份下选中“以此帐户”，然后在文本框</p>  <p>输入tomcat_xm和密码，最后确定，并重启服务器。这样Tomcat就已Tomcat_xm这个普通用户的权限运行了。</p>  <p>如图8</p>  <p><a href="http://www.iitlab.com/attachment.php?id=8" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image008" border="0" alt="clip_image008" src="http://img.cker.in/Tomcat_1363A/clip_image008.png" width="421" height="438"></a></p>  <p>(1) 更改端口</p>  <p>Tomcat默认端口是8080，攻击者可以运行扫描工具进行端口扫描，</p>  <p>从而获取部署了<a href="http://ha.cker.in/tag/Tomcat" target="_blank">Tomcat</a>的web服务器然后实施攻击。因为，为了安全期间我们可以修改此缺省端口。在Tomcat的安装路径的conf找到server.xml文件,用记事本打开,搜索8080的字段进行修改.</p>  <p>如图9</p>  <p><a href="http://www.iitlab.com/attachment.php?id=9" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image009" border="0" alt="clip_image009" src="http://img.cker.in/Tomcat_1363A/clip_image009.png" width="520" height="187"></a></p>  <p>另外，需要说明的是connectionTimeout=”20000″是连接超 时，maxThreads=”150″是最大线程类似这样的参数也可以根据需要进行修改。</p>  <p>(2) 禁止列目录</p>  <p>我们知道在iis中如果设置不当,就会列出web当前目录的所有文件,在Tomcat也不例外,</p>  <p>如果浏览者可以在客户端浏览web目录,那将会有较大的安全隐患,因为我们要确认Tomcat的设置禁止列目录,设置文件是web.xml&#160; 搜索init-param在其附近找到类似的字段:</p>  <p>&lt;init-param&gt;</p>  <p>&lt;param-name&gt;listings&lt;/param-name&gt;</p>  <p>&lt;param-value&gt;false&lt;/param-value&gt;</p>  <p>&lt;/init-param&gt;</p>  <p>确认是false而不是true.</p>  <p>如图10</p>  <p><a href="http://www.iitlab.com/attachment.php?id=10" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image010" border="0" alt="clip_image010" src="http://img.cker.in/Tomcat_1363A/clip_image010.png" width="520" height="263"></a></p>  <p>(3) 用户管理</p>  <p>(4) <a href="http://ha.cker.in/tag/Tomcat" target="_blank">Tomcat</a>的后台为admin并且缺省为空密码,安全起见我们需要修改缺省的用户名,并为其设置强壮的密码.其配置文件为 tomcat-users.xml ，用记事本打开文件进行修改。其中role标签表示权限，manager说明是管理员权限。 User 标签表示后台管理用户，可以看到用户名为admin 我们可以修改一个陌生的用户，可以看到password后面为空密码，我们可以设置可以强大的密码。最后修改完成的配置文件为：</p>  <p>&lt;?xml version=’1.0’ encoding=’utf-8’?&gt;</p>  <p>&lt;tomcat-users&gt;</p>  <p>&#160; &lt;role rolename=&quot;manager&quot;/&gt;</p>  <p>&#160; &lt;role rolename=&quot;admin&quot;/&gt;</p>  <p>&#160; &lt;user username=&quot;hacker&quot; password=&quot;hacker520&quot; roles=&quot;admin,manager&quot;/&gt;</p>  <p>&lt;/tomcat-users&gt;</p>  <p>如图11</p>  <p><a href="http://www.iitlab.com/attachment.php?id=11" target="_blank" rel="external"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="clip_image011" border="0" alt="clip_image011" src="http://img.cker.in/Tomcat_1363A/clip_image011.png" width="520" height="177"></a></p>  <p>（4）错误页面</p>  <p>（5）Tomcat不像iis提供了各种了各种类型的错误页，如果Tomcat发生错误就会显示千篇一律的错误页面。其实我们可以修改其配置文件，从而自定义设置其错误页面的显示。打开web.xml，在最后一行的之前添加如下的语句：</p>  <p>&lt;error-page&gt;</p>  <p>&lt;error-code&gt;401&lt;/error-code&gt;</p>  <p>&lt;location&gt;/401.htm&lt;/location&gt;</p>  <p>&lt;/error-page&gt;</p>  <p>&lt;error-page&gt;</p>  <p>&lt;error-code&gt;404&lt;/error-code&gt;</p>  <p>&lt;location&gt;/404.htm&lt;/location&gt;</p>  <p>&lt;/error-page&gt;</p>  <p>&lt;error-page&gt;</p>  <p>&lt;error-code&gt;500&lt;/error-code&gt;</p>  <p>&lt;location&gt;/500.htm&lt;/location&gt;</p>  <p>&lt;/error-page&gt;</p>  <p>当然，仅仅设置这样的语句还不行，需要创建相应的401.htm、404.htm、500.htm这样的文件才行。另外，要把错误页面文件放到webapps&#160; manager目录中，否则需要在web.xml中指定其路径。</p>  <p>总结：</p>  <p>总结：<a href="http://ha.cker.in/tag/Tomcat" target="_blank">Tomcat</a>不同于IIS，其配置没有图形界面，而是通过修改配置文件来完成的。不过，正因为如此用户有更多的自主性，可以根据自己的需要进行扩展。而且其与Apache可以无缝结合，打造安全、强大的Web服务器。</p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://ha.cker.in/822.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://ha.cker.in/822.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ha.cker.in/822.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ha.cker.in/822.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/825.seo/">
        ← 友情检测-www.zhaoym.com-详细过程
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/820.seo/">
        WordPress BBPress SQL Injection   Path Disclosure →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
