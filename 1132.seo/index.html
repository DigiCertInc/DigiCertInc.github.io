
 <!DOCTYPE HTML>
<html  xmlns:wb="http://open.weibo.com/wb">
<head>
  <meta charset="UTF-8">
  
    <title>通过IOS Android App获取APP后端数据 | Blog of Secer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
    
    <meta name="author" content="Secer">
    
    <meta name="description" content="本文原创作者：bt0sea    0×00、业务需求  移动应用产业以爆炸性的速度呈指数增长，但移动应用的安全问题落后于应用的发展速度。由于黑客事件变得越来越公开，对企业的影响比以往任何时候都更大。黑客渗透获取用户敏感数据后，出于商业目的销售，或者公开。所以，在移动APP端对企业数据的保护尤为重要。  P2P网站、金融等相关的网站、APP保存着用户的身份信息（真实姓名、身份证号、手机号、征信证明、银行流水等）。目前趋势是移动APP漏洞层出不穷，今天的移动安全相当于十年前web服务器安全的级别。基本上可以得出这样的结论：根据权威机构评估，平均每一个移动APP应用大约有3.5个安全漏洞，Apk 就是open source code代名词。  但是，单纯研究Mobile APP安全性问题，无法利用高危，获得服务器端的数据。所以，在分析移动APP漏洞的同时，要重点分析连接移动APP的RESTful API Web service。为什么要提RESTful API Web service呢？普通web架构+JSON不就成了么？经过分析大部分有价值数据的网站都是使用RESTful API Web service。这是热需求。  咱们先看看哪些大咖用这种设计架构，github/fackbook等。不了解RESTful API Web Service的同学请参考：  http://www.ruanyifeng.com/blog/2014/05/restful_api.html  0×01、研究手段  一、破解思路：  其实重点突破RESTful API Web Service 还是通过iOS/Android App。由于很多高大上的网站为了安全性，把Web网站和移动APP隔离，发现使用http(s)://api(OpenApi).xxx.com/login/v1?phone=13811110000&amp;amp;sgin=022BEC9EE1B935B50D1193A07A3AD7B2。都是通过移动APP抓到的包。所以，我们先看看移动端安全风险主要有哪些，我们如何下手，其实OWASP Mobile Top 10 Risks给我们指引了方向：  M1: 不安全的服务器端访问控制  M2: 不安全的数据存储  M3: 传输层保护不足  M4: 非预期的数据泄露  M5: 脆弱的认证和授权  M6: 已知的弱加密算法  M7: 客户端注入  M8: 通过不被信任的输入改变安全设定  M9: 会话处理不当  M10: 缺乏二进制保护  虽然说官网总结的很好，但是对于服务器端渗透从字面上只有M1。但是个人觉得需要配合APP破解才能达到最佳效果。那么，具体应该怎么操作呢？  M1：不安全的服务器端访问控制  (1)通过android移动APP程序攻击服务器端业务逻辑。  (2)验证服务器端对输入校验。  (3)通用 SQL注入 XSS跨站脚本，不安全的认证检查。  (4)通过代理方式操纵伪造数据提交。  当然要配合M2相关内容。  M2：不安全的数据存储  (1)敏感信息：用户名、密码、加密key、信用卡信息、session识别码、token等。  (2)个人信息：手机号、家庭住址、电子邮件、位置信息等。  (3)还有一些可能包含敏感信息的文件存储：SQLite databases 、Log Files 、XML Data Stores or Manifest Files 、Binary data stores 、SD Card、Cloud  二、具体攻击方法">
    
    
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="333" />
    <meta name="twitter:title" content="通过IOS Android App获取APP后端数据 | Blog of Secer" />
      
    
    
    <link rel="alternate" href="atom.xml" title="Blog of Secer" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/pacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/pacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      <div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Blog of Secer">Blog of Secer</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页</a></li>
					
						<li><a href="/archives">文章</a></li>
					
						<li><a href="/about">关于</a></li>
					
						<li><a href="/atom.xml">RSS订阅</a></li>
					
					<li>
					
					<form class="search" action="/search/index.html" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="text" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Search" />
					</form>
					
					</li>
				</ul>
			</nav>			
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/1132.seo/" title="通过IOS Android App获取APP后端数据" itemprop="url">通过IOS Android App获取APP后端数据</a>
  </h1>
  <!-- 显示作者
  <p class="article-author">By
    
      <a href="http://ha.cker.in" title="Secer">Secer</a>
    </p>
  -->  
  <p class="article-time">
    <time datetime="2015-10-21T02:13:20.000Z" itemprop="datePublished">2015-10-21</time>
    Updated:<time datetime="2016-08-20T11:03:54.000Z" itemprop="dateModified">2016-08-20</time>
    
  </p>
</header>

	<div class="article-content">
		
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">Contents</strong>
		
		</div>
		
		<p>本文原创作者：bt0sea</p>  <p><a href="http://image.3001.net/images/20151020/14453344712097.jpg!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="创意手机app汇总.jpg" border="0" alt="clip_image001" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image001.jpg" width="694" height="464"></a></p>  <p><b>0</b><b>×00、业务需求</b></p>  <p><b>移动应用产业以爆炸性的速度呈指数增长，但移动应用的安全问题落后于应用的发展速度。由于黑客事件变得越来越公开，对企业的影响比以往任何时候都更大。黑客渗透获取用户敏感数据后，出于商业目的销售，或者公开。所以，在移动APP端对企业数据的保护尤为重要。</b></p>  <p>P2P网站、金融等相关的网站、APP保存着用户的身份信息（真实姓名、身份证号、手机号、征信证明、银行流水等）。目前趋势是<a href="http://ha.cker.in/tag/移动APP漏洞" target="_blank">移动APP漏洞</a>层出不穷，今天的移动安全相当于十年前web服务器安全的级别。基本上可以得出这样的结论：根据权威机构评估，平均每一个移动APP应用大约有3.5个安全漏洞，Apk 就是open source code代名词。</p>  <p>但是，单纯研究Mobile APP安全性问题，无法利用高危，获得服务器端的数据。所以，在分析移动APP漏洞的同时，要重点分析连接移动APP的RESTful API Web service。为什么要提RESTful API Web service呢？普通web架构+JSON不就成了么？经过分析大部分有价值数据的网站都是使用RESTful API Web service。这是热需求。</p>  <p>咱们先看看哪些大咖用这种设计架构，github/fackbook等。不了解RESTful API Web Service的同学请参考：</p>  <p><a href="http://www.ruanyifeng.com/blog/2014/05/restful_api.html" target="_blank" rel="external">http://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p>  <p><b>0</b><b>×01、研究手段</b></p>  <p><b>一、破解思路：</b></p>  <p>其实重点突破RESTful API Web Service 还是通过iOS/Android App。由于很多高大上的网站为了安全性，把Web网站和移动APP隔离，发现使用http(s)://api(OpenApi).xxx.com/login/v1?phone=13811110000&amp;sgin=022BEC9EE1B935B50D1193A07A3AD7B2。都是通过移动APP抓到的包。所以，我们先看看移动端安全风险主要有哪些，我们如何下手，其实<a href="http://ha.cker.in/tag/OWASP" target="_blank">OWASP</a> Mobile Top 10 Risks给我们指引了方向：</p>  <p>M1: 不安全的服务器端访问控制</p>  <p>M2: 不安全的数据存储</p>  <p>M3: 传输层保护不足</p>  <p>M4: 非预期的数据泄露</p>  <p>M5: 脆弱的认证和授权</p>  <p>M6: 已知的弱加密算法</p>  <p>M7: 客户端注入</p>  <p>M8: 通过不被信任的输入改变安全设定</p>  <p>M9: 会话处理不当</p>  <p>M10: 缺乏二进制保护</p>  <p>虽然说官网总结的很好，但是对于服务器端渗透从字面上只有M1。但是个人觉得需要配合APP破解才能达到最佳效果。那么，具体应该怎么操作呢？</p>  <p><b>M1</b><b>：不安全的服务器端访问控制</b></p>  <p>(1)通过android移动APP程序攻击服务器端业务逻辑。</p>  <p>(2)验证服务器端对输入校验。</p>  <p>(3)通用 <a href="http://ha.cker.in/tag/SQL注入" target="_blank">SQL注入</a> <a href="http://ha.cker.in/tag/xss" target="_blank">XSS</a>跨站脚本，不安全的认证检查。</p>  <p>(4)通过代理方式操纵伪造数据提交。</p>  <p>当然要配合M2相关内容。</p>  <p><b>M2</b><b>：不安全的数据存储</b></p>  <p>(1)敏感信息：用户名、密码、加密key、信用卡信息、session识别码、token等。</p>  <p>(2)个人信息：手机号、家庭住址、电子邮件、位置信息等。</p>  <p>(3)还有一些可能包含敏感信息的文件存储：SQLite databases 、Log Files 、XML Data Stores or Manifest Files 、Binary data stores 、SD Card、Cloud</p>  <p><b>二、具体攻击方法</b></p><br><a id="more"></a><br><p><b></b></p>  <p><b>2.1 </b><b>使用安卓手机应用程序攻击服务器业务逻辑</b></p>  <p>通过上述分析，可以发现，如果想获取服务器端数据库的数据，主要是集中在对Web平台的安全检测，同时，结合这期的主题RESTful API Web Service，渗透测试重点主要表现在：</p>  <p>(1)、对手机APP客户端做身份认证（Authentication）</p>  <p>(2)、对手机APP身份认证之后的授权（Authorization）</p>  <p>(3)、对手机APP和服务器端传输的数据加密级别判定</p>  <p>首先，我们要了解目前的针对RESTful API Web Service防护的技术手段。</p>  <p><b>方法论研究</b></p>  <p>1、对手机APP客户端做身份认证</p>  <p>1.1、在APP请求中增加签名参数</p>  <p>1.2、http auth （HTTP Basic/HTTP Digest）身份认证机制，这个一般都由安全架构来承担（例如Spring Security）</p>  <p>1.3、OAuth 1/2协议做身份认证（一般都是第三方接入时使用，例如：weibo、微信等）</p>  <p>攻击思路：</p>  <p>寻找Android App存储在本地token信息，比如说在database、s_Prefs;等地方。</p>  <p>破解Android App的加固，寻找和服务器通讯URL签名算法。知道生成算法，就可以伪造请求了。。。</p>  <p>测试用例：撞库分析。。。（分析后可以通过已经泄露的数据库，碰撞测试）：账号和密码产生机制，以及签名产生机制。</p>  <p><b>第一步：首先观察不同两次登录 URL是否存在URL签名。</b></p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 312</p>  <p>Connection: close</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0SpI2Olm3oacqAG%252BxXBrCAm49QWQqztOFLvu5MuecuPzg%253D%253D&amp;password=f73177f13486f55bcd8bea88d1610f58&amp;mobile=186183xx220&amp;imei=&amp;version=2&amp;clienttype=1</p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 308</p>  <p>Connection: close</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0TyLPqEc9hZzGdykXLBNTChe8Cq3c6zqbo2I03zxSZDbA%253D%253D&amp;password=f73177f13486f55bcd8bea88d1610f58&amp;mobile=186183xx220&amp;imei=&amp;version=2&amp;clienttype=1</p>  <p>发现verifycode没有改变。</p>  <p><b>第二步：分析登录各个参数的含义，同时参考破解APK文件。</b></p>  <p>POST <a href="http://wdapi.wandafilm.com/filmserver/user/login" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/login</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: close</p>  <p>Accept-Encoding: gzip</p>  <p>Content-Type: application/x-www-form-urlencoded; charset=utf-8</p>  <p>Content-Length: 316</p>  <p>Connection: close</p>  <p>Cookie: jsessionid|JSESSIONID=4151ab5036290f18ef079cf0f0e43281</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>clientversion=30900&amp;</p>  <p>clientid=1&amp;</p>  <p>verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0SrYk%252FpfqrZZAbA%252BwmJphBLFeaxqAU3tAC5Du9C9W4Yyw%253D%253D&amp;</p>  <p>password=f73177f13486f55bcd8bea88d1610f58&amp;</p>  <p>mobile=186183xx220&amp;</p>  <p>imei=&amp;</p>  <p>version=2&amp;</p>  <p>clienttype=1</p>  <p>apk破解后找到登陆处理函数。</p>  <p>public UserAPILogin(String paramString1, String paramString2, String paramString3, UserModel paramUserModel)</p>  <p>{</p>  <p>&#160;&#160;&#160; super(&quot;/user/login&quot;);</p>  <p>this.mMobile = paramString1;</p>  <p>this.mPassWord = Md5Utils.md5(paramString2);</p>  <p>this.mUserModel = paramUserModel;</p>  <p>this.mTerminal = paramString3;</p>  <p>}</p>  <p>查看源代码后，发现没有加salt，当然你可以使用MD5工具加密对比，但是绝大部分的程序是加salt的。</p>  <p>public static String md5(String paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160; sMd5MessageDigest.reset();</p>  <p>&#160;&#160;&#160; sMd5MessageDigest.update(paramString.getBytes());</p>  <p>&#160;&#160;&#160; paramString = sMd5MessageDigest.digest();</p>  <p>&#160;&#160;&#160; sStringBuilder.setLength(0);</p>  <p>int i = 0;</p>  <p>for (;;)</p>  <p>{</p>  <p>if (i &gt;= paramString.length) {</p>  <p>return sStringBuilder.toString();</p>  <p>}</p>  <p>int j = paramString[i] &amp; 0xFF;</p>  <p>if (j &lt; 16) {</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; sStringBuilder.append(&amp;#039;0&amp;#039;);</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160; sStringBuilder.append(Integer.toHexString(j));</p>  <p>&#160;&#160;&#160;&#160;&#160; i += 1;</p>  <p>}</p>  <p>}</p>  <p>在源代码中搜索verifycode、clientversion、clientid等关键字，定位到WandafilmServerAPI类中的描述：</p>  <p>public String getUrl()</p>  <p>{</p>  <p>String str = super.getUrl();</p>  <p>StringBuilder localStringBuilder = new StringBuilder();</p>  <p>&#160;&#160;&#160; localStringBuilder.append(str);</p>  <p>if (!str.contains(&quot;?&quot;)) {</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;?&quot;);</p>  <p>}</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;clientid=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(Integer.toString(NetConstants.CLIENT_ID));</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;clienttype=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(Integer.toString(2));</p>  <p>&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;verifycode=&quot;);</p>  <p>&#160;&#160;&#160;&#160;&#160; str = getVerifyCodeAes(NetConstants.VERIFY_CODE + System.currentTimeMillis());</p>  <p>if (!TextUtils.isEmpty(str)) {}</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(URLEncoder.encode(str.trim(), &quot;utf-8&quot;));</p>  <p>return localStringBuilder.toString();</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localStringBuilder.append(&quot;&amp;&quot;);</p>  <p>}</p>  <p>catch (UnsupportedEncodingException localUnsupportedEncodingException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; localUnsupportedEncodingException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>然后定位getVerifyCodeAes。</p>  <p>private String getVerifyCodeAes(String paramString)</p>  <p>{</p>  <p>if (mAes == null) {}</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; mAes = new EncryptionAES(NetConstants.AES_KEY);</p>  <p>}</p>  <p>catch (NoSuchAlgorithmException localNoSuchAlgorithmException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>try</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString = mAes.encrypt(paramString.getBytes());</p>  <p>return paramString;</p>  <p>}</p>  <p>catch (InvalidKeyException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>return null;</p>  <p>}</p>  <p>catch (NoSuchAlgorithmException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (NoSuchPaddingException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (InvalidAlgorithmParameterException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (IllegalBlockSizeException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>catch (BadPaddingException paramString)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; paramString.printStackTrace();</p>  <p>continue;</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localNoSuchAlgorithmException = localNoSuchAlgorithmException;</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localNoSuchAlgorithmException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>catch (InvalidKeySpecException localInvalidKeySpecException)</p>  <p>{</p>  <p>for (;;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160; localInvalidKeySpecException.printStackTrace();</p>  <p>}</p>  <p>}</p>  <p>}</p>  <p>static</p>  <p>{</p>  <p>int i;</p>  <p>if (CURRENT_APP_SOURCE == AppSource.CINEMA)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; i = 1;</p>  <p>&#160;&#160;&#160;&#160;&#160; CLIENT_ID = i;</p>  <p>if (CURRENT_APP_SOURCE != AppSource.CINEMA) {</p>  <p>break label89;</p>  <p>}</p>  <p>&#160;&#160;&#160;&#160;&#160; str = &quot;lhdV+wj177YyjirsxeikaNestM/YafgOxrpiGbMVxzvefarFNbQfGHXauqmTIJk+upexqehjv8xK+mlx2SbnDg==&quot;;</p>  <p>&#160;&#160;&#160;&#160;&#160; label34:</p>  <p>&#160;&#160;&#160;&#160;&#160; VERIFY_CODE = str;</p>  <p>if (CURRENT_APP_SOURCE != AppSource.CINEMA) {</p>  <p>break label96;</p>  <p>}</p>  <p>}</p>  <p>&#160;&#160;&#160; label89:</p>  <p>&#160;&#160;&#160; label96:</p>  <p>for (String str = &quot;wandayuanxian100008&quot;;; str = &quot;wanhui20008qweasd&quot;)</p>  <p>{</p>  <p>&#160;&#160;&#160;&#160;&#160; AES_KEY = str;</p>  <p>&#160;&#160;&#160;&#160;&#160; FACE_PACKAGE_LOCAL_PATH = Environment.getExternalStorageDirectory().getAbsolutePath() + &quot;/WandaFacePackage&quot;;</p>  <p>return;</p>  <p>&#160;&#160;&#160;&#160;&#160; i = 2;</p>  <p>break;</p>  <p>&#160;&#160;&#160;&#160;&#160; str = &quot;vcj3smUdw7H47eqDg++qQUR4P52JMZolcamSazRZAQP6h6H9C4vusOkCdt/a15ofuLwGgt+lsgCyzD+ph1WyNg==&quot;;</p>  <p>break label34;</p>  <p>}</p>  <p>}</p>  <p>private byte[] encrypt(SecretKey paramSecretKey, IvParameterSpec paramIvParameterSpec, byte[] paramArrayOfByte)</p>  <p>&#160;&#160;&#160; throws NoSuchAlgorithmException, NoSuchPaddingException, InvalidKeyException, InvalidAlgorithmParameterException, IllegalBlockSizeException, BadPaddingException</p>  <p>{</p>  <p>Cipher localCipher = Cipher.getInstance(&quot;AES/CBC/PKCS7Padding&quot;);</p>  <p>&#160;&#160;&#160; localCipher.init(1, paramSecretKey, paramIvParameterSpec);</p>  <p>return localCipher.doFinal(paramArrayOfByte);</p>  <p>}</p>  <p>System.currentTimeMillis()产生一个当前的毫秒，这个毫秒其实就是自1970年1月1日0时起的毫秒数</p>  <p>没有对手机唯一性的判断，那么，导致verifycode每次登陆都一样，那么，完全可以撞库。</p>  <p><a href="http://image.3001.net/images/20151020/14453243525793.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="1.png" border="0" alt="clip_image002" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image002.jpg" width="694" height="348"></a></p>  <p>设置8次提交。JSON数据返回值都一样（{&quot;msg&quot;:&quot;手机号或密码错误!&quot;,&quot;status&quot;:13007}），那证明，服务器端java应用程序没有次数限制判断。</p>  <p>那么，具体怎么撞库，请参考：</p>  <p><a href="http://mp.weixin.qq.com/s?__biz=MzA4MTA1MDIwMQ==&amp;mid=207971286&amp;idx=1&amp;sn=adb5c7bffabee975fd76f4f0b71a815d#rd" target="_blank" rel="external">http://mp.weixin.qq.com/s?__biz=MzA4MTA1MDIwMQ==&amp;mid=207971286&amp;idx=1&amp;sn=adb5c7bffabee975fd76f4f0b71a815d#rd</a></p>  <p><b>2.2 </b><b>常见的服务器端漏洞，如SQL注入</b></p>  <p>通过代理方式遍历APP抓取所有的URL连接，然后使用SQLMAP检查：</p>  <p>GET <a href="http://wdapi.wandafilm.com/filmserver/info/popularize?verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0S1UEUY0GOe3b2gBZ6jI19NjRz%252FMbY2H1MJ%252BG%252FUT6LPPg%253D%253D&amp;clientid=1&amp;imei=&amp;clientversion=30900&amp;version=2&amp;clienttype=1" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/info/popularize?verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0S1UEUY0GOe3b2gBZ6jI19NjRz%252FMbY2H1MJ%252BG%252FUT6LPPg%253D%253D&amp;clientid=1&amp;imei=&amp;clientversion=30900&amp;version=2&amp;clienttype=1</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: keep-alive</p>  <p>Accept-Encoding: gzip</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>Connection: keep-alive</p>  <p>Cookie: UID=20130211223622356711; SESSIONID=7d4c8c04397e5542e890004d2100f904; jsessionid|JSESSIONID=ecc029e6326c8a7c319c7aa6506c7369</p>  <p>开启kali linux</p>  <p>开启终端：sqlmap –r sqlinj12.txt</p>  <p><a href="http://image.3001.net/images/20151020/14453246553973.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="2.png" border="0" alt="clip_image003" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image003.jpg" width="694" height="425"></a></p>  <p>提交的时候可以提交User-Agent:等相关参数为移动App提交，如果服务器端有相关的判断，可以绕过。</p>  <p><a href="http://image.3001.net/images/20151020/14453265927810.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="112.png" border="0" alt="clip_image004" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image004.jpg" width="694" height="458"></a></p>  <p>同时，建议通过wireshark观察一下返回值的情况。</p>  <p><a href="http://image.3001.net/images/20151020/14453264755696.png!small" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="111.png" border="0" alt="clip_image005" src="http://img.cker.in/IOSAndroidAppAPP_1001C/clip_image005.jpg" width="694" height="456"></a></p>  <p>经过测试发现没有sql注入漏洞。</p>  <p><b>2.3 </b><b>服务器端输入验证的缺失</b></p>  <p>是否越权获取其他用户数据。</p>  <p>GET <a href="http://wdapi.wandafilm.com/filmserver/user/userdetail?clientversion=30900&amp;type=1&amp;userid=20130211223622356711&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;imei=&amp;version=2&amp;clienttype=1" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/userdetail?clientversion=30900&amp;type=1&amp;userid=20130211223622356711&amp;clientid=1&amp;verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;imei=&amp;version=2&amp;clienttype=1</a> HTTP/1.1</p>  <p>Host: wdapi.wandafilm.com</p>  <p>Connection: keep-alive</p>  <p>Accept-Encoding: gzip</p>  <p>User-Agent: 万达电影 3.9.0 rv:95475 (iPhone; iPhone OS 8.4.1; zh_CN)</p>  <p>Connection: keep-alive</p>  <p>Cookie: UID=20130211223622356711; SESSIONID=7d4c8c04397e5542e890004d2100f904; jsessionid|JSESSIONID=ecc029e6326c8a7c319c7aa6506c7369</p>  <p><a href="http://wdapi.wandafilm.com/filmserver/user/userdetail?" target="_blank" rel="external">http://wdapi.wandafilm.com/filmserver/user/userdetail?</a></p>  <p>clientversion=30900&amp;</p>  <p>type=1&amp;</p>  <p>userid=20130211223622356711&amp;</p>  <p>clientid=1&amp;</p>  <p>verifycode=26FZaoBW4leyKOPjrsruo%252FidC3w3S8ETmXUfiepYaAa6dwp1rqTh%252FLqFHsVxVnP8okfw%252BZaUOJ0ONHxYgOO2%252BrDmYygAmW874ZEZabzDK0RQz5UQQ8aiPpE15TIQiIOSUIaJWMCXwVDD5lGOpgY6gg%253D%253D&amp;</p>  <p>imei=&amp;</p>  <p>version=2&amp;</p>  <p>clienttype=1</p>  <p>((StringBuffer)localObject5).append(&quot;UserId&quot;);</p>  <p>((StringBuffer)localObject5).append(&quot; =? &quot;);</p>  <p>Object localObject1 = CinemaGlobal.getInst().mUserModel.getUser().getUid();</p>  <p><b>0</b><b>×02、测试结论：</b></p>  <p>（1）不能相信任何用户的输入，服务器端必须做校验。为了防止提交URL篡改。设计URL时：建议使用用户名密码 + https + url签名（url+时间戳+随机字串）链接。服务器返回token：使用约定的AES算法secret key随机</p>  <p>（2）为了防止为重放攻击，请求中增加一次性的Token，或者短时间内有效的Token。需要提取用户手机特征，但是iphone最好不要提取IMEI，因为苹果权限控制，很多时候为失效状态，导致URL签名没有变化。</p>  <p>（3）客户端最好不要存储任何有价值的数据。存储也必须加密。因为很多时候，你无法判断你的APP是否运行在一个被root的手机上。</p>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-share" id="share">

  
<!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
    <span class="jiathis_txt">分享到：</span>
    <a class="jiathis_button_qzone"></a>
    <a class="jiathis_button_tsina"></a>
    <a class="jiathis_button_tqq"></a>
    <a class="jiathis_button_weixin"></a>
    <a class="jiathis_button_renren"></a>
    <a href="http://www.jiathis.com/share?uid=1987046" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
    <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript">
var jiathis_config = {data_track_clickback:'true'};
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1987046" charset="utf-8"></script>
<!-- JiaThis Button END -->



</div>

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/category/手机安全/">手机安全</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tag/xss/">xss</a><a href="/tag/SQL注入/">SQL注入</a><a href="/tag/移动APP漏洞/">移动APP漏洞</a><a href="/tag/OWASP/">OWASP</a>
  </div>


</footer>   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/1133.seo/" title="针对打印机的APT攻击">
  <strong>Prev:</strong><br/>
  <span>
  针对打印机的APT攻击</span>
</a>
</div>


<div class="next">
<a href="/1131.seo/"  title="Redis未授权访问漏洞获取shell，及写shell报错解决办法">
 <strong>Next:</strong><br/> 
 <span>Redis未授权访问漏洞获取shell，及写shell报错解决办法
</span>
</a>
</div>

</nav>

	<!-- 多说-->

<section class="comment">
<div class="ds-thread" data-thread-key="post-通过IOS Android App获取APP后端数据" data-title="通过IOS Android App获取APP后端数据" data-url="http://ha.cker.in/1132.seo/"></div>
</section>
<!-- disqus-->


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  <p class="asidetitle">关注</p>
<iframe width="100%" height="120" class="share_self" marginheight="5px" frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=120&fansRow=2&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=2424683170&verifier=1d07a1a0&dpc=1"></iframe>


  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
			<li><a href="/category/Linux笔记/" title="Linux笔记">Linux笔记<sup>46</sup></a></li>
		
			<li><a href="/category/Web安全/" title="Web安全">Web安全<sup>88</sup></a></li>
		
			<li><a href="/category/代码学习/" title="代码学习">代码学习<sup>25</sup></a></li>
		
			<li><a href="/category/原创文章/" title="原创文章">原创文章<sup>37</sup></a></li>
		
			<li><a href="/category/工具视频/" title="工具视频">工具视频<sup>12</sup></a></li>
		
			<li><a href="/category/影音娱乐/" title="影音娱乐">影音娱乐<sup>15</sup></a></li>
		
			<li><a href="/category/手机安全/" title="手机安全">手机安全<sup>11</sup></a></li>
		
			<li><a href="/category/无线安全/" title="无线安全">无线安全<sup>4</sup></a></li>
		
			<li><a href="/category/渗透测试/" title="渗透测试">渗透测试<sup>94</sup></a></li>
		
			<li><a href="/category/疑难杂症/" title="疑难杂症">疑难杂症<sup>11</sup></a></li>
		
			<li><a href="/category/精品软件/" title="精品软件">精品软件<sup>16</sup></a></li>
		
			<li><a href="/category/絮叨碎语/" title="絮叨碎语">絮叨碎语<sup>47</sup></a></li>
		
			<li><a href="/category/黑客技巧/" title="黑客技巧">黑客技巧<sup>77</sup></a></li>
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			<li><a href="/tag/net/" title=".net">.net<sup>1</sup></a></li>
		
			<li><a href="/tag/0day/" title="0day">0day<sup>5</sup></a></li>
		
			<li><a href="/tag/12306/" title="12306">12306<sup>3</sup></a></li>
		
			<li><a href="/tag/12306刷票外挂/" title="12306刷票外挂">12306刷票外挂<sup>1</sup></a></li>
		
			<li><a href="/tag/12306刷票外挂下载/" title="12306刷票外挂下载">12306刷票外挂下载<sup>1</sup></a></li>
		
			<li><a href="/tag/1521/" title="1521">1521<sup>1</sup></a></li>
		
			<li><a href="/tag/3389/" title="3389">3389<sup>1</sup></a></li>
		
			<li><a href="/tag/360/" title="360">360<sup>1</sup></a></li>
		
			<li><a href="/tag/3600safe/" title="3600safe">3600safe<sup>1</sup></a></li>
		
			<li><a href="/tag/360浏览器抢票专版/" title="360浏览器抢票专版">360浏览器抢票专版<sup>1</sup></a></li>
		
			<li><a href="/tag/61398/" title="61398">61398<sup>1</sup></a></li>
		
			<li><a href="/tag/ACL/" title="ACL">ACL<sup>1</sup></a></li>
		
			<li><a href="/tag/APT/" title="APT">APT<sup>3</sup></a></li>
		
			<li><a href="/tag/ARP/" title="ARP">ARP<sup>2</sup></a></li>
		
			<li><a href="/tag/ASP/" title="ASP">ASP<sup>1</sup></a></li>
		
			<li><a href="/tag/ASP中FSO的神奇功能/" title="ASP中FSO的神奇功能">ASP中FSO的神奇功能<sup>1</sup></a></li>
		
			<li><a href="/tag/ATM/" title="ATM">ATM<sup>1</sup></a></li>
		
			<li><a href="/tag/ActionScript中shellcode的定位和提取/" title="ActionScript中shellcode的定位和提取">ActionScript中shellcode的定位和提取<sup>1</sup></a></li>
		
			<li><a href="/tag/ActionScript的反汇编和反编译/" title="ActionScript的反汇编和反编译">ActionScript的反汇编和反编译<sup>1</sup></a></li>
		
			<li><a href="/tag/Acunetix-Web-Vulnerability-Scanner/" title="Acunetix Web Vulnerability Scanner">Acunetix Web Vulnerability Scanner<sup>1</sup></a></li>
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
      <li></li>
      <li></li>
      <li></li>
    </ul>
</div>


  <div class="rsspart">
	<a href="atom.xml" target="_blank" title="rss">RSS</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> 没有礁石，就没有美丽的浪花；没有挫折，就没有壮丽的人生！ <br/>
			再长的路，一步步也能走完，再短的路，不迈开双脚也无法到达，平凡的脚步也可以走完伟大的行程！</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/111" target="_blank" title="weibo"></a>
		
		
		<a href="https://twitter.com/333" target="_blank" title="twitter"></a>
		
		
		<a href="https://github.com/333" target="_blank" title="github"></a>
		
		
	</div>
		<p class="copyright">Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/A-limon/pacman" target="_blank" title="pacman">pacman</a> © 2016 
		
		<a href="http://ha.cker.in" target="_blank" title="Secer">Secer</a>
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"dreajaygithubblog"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 








<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F77edef7e6931022edbd2322ec66456e1' type='text/javascript'%3E%3C/script%3E"));
</script>

<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
</div>
<script type="text/javascript">
	(function($) { 
		// When to show the scroll link
		// higher number = scroll link appears further down the page   
		var upperLimit = 300;
		
		// Our scroll link element
		var scrollElem = $('#totop');
	   
		// Scroll to top speed
		var scrollSpeed = 800;
	   
		// Show and hide the scroll to top link based on scroll position   
		scrollElem.hide();
		$(window).scroll(function () {            
			var scrollTop = $(document).scrollTop();       
			if ( scrollTop > upperLimit ) {
				$(scrollElem).stop().fadeTo(300, 1); // fade back in           
			}else{       
				$(scrollElem).stop().fadeTo(300, 0); // fade out
			}
		});
		// Scroll to top animation on click
		$(scrollElem).click(function(){
			$('html, body').animate({scrollTop:0}, scrollSpeed); return false;
		});
	})(jQuery);
</script>


  </body>
</html>

