<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Tag: getshell | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="home-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      
<main class="content" role="main">
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2013-10-21T21:04:30.000Z" itemprop="datePublished">
          2013-10-22
      </time>
    
    
    | 
    <a href='/tag/Webshell/'>Webshell</a>,
    
    <a href='/tag/getshell/'>getshell</a>,
    
    <a href='/tag/Java/'>Java</a>,
    
    <a href='/tag/Tomcat/'>Tomcat</a>,
    
    <a href='/tag/GlassFish/'>GlassFish</a>,
    
    <a href='/tag/WebLogic/'>WebLogic</a>,
    
    <a href='/tag/Resin/'>Resin</a>,
    
    <a href='/tag/Websphere/'>Websphere</a>
    
    
</span>
      <h2 class="post-title"><a href="/1042.seo/">攻击JavaWeb应用 7 -Server篇 1</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        <p><a href="http://drops.wooyun.org/tips/604">攻击JavaWeb应用[7]-Server篇[1]</a></p>  <p><a href="http://drops.wooyun.org/tips/604">http://drops.wooyun.org/tips/604</a></p>  <h4>java应用服务器</h4>  <hr align="center" width="100%" size="2" />  <p><a href="http://Ha.Cker.In/tag/Java" target="_blank">Java</a>应用服务器主要为应用程序提供运行环境，为组件提供服务。Java 的应用服务器很多，从功能上分为两类：JSP 服务器和 Java EE 服务器。</p>  <h5>常见的Server概述</h5>  <p>常见的Java服务器:<a href="http://Ha.Cker.In/tag/Tomcat" target="_blank">Tomcat</a>、<a href="http://Ha.Cker.In/tag/Weblogic" target="_blank">Weblogic</a>、<a href="http://Ha.Cker.In/tag/JBoss" target="_blank">JBoss</a>、<a href="http://Ha.Cker.In/tag/GlassFish" target="_blank">GlassFish</a>、Jetty、Resin、IBM Websphere、Bejy Tiger、Geronimo、Jonas、Jrun、Orion、TongWeb、BES Application Server、ColdFusion、Apusic Application Server、Sun Application Server 、Oracle9i/AS、Sun Java System Application Server。</p>  <p>Myeclipse比较方便的配置各式各样的Server，一般只要简单的选择下Server的目录就行了。</p>  <p><a href="http://img.cker.in/JavaWeb7Server1_9DDC/clip_image001.png"><img title="clip_image001" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="607" alt="clip_image001" src="http://img.cker.in/JavaWeb7Server1_9DDC/clip_image001_thumb.png" width="628" border="0" /></a></p>  <p>部署完成后启动进入各个Server的后台：</p><br>
      
      </p>
      
      <p>
          <a href="/1042.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2013-10-21T19:56:10.000Z" itemprop="datePublished">
          2013-10-22
      </time>
    
    
    | 
    <a href='/tag/getshell/'>getshell</a>,
    
    <a href='/tag/Struts2/'>Struts2</a>
    
    
</span>
      <h2 class="post-title"><a href="/1039.seo/">攻击JavaWeb应用 4 -SQL注入 2</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        <p><a href="http://drops.wooyun.org/tips/288">攻击JavaWeb应用[4]-SQL注入[2]</a></p>  <p><a href="http://drops.wooyun.org/tips/288">http://drops.wooyun.org/tips/288</a></p>  <h6>注:这一节主要是介绍Oracle和SQL注入工具相关，本应该是和前面的Mysql一起但是由于章节过长了没法看，所以就分开了。</h6>  <h5>0x00 Oracle</h5>  <hr align="center" width="100%" size="2" />  <p>Oracle Database，又名Oracle RDBMS，或简称Oracle。是甲骨文公司的一款关系数据库管理系统。</p>  <p>Oracle对于MYSQL、MSSQL来说意味着更大的数据量，更大的权限。这一次我们依旧使用上面的代码，数据库结构平移到Oracle上去，数据库名用的默认的orcl，字段&quot;corps_desc&quot; 从text改成了VARCHAR2(4000)，JSP内的驱动和URL改成了对应的Oracle。    <br />    <br /><a href="http://img.cker.in/JavaWeb4SQL2_9BEC/clip_image001.png"><img title="clip_image001" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="749" alt="clip_image001" src="http://img.cker.in/JavaWeb4SQL2_9BEC/clip_image001_thumb.png" width="1386" border="0" /></a></p>  <p>Jsp页面代码：    <br /><a href="http://img.cker.in/JavaWeb4SQL2_9BEC/clip_image002.png"><img title="clip_image002" style="border-top-width: 0px; display: inline; border-left-width: 0px; border-bottom-width: 0px; border-right-width: 0px" height="640" alt="clip_image002" src="http://img.cker.in/JavaWeb4SQL2_9BEC/clip_image002_thumb.png" width="1328" border="0" /></a></p>  <p>开始注入：</p>  <p><code>Union +order by</code> 永远都是最快捷最实用的，而盲注什么的太费时费力了。</p><br>
      
      </p>
      
      <p>
          <a href="/1039.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2013-06-17T23:52:14.000Z" itemprop="datePublished">
          2013-06-18
      </time>
    
    
    | 
    <a href='/tag/getshell/'>getshell</a>
    
    
</span>
      <h2 class="post-title"><a href="/1006.seo/">Dedecms最新注入漏洞分析 download.php</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        <p>【转的360的分析】</p>  <p>最近看到网上曝出的dedecms最新版本的一个注入漏洞利用，漏洞PoC和分析文章也已在网上公开.但是在我实际测试过程当中，发现无法复现。原因是此漏洞的利用需要一定的前提条件，而原分析文章当中并没有交代这些，所以这里将我的分析过程以及一些触发的必要条件总结了一下。</p>  <p>一. 漏洞跟踪</p>  <p>发布时间：2013年6月7日</p>  <p>漏洞描述：</p>  <p>DedeCMS是一个网站应用系统构建平台，也是一个强大的网站内容管理系统。基于PHP+MySQL的技术架构，完全开源加上强大稳定的技术架构，既可以用来构建复杂体系的企业信息门户或电子商务网站平台，也可以用来管理简单内容发布网站，不管是商务资源门户还是娱乐信息门户，它都是您管理网站的好帮手。</p>  <p>漏洞触发的根源在于dedesql.class.php在调用$GLOBALS[‘arrs1’]、$GLOBALS[‘arrs2’]这两个全局变量之前未对其进行初始化，导致能够覆盖任意全局变量。</p>  <p>漏洞危害：因为dedecms的使用非常广泛，而此漏洞利用方便，危害性高，能够远程获取管理后台，进而直接<a href="http://Ha.Cker.In/tag/getshell" target="_blank">getshell</a>获取系统控制权。</p>  <p>触发条件：确保php.ini中使用php_mysql.dll同时未开启php_mysqli.dll，</p>  <p>如图所示：</p>  <p><a href="http://blogs.360.cn/360safe/files/2013/06/clip_image00211.jpg"><img title="clip_image001[1]" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="237" alt="clip_image001[1]" src="http://img.cker.in/Dedecmsdownload.php_DEE5/clip_image0011.jpg" width="647" border="0" /></a></p>  <p>受影响版本：dedecms 5.7</p>  <p>二. 漏洞原理</p>  <p>首先说一下dedecms不安全的参数处理机制，这里我们看一下/include/common.inc.php代码的第79行：</p>  <p>foreach(Array(‘_GET’,’_POST’,’_COOKIE’) as $_request)</p>  <p>&#160;&#160;&#160;&#160;&#160; {</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; foreach($$_request as $_k =&gt; $_v)</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if($_k == ‘nvarname’) ${$_k} = $_v;</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; else ${$_k} = _RunMagicQuotes($_v);</p>  <p>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }</p>  <p>&#160;&#160;&#160;&#160;&#160; }</p>  <p>万恶之源其实就在这里，基本上目前dede被发现的漏洞全都死在这里。我们可以看到，程序从GPC数组中取出名值对后，只是对$_v做了简单的addslashes处理，就直接赋给了${$_k}，实现了类似全局变量覆盖的机制，设计的初衷是为了开发方便，但却存在着严重的安全问题。PHP在经历了这么多年的更新换代终于修补了register_globals问题，但是dede的这段代码使php付出的努力全部白费。</p>  <p>下面我们回归漏洞。</p>  <p>首先是/include/dedesql.class.php的第589-600行，</p>  <p><a href="http://blogs.360.cn/360safe/files/2013/06/clip_image00411.jpg"><img title="clip_image002[1]" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="448" alt="clip_image002[1]" src="http://img.cker.in/Dedecmsdownload.php_DEE5/clip_image0021.jpg" width="616" border="0" /></a></p>  <p>在执行这段代码之前，程序未初始化$arrs1和$arrs2这两个数组。结合前面提到的dede不安全的参数处理机制，利用这段代码我们可以控制$GLOBALS[$v1]的值。例如在这个漏洞中，$GLOBALS[$v1]是拼接而成，我们可以控制$GLOBALS[‘cfg_dbprefix’]的值。</p>  <p>然后，我们来看一下如何利用$GLOBALS[‘cfg_dbprefix’]。</p>  <p>这里在/include/dedesql.class.php的第512行SetQuery函数中，代码如下</p>  <p><a href="http://blogs.360.cn/360safe/files/2013/06/clip_image00611.jpg"><img title="clip_image003[1]" style="border-right: 0px; border-top: 0px; display: inline; border-left: 0px; border-bottom: 0px" height="193" alt="clip_image003[1]" src="http://img.cker.in/Dedecmsdownload.php_DEE5/clip_image0031.jpg" width="639" border="0" /></a></p>  <p>这里因为$GLOBALS[‘cfg_dbprefix’]是可控的，进而$prefix也是可控的，所以在这儿就造成了SQL注入。</p><br>
      
      </p>
      
      <p>
          <a href="/1006.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <nav class="pagination" role="pagination">
    
    <span class="page-number">Page 1 of 1</span>
    
  </nav>
</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
