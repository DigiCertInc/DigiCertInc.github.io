<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Tag: 运维 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="home-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      
<main class="content" role="main">
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2012-07-12T17:08:08.000Z" itemprop="datePublished">
          2012-07-13
      </time>
    
    
    | 
    <a href='/tag/运维/'>运维</a>,
    
    <a href='/tag/YouTube/'>YouTube</a>
    
    
</span>
      <h2 class="post-title"><a href="/672.seo/">YouTube架构学习体会</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        <p>这几天一直在关注和学习一些大型网站的架构，希望有一天自己也能设计一个高并发、高容错的系统并能应用在实践上。今天在网上找架构相关的资料时，看到一个被和谐的视频网站YouTube的架构分析，看了以后觉得自己又向架构走近了一步，于是赶快拿出来与大家一起分享。 </p>  <p>YouTube发展迅速，每天超过1亿的视频点击量，但只有很少人在维护站点和确保伸缩性。这点和PlentyOfFish类似，少数人维护庞大系统。是什么原因呢？放心绝对不是靠人品，也不是靠寂寞，下面就来看看YouTube的整体技术架构吧。 </p>  <p>平台    <br />Apache     <br />Python     <br />Linux(SuSe)     <br />MySQL     <br />psyco，一个动态的Python到C的编译器     <br />lighttpd代替Apache做视频查看 </p>  <p>状态 </p>  <p>支持每天超过1亿的视频点击量    <br />成立于2005年2月     <br />于2006年3月达到每天3千万的视频点击量     <br />于2006年7月达到每天1亿的视频点击量     <br />2个系统管理员，2个伸缩性软件架构师     <br />2个软件开发工程师，2个网络工程师，1个DBA </p>  <p>Web服务器 </p>  <p>1，NetScaler用于负载均衡和静态内容缓存    <br />2，使用mod_fast_cgi运行Apache     <br />3，使用一个Python应用服务器来处理请求的路由     <br />4，应用服务器与多个数据库和其他信息源交互来获取数据和格式化html页面     <br />5，一般可以通过添加更多的机器来在Web层提高伸缩性     <br />6，Python的Web层代码通常不是性能瓶颈，大部分时间阻塞在RPC     <br />7，Python允许快速而灵活的开发和部署     <br />8，通常每个页面服务少于100毫秒的时间     <br />9，使用psyco(一个类似于JIT编译器的动态的Python到C的编译器)来优化内部循环     <br />10，对于像加密等密集型CPU活动，使用C扩展     <br />11，对于一些开销昂贵的块使用预先生成并缓存的html     <br />12，数据库里使用行级缓存     <br />13，缓存完整的Python对象     <br />14，有些数据被计算出来并发送给各个程序，所以这些值缓存在本地内存中。这是个使用不当的策略。 </p>  <p>应用服务器里最快的缓存将预先计算的值发送给所有服务器也花不了多少时间。只需弄一个代理来监听更改，预计算，然后发送。 </p>  <p>视频服务 </p>  <p>1，花费包括带宽，硬件和能源消耗    <br />2，每个视频由一个迷你集群来host，每个视频被超过一台机器持有     <br />3，使用一个集群意味着：     <br />&#160;&#160; -更多的硬盘来持有内容意味着更快的速度     <br />&#160;&#160; -failover。如果一台机器出故障了，另外的机器可以继续服务     <br />&#160;&#160; -在线备份     <br />4，使用lighttpd作为Web服务器来提供视频服务：     <br />&#160;&#160; -Apache开销太大     <br />&#160;&#160; -使用epoll来等待多个fds     <br />&#160;&#160; -从单进程配置转变为多进程配置来处理更多的连接     <br />5，大部分流行的内容移到CDN：     <br />&#160; -CDN在多个地方备份内容，这样内容离用户更近的机会就会更高     <br />&#160; -CDN机器经常内存不足，因为内容太流行以致很少有内容进出内存的颠簸     <br />6，不太流行的内容(每天1-20浏览次数)在许多colo站点使用YouTube服务器     <br />&#160; -长尾效应。一个视频可以有多个播放，但是许多视频正在播放。随机硬盘块被访问     <br />&#160; -在这种情况下缓存不会很好，所以花钱在更多的缓存上可能没太大意义。     <br />&#160; -调节RAID控制并注意其他低级问题     <br />&#160; -调节每台机器上的内存，不要太多也不要太少&#160; </p>  <p>视频服务关键点    <br />1，保持简单和廉价     <br />2，保持简单网络路径，在内容和用户间不要有太多设备     <br />3，使用常用硬件，昂贵的硬件很难找到帮助文档     <br />4，使用简单而常见的工具，使用构建在Linux里或之上的大部分工具     <br />5，很好的处理随机查找(SATA，tweaks) </p>  <p>缩略图服务 </p>  <p>1，做到高效令人惊奇的难    <br />2，每个视频大概4张缩略图，所以缩略图比视频多很多     <br />3，缩略图仅仅host在几个机器上     <br />4，持有一些小东西所遇到的问题：     <br />&#160;&#160; -OS级别的大量的硬盘查找和inode和页面缓存问题     <br />&#160;&#160; -单目录文件限制，特别是Ext3，后来移到多分层的结构。内核2.6的最近改进可能让 Ext3允许大目录，但在一个文件系统里存储大量文件不是个好主意     <br />&#160;&#160; -每秒大量的请求，因为Web页面可能在页面上显示60个缩略图     <br />&#160;&#160; -在这种高负载下Apache表现的非常糟糕     <br />&#160;&#160; -在Apache前端使用squid，这种方式工作了一段时间，但是由于负载继续增加而以失败告终。它让每秒300个请求变为20个     <br />&#160;&#160; -尝试使用lighttpd但是由于使用单线程它陷于困境。遇到多进程的问题，因为它们各自保持自己单独的缓存     <br />&#160;&#160; -如此多的图片以致一台新机器只能接管24小时     <br />&#160;&#160; -重启机器需要6-10小时来缓存     <br />5，为了解决所有这些问题YouTube开始使用Google的BigTable，一个分布式数据存储：     <br />&#160;&#160; -避免小文件问题，因为它将文件收集到一起     <br />&#160;&#160; -快，错误容忍     <br />&#160;&#160; -更低的延迟，因为它使用分布式多级缓存，该缓存与多个不同collocation站点工作     <br />&#160;&#160; -更多信息参考Google Architecture，GoogleTalk Architecture和BigTable </p>
      
      </p>
      
      <p>
          <a href="/672.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2011-08-03T22:03:26.000Z" itemprop="datePublished">
          2011-08-04
      </time>
    
    
    | 
    <a href='/tag/Linux/'>Linux</a>,
    
    <a href='/tag/运维/'>运维</a>
    
    
</span>
      <h2 class="post-title"><a href="/58.seo/">Linux运维的一些常见问题及解决方法</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        今晚有空把最近运维中遇到的一些问题及解决方法总结下，写的比较匆忙，可能有些问题和错误，请各位看官指正。——————————————————————————————————————————1.shell脚本死活不执行问题：某天研发某同事找我说帮他看看他写的shell脚本，死活不执行，报错。我看了下，脚本很简单，也没有常规性的错误，报“: bad interpreter: No such file or&nbsp; directory”错。
      
      </p>
      
      <p>
          <a href="/58.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <nav class="pagination" role="pagination">
    
    <span class="page-number">Page 1 of 1</span>
    
  </nav>
</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
