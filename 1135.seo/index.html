<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <title>Android APP安全测试入门 | Blog of Secer</title>
  <meta name="description" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="MobileOptimized" content="320" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" type="text/css" href="/css/screen.css" />
  <link rel="stylesheet" type="text/css" href="/css/style.css" />
  <meta name="generator" content="Blog of Secer">

  
  
  

  
</head>

<!--
<body class="post-template">
-->
<body class="home-template">
<div id="perspective" class="perspective effect-movedown">
  <div class="container">
    <!-- wrapper -->
    <div class="wrapper">

      <header class="site-head"  style="background: #24282b url(/img/img-bg.jpg) 0 -20%" >
    <div class="vertical">
        <div class="site-head-content inner">
             <a class="blog-logo" href="/"><img src="/img/logo.svg" alt="Blog Logo"/></a> 
            <h1 class="blog-title">Blog of Secer</h1>
            <h2 class="blog-description"><button id="showMenu">Show Menu</button></h2>
        </div>
    </div>
</header>

      

<main class="content" role="main">
  <article class="post">
    <span class="post-meta">
      <time datetime="2016-04-06T17:18:43.000Z" itemprop="datePublished">
          2016-04-07
      </time>
    
    
    | 
    <a href='/tag/BlueStacks/'>BlueStacks</a>
    
    
</span>
    <h1 class="post-title">Android APP安全测试入门</h1>
    <section class="post-content">
      <p><b>背景</b></p>  <p>最近这两年移动端真是非常火，每个单位或多或少都会有那么几款App，对于我们Web安全攻城师来说，App安全也需要或多或少的了解一些。年初单位来了一位对App安全略有研究的小伙伴，某日闲来无事教了笔者几招，分享给大家。有句古语:”工欲善其事，必先利其器”，我们要研究App安全，没有几款高大上的神器是会非常麻烦的，因此本文主要给大家分享一下笔者学到的一些基础知识，主要是一些移动端测试辅助工具的使用。</p>  <p><b>模拟器</b></p>  <p>模拟器笔者经常使用有两款，一款是<a href="http://ha.cker.in/tag/BlueStacks" target="_blank">BlueStacks</a>，这款个人感觉是做的非常不错的，一般安装操作App非常流畅，不会有卡死的情况。另外一款就是SDK模拟器(Software Development Kit)了，这款是特别高大上的，类似虚拟机vm一样，可以建立多个虚拟机，安装不同的android系统。</p>  <p><b>BlueStacks</b></p>  <p>下载地址：</p>  <p><a href="http://www.bluestacks.net.cn/Download/" target="_blank" rel="external">http://www.bluestacks.net.cn/Download/</a></p>  <p>安装的时候会提示安装”给力助手”，给力助手是辅助操作的，可以安装电脑上下载的app安装包到模拟器，也可以卸载已经安装的，还有很多针对模拟器的设置功能，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image001.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image001" border="0" alt="clip_image001" src="http://img.cker.in/AndroidAPP_DE31/clip_image001_thumb.jpg" width="872" height="542"></a></p>  <p>BlueStacks安装之后，安装APP，打开App界面如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image002.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image002" border="0" alt="clip_image002" src="http://img.cker.in/AndroidAPP_DE31/clip_image002_thumb.jpg" width="494" height="768"></a></p>  <p>功能方面使用都非常简单，本文就不做介绍了。</p>  <p><b>Software Development Kit</b></p>  <p>下载地址：</p>  <p><a href="http://developer.android.com/sdk/index.html" target="_blank" rel="external">http://developer.android.com/sdk/index.html</a></p>  <p>下载之后打开包中的eclipse，然后进行模拟器Android镜像的下载，包中自带的镜像是Android 5.0的镜像，建议下载老版本的，方便测试App，新版的镜像部分App在安装的过程中可能会有不兼容的情况。   <br>SDK Android镜像的下载如下图所示：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image003.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image003" border="0" alt="clip_image003" src="http://img.cker.in/AndroidAPP_DE31/clip_image003_thumb.jpg" width="945" height="721"></a></p>  <p></p><br><a id="more"></a><br><p>下载完Android镜像之后就可以安装虚拟机了，具体如下：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image004.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image004" border="0" alt="clip_image004" src="http://img.cker.in/AndroidAPP_DE31/clip_image004_thumb.jpg" width="1216" height="712"></a></p>  <p><b>抓包神器</b></p>  <p>抓app包的方法有很多种，比如手机设置代理用BurpSuite进行抓包，或者可以用fidder抓包。我比较习惯用一款小工具smsniff进行抓包，使用起来比较方便，抓到的包再放到Burpsuite进行修改提交等。工具如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image005.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image005" border="0" alt="clip_image005" src="http://img.cker.in/AndroidAPP_DE31/clip_image005_thumb.jpg" width="896" height="597"></a></p>  <p>这款工具比较小巧，占用资源较少，有些时候用burp等抓包会发生错误，或者直接导致虚拟机上的app无法连接网络，用这款就不会发生以上说的情况。</p>  <p><b>SDK</b><b>小工具</b></p>  <p>SDK中自带了几款很不错的小工具，我比较常用的有adb和emulator。ADB是一个客户端-服务器端程序，其中客户端是你用来操作的电脑，服务器端是android设备。SDK包中默认就有这俩款小工具</p>  <p><b>Adb</b></p>  <p>Adb命令如下：   <br>adb devices 查看启动的虚拟机设备，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image006.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image006" border="0" alt="clip_image006" src="http://img.cker.in/AndroidAPP_DE31/clip_image006_thumb.jpg" width="450" height="122"></a></p>  <p>adb install，安装app到已经打开的虚拟机中，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image007.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image007" border="0" alt="clip_image007" src="http://img.cker.in/AndroidAPP_DE31/clip_image007_thumb.jpg" width="515" height="142"></a></p>  <p>这样就将本地下载的app安装到了已经启动android虚拟机中了。   <br>adb shell，登录设备shell，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image008.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image008" border="0" alt="clip_image008" src="http://img.cker.in/AndroidAPP_DE31/clip_image008_thumb.jpg" width="610" height="415"></a></p>  <p>adb push，将电脑上的文件发送的android虚拟机上；adb pull，将android虚拟机上的文件发送到电脑上，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image009.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image009" border="0" alt="clip_image009" src="http://img.cker.in/AndroidAPP_DE31/clip_image009_thumb.jpg" width="504" height="161"></a></p>  <p>Adb命令非常强大，以上只是列出了比较基础的几个，详细的大家可以百度。</p>  <p><b>Emulator</b></p>  <p>Emulator命令我目前常用的就两招，启动android虚拟机，以代理模式启动android虚拟机。命令分别如下：</p>  <p>Emulator @xiaomi</p>  <p>Emulator -http-proxy 127.0.0.1:8080 @xiaomi</p>  <p>其中xiaomi是我新建的android虚拟机的名字，设置代理启动之后，就可以用burp进行抓包了。</p>  <p><b>反编译工具</b></p>  <p>反编译app主要用apktool和d2j-dex2jar.bat，我比较常用的是dex2jar。   <br>Apktool反编译命令如下：</p>  <p>apktool.jar d e:\Appsec\xxx.apk</p>  <p>命令执行之后会在apktool.jar所在目录下生成一个app的目录。   <br>d2j-dex2jra.bat反编译方法如下：    <br>用rar打开apk文件，将其中的classes.dex解压出来，然后执行命令d2j-dex2jar.bat d:\Appsec\xx\classes.dex    <br>执行完成之后会在d2j-dex2jar.bat相同目录下生成一个.jar的文件，可以用jd-gui.exe直接打开.jar来查看app的源代码，如图：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image010.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image010" border="0" alt="clip_image010" src="http://img.cker.in/AndroidAPP_DE31/clip_image010_thumb.jpg" width="682" height="413"></a></p>  <p><b>案例分享</b></p>  <p>App安全测试，我只能测测简单的，大多是权限绕过类的，比如绕过锁屏密码、任意用户登录等。基本都是因为app代码设计缺陷或者权限验证不足导致的。</p>  <p><b>任意用户登录</b></p>  <p>某次测试一个app，RP比较好，发现一任意用户登录漏洞。在本地的配置文件中有登录用户的帐号和密码，APP设计比较奇葩，只是验证了用户登录邮箱，没有验证密码，导致通过修改本地的配置文件就可以实现任意用户登录，登录之后能够查看别人的订单等数据。在android虚拟机中安装的app都在/data/data目录下，大概的目录结构如下：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image011.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image011" border="0" alt="clip_image011" src="http://img.cker.in/AndroidAPP_DE31/clip_image011_thumb.jpg" width="545" height="181"></a></p>  <p>app安装目录下的结构都是差不多的，主要有缓存文件、数据库目录、本地文件、配置文件等。比较重要的目录有databases、shared_prefs。分别保存了数据库文件和配置文件。   <br>言归正传，查看了安装app的shared_prefs目录，发现其中一个文件内容如下：</p>  <p><a href="http://img.cker.in/AndroidAPP_DE31/clip_image012.jpg" target="_blank" rel="external"><img style="border-bottom: 0px; border-left: 0px; display: inline; border-top: 0px; border-right: 0px" title="clip_image012" border="0" alt="clip_image012" src="http://img.cker.in/AndroidAPP_DE31/clip_image012_thumb.jpg" width="562" height="274"></a>    <br>可以看到有用户的登录邮箱和密码，将邮箱修改成存在的用户邮箱，密码随意输入，然后adb shell之后，用linux命令删除android虚拟机上已经存在的配置文件，再用adb push将修改后的文件发送到android虚拟机，再打开app发现已经用其它用户成功登录了。</p>  <p><a href="https://sobug.com/article/detail/7" target="_blank" rel="external">https://sobug.com/article/detail/7</a></p>
    </section>
    <footer class="post-footer">
      <section class="author">
    <h4>Secer</h4>
    <p>记录互联网安全历程与个人成长经历</p>
</section>
      <section class="share">
    <h4>Share this post</h4>
    <a class="icon-sina-weibo" href="http://v.t.sina.com.cn/share/share.php?title=记录互联网安全历程与个人成长经历 ?url=http://ha.cker.in/1135.seo/" target="_blank">
        <span class="hidden">weibo</span>
    </a>
    <a class="icon-twitter" href="http://twitter.com/share?url=http://ha.cker.in/1135.seo/"
       onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
        <span class="hidden">Twitter</span>
    </a>
    <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://ha.cker.in/1135.seo/"
       onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
        <span class="hidden">Facebook</span>
    </a>
    <a class="icon-google-plus" href="https://plus.google.com/share?url=http://ha.cker.in/1135.seo/"
       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
        <span class="hidden">Google+</span>
    </a>
</section>

    </footer>
  </article>
  <nav class="pagination" role="pagination">
    
    <a class="newer-posts" href="/1136.seo/">
        ← 特殊条件数据传输
    </a>
    
    <span class="icon-logo">•</span>
    
    <a class="older-posts" href="/1134.seo/">
        渗透测试中上传文件到目标系统的四种姿势 →
    </a>
    
</nav>

  <div id="comment" class="comments-area">
    <h4 class="title"><a href="#disqus_comments" name="disqus_comments">Comments</a></h4>
    
</div>

</main>


      
<footer class="site-footer">
  
  <div class="inner">
     <section class="copyright">All content copyright <a href="/">Blog of Secer</a> &copy; 2014 &bull; All rights reserved.</section>
     <section class="poweredby">Proudly published with <a class="icon-ghost" href="http://zespia.tw/hexo/">Hexo</a></section>
  </div>
</footer>

      <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script type="text/javascript" src="/js/jquery.fitvids.js"></script>
<script type="text/javascript" src="/js/index.js"></script>
<script type="text/javascript" src="/js/menu.js"></script>





  </div>
</div>

<nav  class="outer-nav top horizontal">

          <a class="icon-home"  href="/"><span>Home</span></a>

          <a class="icon-news"  href="/archives"><span>Archive</span></a>

          <a class="icon-image"  href="/images"><span>Images</span></a>

          <a class="icon-wiki"  href="/wiki/"><span>Wiki</span></a>

          <a class="icon-Favorites"  href="/favorites"><span>Favorites</span></a>

          <a class="icon-mail"  href="/about/"><span>Contact</span></a>

</nav>

</div>
</body>
</html>
